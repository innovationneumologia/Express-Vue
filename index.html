<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeumoCare Hospital Management System</title>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* ============ BASE STYLES ============ */
        :root {
            --primary-color: #1a73e8;
            --primary-dark: #0d47a1;
            --primary-light: #e8f0fe;
            --secondary-color: #34a853;
            --danger-color: #ea4335;
            --warning-color: #fbbc05;
            --info-color: #4285f4;
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f4;
            --gray-200: #e8eaed;
            --gray-300: #dadce0;
            --gray-400: #bdc1c6;
            --gray-500: #9aa0a6;
            --gray-600: #80868b;
            --gray-700: #5f6368;
            --gray-800: #3c4043;
            --gray-900: #202124;
            
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.15);
            --shadow-xl: 0 20px 60px rgba(0,0,0,0.2);
            
            --border-radius-sm: 6px;
            --border-radius-md: 10px;
            --border-radius-lg: 16px;
            --border-radius-xl: 24px;
            
            --transition-fast: 150ms;
            --transition-normal: 250ms;
            --transition-slow: 350ms;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            line-height: 1.3;
        }

        /* ============ UTILITY CLASSES ============ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .text-primary { color: var(--primary-color); }
        .text-success { color: var(--secondary-color); }
        .text-danger { color: var(--danger-color); }
        .text-warning { color: var(--warning-color); }
        .text-info { color: var(--info-color); }
        .text-muted { color: var(--gray-600); }

        .bg-primary { background: var(--primary-color); }
        .bg-success { background: var(--secondary-color); }
        .bg-danger { background: var(--danger-color); }
        .bg-warning { background: var(--warning-color); }
        .bg-info { background: var(--info-color); }
        .bg-light { background: var(--gray-50); }

        .shadow-sm { box-shadow: var(--shadow-sm); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }

        .rounded-sm { border-radius: var(--border-radius-sm); }
        .rounded-md { border-radius: var(--border-radius-md); }
        .rounded-lg { border-radius: var(--border-radius-lg); }
        .rounded-xl { border-radius: var(--border-radius-xl); }

        .transition { transition: all var(--transition-normal) ease; }

        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }

        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }

        .ml-2 { margin-left: 0.5rem; }

        .w-100 { width: 100%; }

        /* ============ BUTTONS ============ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius-md);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 14px;
            line-height: 1;
            cursor: pointer;
            transition: all var(--transition-normal) ease;
            white-space: nowrap;
        }

        .btn i { font-size: 14px; }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-800);
            border: 1px solid var(--gray-300);
        }
        .btn-secondary:hover {
            background: var(--gray-200);
            border-color: var(--gray-400);
        }

        .btn-success {
            background: var(--secondary-color);
            color: white;
        }
        .btn-success:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        .btn-danger:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-outline-danger {
            background: transparent;
            border: 2px solid var(--danger-color);
            color: var(--danger-color);
        }
        .btn-outline-danger:hover {
            background: var(--danger-color);
            color: white;
        }

        .btn-sm { padding: 6px 12px; font-size: 13px; }
        .btn-lg { padding: 14px 28px; font-size: 16px; }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 50%;
        }

        /* ============ BADGES ============ */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            color: white;
        }

        .badge-primary {
            background: var(--primary-color);
        }

        .badge-success {
            background: var(--secondary-color);
        }

        .badge-warning {
            background: var(--warning-color);
        }

        .badge-danger {
            background: var(--danger-color);
        }

        .badge-info {
            background: var(--info-color);
        }

        .badge-resident-advanced {
            background: linear-gradient(135deg, #4285f4, #34a853);
        }

        .badge-attending-advanced {
            background: linear-gradient(135deg, #ea4335, #fbbc05);
        }

        .badge-admin-advanced {
            background: linear-gradient(135deg, #8e24aa, #1a237e);
        }

        .badge-supervisor-advanced {
            background: linear-gradient(135deg, #00acc1, #00897b);
        }

        /* ============ STATUS BADGES ============ */
        .status-available {
            background: linear-gradient(135deg, #34a853, #0d9d58);
            color: white;
        }

        .status-busy {
            background: linear-gradient(135deg, #fbbc05, #f9ab00);
            color: white;
        }

        .status-critical {
            background: linear-gradient(135deg, #ea4335, #d23f31);
            color: white;
        }

        .status-oncall {
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            color: white;
        }

        .status-reported {
            background: linear-gradient(135deg, #8e24aa, #7b1fa2);
            color: white;
        }

        /* ============ CARDS ============ */
        .card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal) ease;
            border: 1px solid var(--gray-200);
            position: relative;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--gray-100);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary-color);
            font-size: 16px;
        }

        /* ============ FORMS ============ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-800);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            transition: all var(--transition-normal) ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .form-control-sm {
            padding: 8px 12px;
            font-size: 13px;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-select-sm {
            padding: 8px 12px;
            font-size: 13px;
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .form-check-input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .form-check-label {
            font-size: 14px;
            color: var(--gray-700);
            cursor: pointer;
        }

        /* ============ TABLES ============ */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--border-radius-md);
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        }

        .table th {
            padding: 16px;
            text-align: left;
            color: white;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--gray-200);
        }

        .table tbody tr {
            border-bottom: 1px solid var(--gray-100);
            transition: all var(--transition-fast) ease;
        }

        .table tbody tr:hover {
            background: var(--primary-light);
        }

        .table td {
            padding: 16px;
            font-size: 14px;
            color: var(--gray-700);
            vertical-align: middle;
        }

        /* ============ MODALS ============ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .modal-container {
            background: white;
            border-radius: var(--border-radius-lg);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        .modal-wide {
            max-width: 900px;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 2px solid var(--gray-100);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast) ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 2px solid var(--gray-100);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: var(--gray-50);
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
        }

        /* Modal Tabs */
        .modal-tabs {
            display: flex;
            border-bottom: 2px solid var(--gray-200);
            margin-bottom: 24px;
        }

        .modal-tab {
            padding: 12px 24px;
            border: none;
            background: none;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all var(--transition-fast);
        }

        .modal-tab:hover {
            color: var(--primary-color);
        }

        .modal-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .modal-tab-content {
            display: none;
        }

        .modal-tab-content.active {
            display: block;
        }

        /* Modal Sections */
        .modal-section {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--gray-200);
        }

        .modal-section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-section-title i {
            font-size: 14px;
        }

        .modal-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        /* ============ TOASTS ============ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 16px 20px;
            min-width: 300px;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--primary-color);
            animation: toastSlideIn 0.3s ease;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-icon {
            font-size: 18px;
            color: var(--primary-color);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--gray-900);
        }

        .toast-message {
            font-size: 13px;
            color: var(--gray-700);
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray-500);
            font-size: 14px;
            cursor: pointer;
            padding: 2px;
        }

        .toast-success { border-left-color: var(--secondary-color); }
        .toast-success .toast-icon { color: var(--secondary-color); }

        .toast-error { border-left-color: var(--danger-color); }
        .toast-error .toast-icon { color: var(--danger-color); }

        .toast-warning { border-left-color: var(--warning-color); }
        .toast-warning .toast-icon { color: var(--warning-color); }

        .toast-permission { border-left-color: #8e24aa; }
        .toast-permission .toast-icon { color: #8e24aa; }

        /* ============ LOGIN SCREEN ============ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: white;
            border-radius: var(--border-radius-xl);
            padding: 48px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow-xl);
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .login-logo i {
            font-size: 38px;
            color: var(--primary-color);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: var(--gray-600);
            font-size: 16px;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ============ MAIN LAYOUT ============ */
        .app-layout {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        }

        /* ============ SIDEBAR ============ */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, var(--gray-900) 0%, var(--gray-800) 100%);
            color: white;
            display: flex;
            flex-direction: column;
            transition: all var(--transition-normal) ease;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 18px;
        }

        .sidebar-logo i {
            font-size: 22px;
            color: var(--primary-color);
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            transition: all var(--transition-fast) ease;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-section-title {
            padding: 0 24px 8px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gray-500);
            font-weight: 500;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu-item {
            margin: 2px 0;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            color: var(--gray-400);
            text-decoration: none;
            transition: all var(--transition-fast) ease;
            font-size: 14px;
            font-weight: 500;
            border-left: 3px solid transparent;
        }

        .sidebar-menu-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        .sidebar-menu-link.active {
            background: rgba(26, 115, 232, 0.2);
            color: white;
            border-left-color: var(--primary-color);
        }

        .sidebar-menu-link i {
            font-size: 15px;
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-role {
            font-size: 12px;
            color: var(--gray-500);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-collapsed .sidebar-header {
            justify-content: center;
        }

        .sidebar-collapsed .sidebar-logo span,
        .sidebar-collapsed .sidebar-section-title,
        .sidebar-collapsed .sidebar-menu-link span,
        .sidebar-collapsed .user-info,
        .sidebar-collapsed .sidebar-toggle span {
            display: none;
        }

        .sidebar-collapsed .sidebar-logo,
        .sidebar-collapsed .sidebar-menu-link {
            justify-content: center;
        }

        .sidebar-collapsed .sidebar-menu-link i {
            font-size: 16px;
        }

        /* ============ MAIN CONTENT ============ */
        .main-content {
            flex: 1;
            margin-left: 260px;
            transition: all var(--transition-normal) ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content-expanded {
            margin-left: 80px;
        }

        /* ============ BREADCRUMB ============ */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-600);
            font-size: 14px;
            cursor: pointer;
            transition: color var(--transition-fast);
        }

        .breadcrumb-item:hover {
            color: var(--primary-color);
        }

        .breadcrumb-item.active {
            color: var(--primary-color);
            font-weight: 500;
            cursor: default;
        }

        .breadcrumb-separator {
            color: var(--gray-400);
        }

        /* ============ QUICK STATS SIDEBAR ============ */
        .quick-stats-sidebar {
            position: fixed;
            right: 0;
            top: 80px;
            width: 280px;
            height: calc(100vh - 80px);
            background: white;
            border-left: 1px solid var(--gray-200);
            box-shadow: -2px 0 20px rgba(0,0,0,0.1);
            z-index: 90;
            overflow-y: auto;
            padding: 20px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .quick-stats-sidebar.open {
            transform: translateX(0);
        }

        .stats-toggle-btn {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px 0 0 8px;
            padding: 12px 8px;
            cursor: pointer;
            z-index: 91;
            box-shadow: -2px 0 10px rgba(0,0,0,0.2);
        }

        .stats-toggle-btn:hover {
            background: var(--primary-dark);
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--gray-100);
        }

        .stats-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-title i {
            font-size: 14px;
            color: var(--primary-color);
        }

        .stats-close {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }

        .stats-close:hover {
            background: var(--gray-100);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 13px;
            color: var(--gray-600);
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .stat-trend {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 8px;
        }

        .stat-trend.positive {
            background: rgba(52, 168, 83, 0.1);
            color: var(--secondary-color);
        }

        .stat-trend.negative {
            background: rgba(234, 67, 53, 0.1);
            color: var(--danger-color);
        }

        /* ============ TOP NAVBAR ============ */
        .top-navbar {
            background: white;
            padding: 16px 32px;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .navbar-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .navbar-subtitle {
            font-size: 14px;
            color: var(--gray-600);
            margin-left: 10px;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 18px;
            color: var(--gray-700);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
        }

        .mobile-menu-toggle:hover {
            background: var(--gray-100);
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* ============ ENHANCED SEARCH ============ */
        .search-container {
            position: relative;
            width: 300px;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px 10px 42px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            transition: all var(--transition-normal) ease;
            background: var(--gray-50);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
            font-size: 15px;
        }

        .search-scope {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .search-scope:hover {
            background: var(--gray-200);
        }

        .search-filters {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .search-filter-btn {
            padding: 4px 10px;
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: 12px;
            font-size: 11px;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .search-filter-btn:hover {
            background: var(--gray-200);
            border-color: var(--gray-400);
        }

        .search-filter-btn.active {
            background: var(--primary-light);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .recent-searches {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            margin-top: 8px;
            z-index: 1000;
            display: none;
        }

        .search-input:focus + .recent-searches,
        .recent-searches:hover {
            display: block;
        }

        .recent-search-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 13px;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .recent-search-item:hover {
            background: var(--gray-50);
        }

        .recent-search-item:last-child {
            border-bottom: none;
        }

        .recent-search-time {
            font-size: 11px;
            color: var(--gray-500);
        }

        .clear-recent {
            padding: 8px 16px;
            text-align: center;
            font-size: 12px;
            color: var(--gray-500);
            cursor: pointer;
            border-top: 1px solid var(--gray-100);
        }

        .clear-recent:hover {
            color: var(--danger-color);
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification-badge {
            position: relative;
        }

        .badge-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger-color);
            color: white;
            font-size: 11px;
            font-weight: 600;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-menu {
            position: relative;
        }

        .user-menu-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            background: none;
            border: none;
            padding: 8px 12px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast) ease;
        }

        .user-menu-toggle:hover {
            background: var(--gray-100);
        }

        .user-menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            z-index: 1000;
            overflow: hidden;
            animation: dropdownFade 0.2s ease;
        }

        @keyframes dropdownFade {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            color: var(--gray-700);
            text-decoration: none;
            transition: all var(--transition-fast) ease;
            font-size: 14px;
            border-bottom: 1px solid var(--gray-100);
        }

        .user-menu-item:hover {
            background: var(--gray-50);
            color: var(--primary-color);
        }

        .user-menu-item:last-child {
            border-bottom: none;
        }

        /* ============ CONTENT AREA ============ */
        .content-area {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        /* ============ DASHBOARD ============ */
        .dashboard-grid-compact {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .card-grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .dashboard-section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ============ INTERACTIVE WIDGETS ============ */
        .card-draggable {
            cursor: move;
        }

        .card-dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .card-pinned {
            border-left: 4px solid var(--warning-color);
        }

        .pin-btn {
            background: none;
            border: none;
            color: var(--gray-400);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all var(--transition-fast);
        }

        .pin-btn:hover {
            color: var(--warning-color);
        }

        .pin-btn.pinned {
            color: var(--warning-color);
        }

        .collapse-btn {
            background: none;
            border: none;
            color: var(--gray-400);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all var(--transition-fast);
        }

        .collapse-btn:hover {
            color: var(--gray-600);
        }

        .card-collapsed .card-content {
            display: none;
        }

        /* ============ QUICK ACTIONS ============ */
        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: var(--border-radius-md);
            flex-wrap: wrap;
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            font-weight: 500;
        }

        .quick-action-btn:hover {
            border-color: var(--primary-color);
            background: var(--primary-light);
            transform: translateY(-1px);
        }

        /* ============ FILTER BAR ============ */
        .filter-bar {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 16px;
            background: white;
            border-radius: var(--border-radius-md);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 180px;
        }

        .filter-label {
            font-size: 12px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .filter-actions {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        /* ============ STATS CARDS ============ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal) ease;
            border: 1px solid var(--gray-200);
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .stat-icon {
            width: 52px;
            height: 52px;
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
        }

        .stat-icon.primary { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); }
        .stat-icon.success { background: linear-gradient(135deg, var(--secondary-color), #0d9d58); }
        .stat-icon.warning { background: linear-gradient(135deg, var(--warning-color), #f57c00); }
        .stat-icon.danger { background: linear-gradient(135deg, var(--danger-color), #c62828); }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 26px;
            font-weight: 700;
            color: var(--gray-900);
            line-height: 1;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 10px;
            margin-top: 4px;
            display: inline-block;
        }

        .stat-change.positive {
            background: rgba(52, 168, 83, 0.1);
            color: var(--secondary-color);
        }

        .stat-change.negative {
            background: rgba(234, 67, 53, 0.1);
            color: var(--danger-color);
        }

        /* ============ PROGRESS INDICATORS ============ */
        .progress-bar {
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 12px;
            color: var(--gray-600);
            display: flex;
            justify-content: space-between;
        }

        .progress-success .progress-fill {
            background: var(--secondary-color);
        }

        .progress-warning .progress-fill {
            background: var(--warning-color);
        }

        .progress-danger .progress-fill {
            background: var(--danger-color);
        }

        /* ============ ACTIVITY TIMELINE ============ */
        .activity-timeline {
            position: relative;
            padding-left: 24px;
        }

        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 7px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--gray-300);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .timeline-item:last-child {
            padding-bottom: 0;
        }

        .timeline-dot {
            position: absolute;
            left: -24px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 3px solid white;
            box-shadow: 0 0 0 2px var(--primary-color);
        }

        .timeline-content {
            background: var(--gray-50);
            padding: 12px;
            border-radius: var(--border-radius-md);
            margin-bottom: 4px;
        }

        .timeline-time {
            font-size: 11px;
            color: var(--gray-500);
            margin-left: 12px;
        }

        /* ============ UPDATED TIMESTAMP ============ */
        .updated-timestamp {
            font-size: 11px;
            color: var(--gray-500);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ============ ACTIVITY FEED ============ */
        .activity-feed {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }

        .activity-item {
            display: flex;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 13px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 14px;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* ============ ACTION DROPDOWN ============ */
        .action-dropdown {
            position: relative;
            display: inline-block;
        }

        .action-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            min-width: 150px;
            z-index: 10;
        }

        .action-dropdown:hover .action-menu {
            display: block;
        }

        .action-menu-item {
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background-color var(--transition-fast);
            font-size: 13px;
            color: var(--gray-700);
        }

        .action-menu-item:hover {
            background-color: var(--gray-100);
        }

        .action-menu-item.text-danger {
            color: var(--danger-color);
        }

        /* ============ EMPTY STATES ============ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 24px;
            text-align: center;
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 44px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .empty-state-description {
            font-size: 14px;
            max-width: 400px;
            margin-bottom: 20px;
        }

        /* ============ LOADING STATES ============ */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            z-index: 10;
        }

        .loading-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid var(--gray-300);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 18px;
            height: 18px;
            margin: -9px 0 0 -9px;
            border: 2px solid var(--gray-300);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ============ STAFF DETAILS VIEW ============ */
        .staff-details-modal .modal-container {
            max-width: 800px;
        }

        .staff-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-200);
        }

        .staff-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 24px;
            flex-shrink: 0;
        }

        .staff-info {
            flex: 1;
        }

        .staff-name {
            font-size: 24px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
        }

        .staff-meta {
            display: flex;
            gap: 16px;
            margin-bottom: 8px;
        }

        .staff-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: var(--gray-600);
        }

        .staff-meta-item i {
            font-size: 12px;
        }

        .staff-stats {
            display: flex;
            gap: 20px;
            margin-top: 12px;
        }

        .staff-stat {
            text-align: center;
        }

        .staff-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .staff-stat-label {
            font-size: 12px;
            color: var(--gray-600);
        }

        /* ============ CAPACITY PLANNING ============ */
        .capacity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .capacity-card {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 16px;
            border: 2px solid var(--gray-200);
            transition: all var(--transition-fast);
        }

        .capacity-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .capacity-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .capacity-unit {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 14px;
        }

        .capacity-status {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
        }

        .capacity-status.low {
            background: rgba(52, 168, 83, 0.1);
            color: var(--secondary-color);
        }

        .capacity-status.medium {
            background: rgba(251, 188, 5, 0.1);
            color: var(--warning-color);
        }

        .capacity-status.high {
            background: rgba(234, 67, 53, 0.1);
            color: var(--danger-color);
        }

        .capacity-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .capacity-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            font-size: 14px;
            text-align: center;
        }

        .capacity-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .capacity-slash {
            color: var(--gray-400);
            font-weight: 600;
        }

        /* ============ LEAVE REQUEST VIEW ============ */
        .leave-details-view {
            background: var(--gray-50);
            padding: 20px;
            border-radius: var(--border-radius-md);
            margin-bottom: 24px;
        }

        .leave-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .leave-info-item {
            padding: 12px;
            background: white;
            border-radius: var(--border-radius-md);
            border-left: 4px solid var(--primary-color);
        }

        .leave-info-label {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: 4px;
        }

        .leave-info-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-900);
        }

        .leave-timeline {
            background: white;
            padding: 16px;
            border-radius: var(--border-radius-md);
        }

        .timeline-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-left: 3px solid var(--gray-300);
            margin-bottom: 8px;
        }

        .timeline-status.completed {
            border-left-color: var(--secondary-color);
        }

        .timeline-status.current {
            border-left-color: var(--primary-color);
            background: var(--primary-light);
        }

        .timeline-dot-small {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--gray-300);
            flex-shrink: 0;
        }

        .timeline-status.completed .timeline-dot-small {
            background: var(--secondary-color);
        }

        .timeline-status.current .timeline-dot-small {
            background: var(--primary-color);
        }

        .timeline-text {
            font-size: 13px;
            color: var(--gray-700);
        }

        .timeline-date {
            font-size: 11px;
            color: var(--gray-500);
            margin-left: auto;
        }

        /* ============ PERMISSION MANAGER ============ */
        .permission-manager {
            position: fixed;
            top: 0;
            right: -500px;
            width: 500px;
            height: 100vh;
            background: white;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-normal) ease;
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }

        .permission-manager.open {
            right: 0;
        }

        .permission-header {
            padding: 24px;
            background: linear-gradient(135deg, var(--gray-900), var(--gray-800));
            color: white;
        }

        .permission-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .permission-subtitle {
            font-size: 14px;
            color: var(--gray-400);
        }

        .permission-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .permission-resource {
            margin-bottom: 24px;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }

        .permission-resource-header {
            background: var(--gray-50);
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .permission-resource-title {
            font-weight: 600;
            color: var(--gray-900);
        }

        .permission-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            padding: 16px;
            background: white;
        }

        .permission-action {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast) ease;
        }

        .permission-action:hover {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }

        .permission-action.active {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }

        .permission-action.active .permission-toggle {
            color: var(--primary-color);
        }

        .permission-toggle {
            color: var(--gray-400);
            font-size: 12px;
        }

        .permission-action-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-800);
        }

        .permission-footer {
            padding: 20px;
            border-top: 1px solid var(--gray-200);
            background: var(--gray-50);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* ============ GRID UTILITIES ============ */
        .grid {
            display: grid;
        }

        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-cols-5 { grid-template-columns: repeat(5, 1fr); }
        .grid-cols-6 { grid-template-columns: repeat(6, 1fr); }
        .grid-cols-7 { grid-template-columns: repeat(7, 1fr); }

        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .gap-8 { gap: 2rem; }

        /* ============ FLEX UTILITIES ============ */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .items-end { align-items: flex-end; }
        .justify-start { justify-content: flex-start; }
        .justify-center { justify-content: center; }
        .justify-end { justify-content: flex-end; }
        .justify-between { justify-content: space-between; }
        .justify-around { justify-content: space-around; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-nowrap { flex-wrap: nowrap; }
        .flex-1 { flex: 1; }
        .flex-auto { flex: 1 1 auto; }

        /* ============ TEXT UTILITIES ============ */
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }

        /* ============ SPACING ============ */
        .p-1 { padding: 0.25rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-1 { padding-left: 0.25rem; padding-right: 0.25rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }

        /* ============ MAX WIDTH ============ */
        .max-w-xs { max-width: 20rem; }
        .max-w-sm { max-width: 24rem; }
        .max-w-md { max-width: 28rem; }
        .max-w-lg { max-width: 32rem; }
        .max-w-xl { max-width: 36rem; }
        .max-w-2xl { max-width: 42rem; }
        .max-w-full { max-width: 100%; }

        /* ============ TRUNCATE ============ */
        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* ============ MOBILE RESPONSIVE ============ */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .search-container {
                width: 200px;
            }

            .quick-stats-sidebar {
                width: 250px;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid-compact,
            .card-grid-2 {
                grid-template-columns: 1fr;
            }
            
            .navbar-right {
                flex-direction: column;
                align-items: flex-end;
            }
            
            .search-container {
                width: 100%;
                max-width: 200px;
            }
            
            .permission-manager {
                width: 100%;
                right: -100%;
            }
            
            .content-area {
                padding: 20px;
            }
            
            .grid-cols-2,
            .grid-cols-3,
            .grid-cols-4,
            .grid-cols-5,
            .grid-cols-6,
            .grid-cols-7 {
                grid-template-columns: 1fr;
            }

            .quick-stats-sidebar {
                width: 100%;
            }

            .staff-header {
                flex-direction: column;
                text-align: center;
            }

            .staff-meta {
                justify-content: center;
                flex-wrap: wrap;
            }

            .capacity-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 32px 20px;
            }
            
            .modal-container {
                width: 95%;
            }
            
            .top-navbar {
                padding: 12px 16px;
            }
            
            .navbar-title {
                font-size: 16px;
            }
            
            .quick-actions {
                justify-content: center;
            }
            
            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .filter-actions {
                margin-left: 0;
                justify-content: flex-end;
            }

            .staff-stats {
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        /* ============ CUSTOM SCROLLBAR ============ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }

        /* ============ ANIMATIONS ============ */
        .fade-enter-active, .fade-leave-active {
            transition: opacity var(--transition-normal) ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }

        .slide-enter-active, .slide-leave-active {
            transition: transform var(--transition-normal) ease;
        }
        .slide-enter-from, .slide-leave-to {
            transform: translateX(-20px);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ============ TOAST CONTAINER ============ -->
        <div class="toast-container">
            <div v-for="toast in toasts" :key="toast.id" 
                 :class="['toast', `toast-${toast.type}`]">
                <div class="toast-icon">
                    <i :class="toast.icon"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">{{ toast.title }}</div>
                    <div class="toast-message">{{ toast.message }}</div>
                </div>
                <button class="toast-close" @click="removeToast(toast.id)">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- ============ LOGIN SCREEN ============ -->
        <div v-if="!currentUser" class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">
                        <i class="fas fa-lungs"></i>
                        <span class="login-title">NeumoCare</span>
                    </div>
                    <p class="login-subtitle">Pulmonology Department Management System</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" v-model="loginForm.email" placeholder="admin@neumocare.org">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" v-model="loginForm.password" placeholder="password123">
                </div>
                
                <div class="form-group">
                    <label class="form-label">User Role</label>
                    <select class="form-select" v-model="loginForm.user_role">
                        <option value="system_admin">System Administrator</option>
                        <option value="department_head">Head of Department</option>
                        <option value="resident_manager">Resident Manager</option>
                        <option value="attending_physician">Attending Physician</option>
                        <option value="viewing_doctor">Viewing Doctor</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-check">
                        <input type="checkbox" class="form-check-input" v-model="loginForm.require_mfa">
                        <span class="form-check-label">Require MFA Authentication</span>
                    </label>
                </div>
                
                <div v-if="loginForm.require_mfa" class="form-group">
                    <label class="form-label">MFA Code</label>
                    <input type="text" class="form-control" v-model="loginForm.mfa_code" placeholder="000000">
                </div>
                
                <button class="btn btn-primary btn-lg w-100" @click="handleAdvancedLogin" :disabled="loading">
                    <span v-if="loading" class="loading"></span>
                    <span v-else><i class="fas fa-sign-in-alt"></i> Login to NeumoCare</span>
                </button>
                
                <div class="text-center mt-4 text-muted">
                    <small>Demo Credentials: admin@neumocare.org / password123</small>
                </div>
            </div>
        </div>

        <!-- ============ MAIN APPLICATION ============ -->
        <div v-else class="app-layout">
            <!-- Sidebar -->
            <aside class="sidebar" :class="{ 'sidebar-collapsed': sidebarCollapsed, 'mobile-open': mobileMenuOpen }">
                <div class="sidebar-header">
                    <div class="sidebar-logo">
                        <i class="fas fa-lungs"></i>
                        <span>NeumoCare</span>
                    </div>
                    <button class="sidebar-toggle" @click="sidebarCollapsed = !sidebarCollapsed">
                        <i class="fas" :class="sidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
                    </button>
                </div>
                
                <nav class="sidebar-nav">
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Dashboard</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'daily_operations' }" 
                                   @click.prevent="switchView('daily_operations'); mobileMenuOpen = false">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <span>Overview</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Staff Management</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'medical_staff' }" 
                                   @click.prevent="switchView('medical_staff'); mobileMenuOpen = false" v-if="hasPermission('medical_staff', 'read')">
                                    <i class="fas fa-user-md"></i>
                                    <span>Medical Staff</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'resident_rotations' }" 
                                   @click.prevent="switchView('resident_rotations'); mobileMenuOpen = false" v-if="hasPermission('resident_rotations', 'read')">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>Rotations</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Scheduling</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'oncall_schedule' }" 
                                   @click.prevent="switchView('oncall_schedule'); mobileMenuOpen = false" v-if="hasPermission('oncall_schedule', 'read')">
                                    <i class="fas fa-phone-alt"></i>
                                    <span>On-call</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'leave_requests' }" 
                                   @click.prevent="switchView('leave_requests'); mobileMenuOpen = false" v-if="hasPermission('leave_requests', 'read')">
                                    <i class="fas fa-calendar-check"></i>
                                    <span>Leave Requests</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Training</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'training_units' }" 
                                   @click.prevent="switchView('training_units'); mobileMenuOpen = false" v-if="hasPermission('training_units', 'read')">
                                    <i class="fas fa-clinic-medical"></i>
                                    <span>Training Units</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section" v-if="hasAnyPermission(['communications', 'audit', 'system'])">
                        <div class="sidebar-section-title">Administration</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item" v-if="hasPermission('communications', 'read')">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'communications' }" 
                                   @click.prevent="switchView('communications'); mobileMenuOpen = false">
                                    <i class="fas fa-bullhorn"></i>
                                    <span>Communications</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item" v-if="hasPermission('audit', 'read')">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'audit_logs' }" 
                                   @click.prevent="switchView('audit_logs'); mobileMenuOpen = false">
                                    <i class="fas fa-history"></i>
                                    <span>Audit Logs</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item" v-if="hasPermission('system', 'read')">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'system_settings' }" 
                                   @click.prevent="switchView('system_settings'); mobileMenuOpen = false">
                                    <i class="fas fa-cog"></i>
                                    <span>System Settings</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
                
                <div class="sidebar-footer">
                    <div class="sidebar-user">
                        <div class="user-avatar">{{ getInitials(currentUser.full_name) }}</div>
                        <div class="user-info">
                            <div class="user-name">{{ currentUser.full_name }}</div>
                            <div class="user-role">{{ getUserRoleDisplay(currentUser.user_role) }}</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Quick Stats Sidebar -->
            <button class="stats-toggle-btn" @click="toggleStatsSidebar">
                <i class="fas" :class="statsSidebarOpen ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
            </button>
            
            <div class="quick-stats-sidebar" :class="{ open: statsSidebarOpen }">
                <div class="stats-header">
                    <div class="stats-title">
                        <i class="fas fa-chart-line"></i>
                        Live Stats
                    </div>
                    <button class="stats-close" @click="statsSidebarOpen = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Department Occupancy</span>
                    <span class="stat-value">{{ liveStats.occupancy }}%</span>
                    <span class="stat-trend" :class="liveStats.occupancyTrend > 0 ? 'positive' : 'negative'">
                        {{ liveStats.occupancyTrend > 0 ? '' : '' }}{{ Math.abs(liveStats.occupancyTrend) }}%
                    </span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">On-duty Staff</span>
                    <span class="stat-value">{{ liveStats.onDutyStaff }}</span>
                    <span class="stat-trend" :class="liveStats.staffTrend > 0 ? 'positive' : 'negative'">
                        {{ liveStats.staffTrend > 0 ? '' : '' }}{{ Math.abs(liveStats.staffTrend) }}
                    </span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Pending Requests</span>
                    <span class="stat-value">{{ liveStats.pendingRequests }}</span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">ER Capacity</span>
                    <span class="stat-value">{{ liveStats.erCapacity.current }}/{{ liveStats.erCapacity.max }}</span>
                    <span class="stat-trend" :class="liveStats.erCapacity.status">{{ liveStats.erCapacity.status }}</span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Pulmo ICU</span>
                    <span class="stat-value">{{ liveStats.icuCapacity.current }}/{{ liveStats.icuCapacity.max }}</span>
                    <span class="stat-trend" :class="liveStats.icuCapacity.status">{{ liveStats.icuCapacity.status }}</span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Ward Beds</span>
                    <span class="stat-value">{{ liveStats.wardCapacity.current }}/{{ liveStats.wardCapacity.max }}</span>
                    <span class="stat-trend" :class="liveStats.wardCapacity.status">{{ liveStats.wardCapacity.status }}</span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Today's Admissions</span>
                    <span class="stat-value">{{ liveStats.todayAdmissions }}</span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Avg. Stay (days)</span>
                    <span class="stat-value">{{ liveStats.avgStay }}</span>
                </div>
            </div>

            <!-- Main Content -->
            <main class="main-content" :class="{ 'main-content-expanded': sidebarCollapsed }">
                <!-- Top Navbar -->
                <header class="top-navbar">
                    <div class="navbar-left">
                        <button class="mobile-menu-toggle" @click="mobileMenuOpen = !mobileMenuOpen">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div>
                            <span class="navbar-title">{{ getCurrentTitle() }}</span>
                            <span class="navbar-subtitle">{{ getCurrentSubtitle() }}</span>
                        </div>
                    </div>
                    
                    <div class="navbar-right">
                        <!-- Enhanced Search -->
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" :placeholder="getSearchPlaceholder()" 
                                       v-model="searchQuery" @keyup.enter="handleAdvancedSearch"
                                       @focus="showRecentSearches = true"
                                       @blur="setTimeout(() => { showRecentSearches = false }, 200)">
                                <button class="search-scope" @click="toggleSearchScope">
                                    {{ searchScope }} <i class="fas fa-chevron-down ml-2"></i>
                                </button>
                                
                                <div class="recent-searches" v-if="showRecentSearches && recentSearches.length > 0">
                                    <div v-for="(search, index) in recentSearches" :key="index" 
                                         class="recent-search-item" @click="selectRecentSearch(search)">
                                        <span>{{ search.query }}</span>
                                        <span class="recent-search-time">{{ search.time }}</span>
                                    </div>
                                    <div class="clear-recent" @click="clearRecentSearches">
                                        Clear History
                                    </div>
                                </div>
                            </div>
                            
                            <div class="search-filters">
                                <button class="search-filter-btn" :class="{ active: searchFilter === 'all' }" 
                                        @click="setSearchFilter('all')">All</button>
                                <button class="search-filter-btn" :class="{ active: searchFilter === 'staff' }" 
                                        @click="setSearchFilter('staff')">Staff</button>
                                <button class="search-filter-btn" :class="{ active: searchFilter === 'units' }" 
                                        @click="setSearchFilter('units')">Units</button>
                                <button class="search-filter-btn" :class="{ active: searchFilter === 'rotations' }" 
                                        @click="setSearchFilter('rotations')">Rotations</button>
                            </div>
                        </div>
                        
                        <div class="navbar-actions">
                            <div class="notification-badge">
                                <button class="btn btn-icon btn-secondary" @click="markAllNotificationsAsRead">
                                    <i class="fas fa-bell"></i>
                                    <span class="badge-count" v-if="unreadNotifications > 0">{{ unreadNotifications }}</span>
                                </button>
                            </div>
                            
                            <button class="btn btn-icon btn-secondary" @click="togglePermissionManager" 
                                    v-if="hasPermission('system', 'admin')">
                                <i class="fas fa-user-shield"></i>
                            </button>
                            
                            <button class="btn btn-icon btn-secondary" @click="showCommunicationsModal" 
                                    v-if="hasPermission('communications', 'create')">
                                <i class="fas fa-bullhorn"></i>
                            </button>
                            
                            <div class="user-menu">
                                <button class="user-menu-toggle" @click="toggleUserMenu">
                                    <div class="user-avatar">{{ getInitials(currentUser.full_name) }}</div>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                
                                <div class="user-menu-dropdown" v-if="userMenuOpen">
                                    <a href="#" class="user-menu-item" @click.prevent="showUserProfile">
                                        <i class="fas fa-user"></i>
                                        <span>Profile Settings</span>
                                    </a>
                                    <a href="#" class="user-menu-item" @click.prevent="showSystemSettingsModal" 
                                       v-if="hasPermission('system', 'read')">
                                        <i class="fas fa-cog"></i>
                                        <span>System Settings</span>
                                    </a>
                                    <a href="#" class="user-menu-item" @click.prevent="handleLogout">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>Logout</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Content Area -->
                <div class="content-area">
                    <!-- Breadcrumb Navigation -->
                    <div class="breadcrumb">
                        <div class="breadcrumb-item" @click="switchView('daily_operations')" style="cursor: pointer;">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </div>
                        <div class="breadcrumb-separator">/</div>
                        <div class="breadcrumb-item active">
                            {{ getCurrentTitle() }}
                        </div>
                    </div>

                    <!-- Daily Operations View -->
                    <div v-if="currentView === 'daily_operations'">
                        <!-- Quick Actions -->
                        <div class="quick-actions mb-6">
                            <div class="quick-action-btn" @click="showAddMedicalStaffModal" v-if="hasPermission('medical_staff', 'create')">
                                <i class="fas fa-user-plus text-success"></i>
                                Add Staff
                            </div>
                            <div class="quick-action-btn" @click="showAddOnCallModal" v-if="hasPermission('oncall_schedule', 'create')">
                                <i class="fas fa-phone-alt text-primary"></i>
                                Add On-call
                            </div>
                            <div class="quick-action-btn" @click="showAddLeaveRequestModal" v-if="hasPermission('leave_requests', 'create')">
                                <i class="fas fa-calendar-plus text-warning"></i>
                                Request Leave
                            </div>
                            <div class="quick-action-btn" @click="showQuickPlacementModal" v-if="hasPermission('placements', 'create')">
                                <i class="fas fa-user-md text-info"></i>
                                Quick Placement
                            </div>
                            <div class="quick-action-btn" @click="showCommunicationsModal" v-if="hasPermission('communications', 'create')">
                                <i class="fas fa-bullhorn text-danger"></i>
                                Post Update
                            </div>
                        </div>

                        <!-- Interactive Stats Overview -->
                        <div class="dashboard-grid-compact mb-6">
                            <div class="stat-card card-draggable" :class="{ 'card-dragging': draggingCard === 'totalStaff', 'card-pinned': pinnedCards.totalStaff }"
                                 draggable="true" @dragstart="startDrag($event, 'totalStaff')" @dragend="endDrag">
                                <div class="stat-icon primary">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <div class="stat-value">{{ stats.totalStaff }}</div>
                                            <div class="stat-label">Total Medical Staff</div>
                                            <div class="stat-change positive">+12% this month</div>
                                        </div>
                                        <button class="pin-btn" :class="{ pinned: pinnedCards.totalStaff }" @click="togglePinCard('totalStaff')">
                                            <i class="fas fa-thumbtack"></i>
                                        </button>
                                    </div>
                                    <div class="progress-bar mt-3">
                                        <div class="progress-fill" :style="{ width: '85%' }"></div>
                                    </div>
                                    <div class="progress-text">
                                        <span>Staff utilization</span>
                                        <span>85%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card card-draggable" :class="{ 'card-dragging': draggingCard === 'activeResidents', 'card-pinned': pinnedCards.activeResidents }"
                                 draggable="true" @dragstart="startDrag($event, 'activeResidents')" @dragend="endDrag">
                                <div class="stat-icon success">
                                    <i class="fas fa-user-graduate"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <div class="stat-value">{{ stats.activeResidents }}</div>
                                            <div class="stat-label">Active Residents</div>
                                            <div class="stat-change positive">+8% this quarter</div>
                                        </div>
                                        <button class="pin-btn" :class="{ pinned: pinnedCards.activeResidents }" @click="togglePinCard('activeResidents')">
                                            <i class="fas fa-thumbtack"></i>
                                        </button>
                                    </div>
                                    <div class="progress-bar mt-3 progress-success">
                                        <div class="progress-fill" :style="{ width: '92%' }"></div>
                                    </div>
                                    <div class="progress-text">
                                        <span>Rotation completion</span>
                                        <span>92%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card card-draggable" :class="{ 'card-dragging': draggingCard === 'attendings', 'card-pinned': pinnedCards.attendings }"
                                 draggable="true" @dragstart="startDrag($event, 'attendings')" @dragend="endDrag">
                                <div class="stat-icon warning">
                                    <i class="fas fa-stethoscope"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <div class="stat-value">{{ stats.attendings }}</div>
                                            <div class="stat-label">Attending Physicians</div>
                                            <div class="stat-change positive">+5% this year</div>
                                        </div>
                                        <button class="pin-btn" :class="{ pinned: pinnedCards.attendings }" @click="togglePinCard('attendings')">
                                            <i class="fas fa-thumbtack"></i>
                                        </button>
                                    </div>
                                    <div class="progress-bar mt-3 progress-warning">
                                        <div class="progress-fill" :style="{ width: '78%' }"></div>
                                    </div>
                                    <div class="progress-text">
                                        <span>On-call coverage</span>
                                        <span>78%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card card-draggable" :class="{ 'card-dragging': draggingCard === 'coverageAlerts', 'card-pinned': pinnedCards.coverageAlerts }"
                                 draggable="true" @dragstart="startDrag($event, 'coverageAlerts')" @dragend="endDrag">
                                <div class="stat-icon danger">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <div class="stat-value">{{ coverageAlerts.length }}</div>
                                            <div class="stat-label">Coverage Alerts</div>
                                            <div class="stat-change negative">Requires attention</div>
                                        </div>
                                        <button class="pin-btn" :class="{ pinned: pinnedCards.coverageAlerts }" @click="togglePinCard('coverageAlerts')">
                                            <i class="fas fa-thumbtack"></i>
                                        </button>
                                    </div>
                                    <div class="progress-bar mt-3 progress-danger">
                                        <div class="progress-fill" :style="{ width: '40%' }"></div>
                                    </div>
                                    <div class="progress-text">
                                        <span>Issue resolution</span>
                                        <span>40%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Two-column layout for alerts and on-call -->
                        <div class="card-grid-2 mb-6">
                            <div class="card card-draggable" :class="{ 'card-collapsed': collapsedCards.emergencyAlerts }"
                                 draggable="true" @dragstart="startDrag($event, 'emergencyAlertsCard')" @dragend="endDrag">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-exclamation-triangle text-danger"></i>
                                        <span>Emergency Alerts</span>
                                        <span class="badge badge-danger ml-2" v-if="emergencyAlerts.length > 0">
                                            {{ emergencyAlerts.length }}
                                        </span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="collapse-btn" @click="toggleCollapseCard('emergencyAlerts')">
                                            <i class="fas" :class="collapsedCards.emergencyAlerts ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" @click="dismissAllAlerts" v-if="emergencyAlerts.length > 0">
                                            <i class="fas fa-times"></i> Dismiss All
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content" v-if="!collapsedCards.emergencyAlerts">
                                    <div v-if="loading" class="loading-overlay">
                                        <div class="loading-spinner"></div>
                                    </div>
                                    <div v-else-if="emergencyAlerts.length === 0" class="empty-state">
                                        <i class="fas fa-check-circle empty-state-icon"></i>
                                        <div class="empty-state-title">No Emergency Alerts</div>
                                        <div class="empty-state-description">
                                            All systems are operating normally
                                        </div>
                                    </div>
                                    <div v-else class="activity-feed">
                                        <div v-for="alert in emergencyAlerts" :key="alert.id" class="activity-item">
                                            <div class="activity-icon bg-danger">
                                                <i class="fas fa-exclamation"></i>
                                            </div>
                                            <div class="activity-content">
                                                <div class="activity-text">{{ alert.message }}</div>
                                                <div class="activity-time">Priority: {{ alert.priority.toUpperCase() }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card card-draggable" :class="{ 'card-collapsed': collapsedCards.todaysOnCall }"
                                 draggable="true" @dragstart="startDrag($event, 'todaysOnCallCard')" @dragend="endDrag">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-phone-alt text-info"></i>
                                        <span>Today's On-call</span>
                                        <span class="updated-timestamp">
                                            <i class="fas fa-sync"></i> Updated {{ formatTimeAgo(lastUpdated.todaysOnCall) }}
                                        </span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="collapse-btn" @click="toggleCollapseCard('todaysOnCall')">
                                            <i class="fas" :class="collapsedCards.todaysOnCall ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline" @click="showAddOnCallModal" 
                                                v-if="hasPermission('oncall_schedule', 'create')">
                                            <i class="fas fa-plus"></i> Add
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content" v-if="!collapsedCards.todaysOnCall">
                                    <div v-if="loading" class="loading-overlay">
                                        <div class="loading-spinner"></div>
                                    </div>
                                    <div v-else-if="todaysOnCall.length === 0" class="empty-state">
                                        <i class="fas fa-phone-slash empty-state-icon"></i>
                                        <div class="empty-state-title">No On-call Scheduled</div>
                                        <div class="empty-state-description">
                                            No physicians are scheduled for on-call duty today
                                        </div>
                                        <button class="btn btn-primary mt-4" @click="showAddOnCallModal" v-if="hasPermission('oncall_schedule', 'create')">
                                            <i class="fas fa-plus"></i> Schedule On-call
                                        </button>
                                    </div>
                                    <div v-else class="activity-feed">
                                        <div v-for="schedule in todaysOnCall" :key="schedule.id" class="activity-item">
                                            <div class="activity-icon bg-info">
                                                <i class="fas fa-phone-alt"></i>
                                            </div>
                                            <div class="activity-content">
                                                <div class="activity-text">{{ getPhysicianName(schedule.primary_physician_id) }}</div>
                                                <div class="activity-time">{{ formatTimeRange(schedule.start_time, schedule.end_time) }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Coverage Alerts -->
                        <div class="card mb-6 card-draggable" :class="{ 'card-collapsed': collapsedCards.coverageAlerts }"
                             draggable="true" @dragstart="startDrag($event, 'coverageAlertsCard')" @dragend="endDrag">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-user-clock"></i>
                                    Coverage Alerts
                                    <span class="updated-timestamp">
                                        <i class="fas fa-sync"></i> Updated {{ formatTimeAgo(lastUpdated.coverageAlerts) }}
                                    </span>
                                </div>
                                <div class="flex gap-2">
                                    <button class="collapse-btn" @click="toggleCollapseCard('coverageAlerts')">
                                        <i class="fas" :class="collapsedCards.coverageAlerts ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
                                    </button>
                                    <button class="btn btn-sm btn-success" @click="showQuickPlacementModal" 
                                            v-if="hasPermission('placements', 'create')">
                                        <i class="fas fa-plus"></i> Quick Placement
                                    </button>
                                </div>
                            </div>
                            <div class="card-content" v-if="!collapsedCards.coverageAlerts">
                                <div v-if="loading" class="loading-overlay">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div v-else-if="coverageAlerts.length === 0" class="empty-state p-6">
                                    <i class="fas fa-check-circle empty-state-icon"></i>
                                    <div class="empty-state-title">All Units Properly Staffed</div>
                                    <div class="empty-state-description">
                                        All training units have adequate resident coverage
                                    </div>
                                </div>
                                <div v-else class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Training Unit</th>
                                                <th>Current Residents</th>
                                                <th>Capacity</th>
                                                <th>Status</th>
                                                <th>Progress</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="alert in coverageAlerts" :key="alert.id">
                                                <td>{{ alert.unit_name }}</td>
                                                <td>{{ alert.current }}</td>
                                                <td>{{ alert.capacity }}</td>
                                                <td>
                                                    <span class="badge" :class="alert.priority === 'high' ? 'status-critical' : 'status-busy'">
                                                        {{ alert.priority === 'high' ? 'Critical' : 'Warning' }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="progress-bar">
                                                        <div class="progress-fill" :class="alert.priority === 'high' ? 'progress-danger' : 'progress-warning'" 
                                                             :style="{ width: `${(alert.current / alert.capacity) * 100}%` }"></div>
                                                    </div>
                                                    <div class="progress-text">
                                                        <span>{{ Math.round((alert.current / alert.capacity) * 100) }}%</span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="action-dropdown">
                                                        <button class="btn btn-sm btn-secondary">
                                                            <i class="fas fa-ellipsis-v"></i>
                                                        </button>
                                                        <div class="action-menu">
                                                            <div class="action-menu-item" @click="quickAssignToUnit(alert)">
                                                                <i class="fas fa-user-plus"></i>
                                                                Assign Resident
                                                            </div>
                                                            <div class="action-menu-item" @click="viewUnitDetails(alert.unit_id)">
                                                                <i class="fas fa-eye"></i>
                                                                View Unit Details
                                                            </div>
                                                            <div class="action-menu-item text-danger" @click="dismissCoverageAlert(alert.id)">
                                                                <i class="fas fa-times"></i>
                                                                Dismiss Alert
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- 7-Day Schedule -->
                        <div class="card card-draggable" :class="{ 'card-collapsed': collapsedCards.sevenDaySchedule }"
                             draggable="true" @dragstart="startDrag($event, 'sevenDayScheduleCard')" @dragend="endDrag">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-calendar-week"></i>
                                    Next 7 Days Schedule
                                    <span class="updated-timestamp">
                                        <i class="fas fa-sync"></i> Updated {{ formatTimeAgo(lastUpdated.sevenDaySchedule) }}
                                    </span>
                                </div>
                                <button class="collapse-btn" @click="toggleCollapseCard('sevenDaySchedule')">
                                    <i class="fas" :class="collapsedCards.sevenDaySchedule ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
                                </button>
                            </div>
                            <div class="card-content p-4" v-if="!collapsedCards.sevenDaySchedule">
                                <div v-if="loading" class="loading-overlay">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div v-else class="grid grid-cols-7 gap-2">
                                    <div v-for="day in nextSevenDays" :key="day.date" class="text-center">
                                        <div class="p-3 rounded-lg" :class="getDayStatus(day)">
                                            <div class="font-medium">{{ formatDateShort(day.date) }}</div>
                                            <div v-if="day.schedule" class="text-xs mt-1">
                                                {{ getPhysicianName(day.schedule.primary_physician_id).split(' ')[0] }}
                                            </div>
                                            <div v-else class="text-xs mt-1 text-gray-500">
                                                Uncovered
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <div class="action-dropdown">
                                                <button class="btn btn-sm btn-secondary">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                                <div class="action-menu">
                                                    <div class="action-menu-item" @click="editOnCallSchedule(day)"
                                                            v-if="hasPermission('oncall_schedule', 'update')">
                                                        <i class="fas fa-edit"></i>
                                                        Edit Schedule
                                                    </div>
                                                    <div class="action-menu-item" @click="overrideOnCall({date: day.date})"
                                                            v-if="hasPermission('oncall_schedule', 'override')">
                                                        <i class="fas fa-exclamation-triangle"></i>
                                                        Override Schedule
                                                    </div>
                                                    <div class="action-menu-item" @click="viewScheduleDetails(day.date)">
                                                        <i class="fas fa-eye"></i>
                                                        View Details
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medical Staff View -->
                    <div v-if="currentView === 'medical_staff'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Medical Staff Management</h2>
                                <p class="text-muted">Manage all medical staff with comprehensive profiles</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddMedicalStaffModal" 
                                    v-if="hasPermission('medical_staff', 'create')">
                                <i class="fas fa-plus"></i> Add Medical Staff
                            </button>
                        </div>

                        <!-- Quick Actions -->
                        <div class="quick-actions mb-6">
                            <div class="quick-action-btn" @click="showAddMedicalStaffModal" v-if="hasPermission('medical_staff', 'create')">
                                <i class="fas fa-user-plus text-success"></i>
                                Add Staff
                            </div>
                            <div class="quick-action-btn" @click="showImportModal('medical_staff')" v-if="hasPermission('medical_staff', 'import')">
                                <i class="fas fa-upload text-primary"></i>
                                Import CSV
                            </div>
                            <div class="quick-action-btn" @click="exportStaffList" v-if="hasPermission('medical_staff', 'export')">
                                <i class="fas fa-download text-info"></i>
                                Export List
                            </div>
                            <div class="quick-action-btn" @click="sendBulkNotifications" v-if="hasPermission('medical_staff', 'notify')">
                                <i class="fas fa-bell text-warning"></i>
                                Notify All
                            </div>
                            <div class="quick-action-btn" @click="showStaffReport" v-if="hasPermission('medical_staff', 'report')">
                                <i class="fas fa-chart-bar text-danger"></i>
                                Generate Report
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="filter-bar mb-6">
                            <div class="filter-group">
                                <div class="filter-label">Search</div>
                                <input type="text" class="form-control form-control-sm" v-model="staffSearch" placeholder="Name, ID, or email...">
                            </div>
                            <div class="filter-group">
                                <div class="filter-label">Staff Type</div>
                                <select class="form-select form-select-sm" v-model="staffFilter.staff_type">
                                    <option value="">All Types</option>
                                    <option value="medical_resident">Medical Resident</option>
                                    <option value="attending_physician">Attending Physician</option>
                                    <option value="fellow">Fellow</option>
                                    <option value="nurse_practitioner">Nurse Practitioner</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <div class="filter-label">Employment Status</div>
                                <select class="form-select form-select-sm" v-model="staffFilter.employment_status">
                                    <option value="">All Statuses</option>
                                    <option value="active">Active</option>
                                    <option value="on_leave">On Leave</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="filter-actions">
                                <button class="btn btn-sm btn-secondary" @click="resetStaffFilters">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                                <button class="btn btn-sm btn-primary" @click="applyStaffFilters">
                                    <i class="fas fa-filter"></i> Apply
                                </button>
                            </div>
                        </div>

                        <!-- Staff Table -->
                        <div class="card">
                            <div v-if="loading" class="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                            <div v-else-if="filteredMedicalStaff.length === 0" class="empty-state p-6">
                                <i class="fas fa-user-md empty-state-icon"></i>
                                <div class="empty-state-title">No Medical Staff Found</div>
                                <div class="empty-state-description">
                                    Try adjusting your filters or add new medical staff to get started.
                                </div>
                                <button class="btn btn-primary mt-4" @click="showAddMedicalStaffModal" v-if="hasPermission('medical_staff', 'create')">
                                    <i class="fas fa-plus"></i> Add Medical Staff
                                </button>
                            </div>
                            <div v-else class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Staff Type</th>
                                            <th>Staff ID</th>
                                            <th>Department</th>
                                            <th>Status</th>
                                            <th>Last Active</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="staff in filteredMedicalStaff" :key="staff.id" @click="viewStaffDetails(staff)" style="cursor: pointer;">
                                            <td>
                                                <div class="flex items-center gap-3">
                                                    <div class="user-avatar">{{ getInitials(staff.full_name) }}</div>
                                                    <div>
                                                        <div class="font-medium">{{ staff.full_name }}</div>
                                                        <div class="text-sm text-gray-500">{{ staff.professional_email }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge" :class="getStaffTypeClass(staff.staff_type)">
                                                    {{ formatStaffType(staff.staff_type) }}
                                                </span>
                                            </td>
                                            <td>{{ staff.staff_id }}</td>
                                            <td>{{ staff.primary_clinic || 'Unassigned' }}</td>
                                            <td>
                                                <span class="badge" :class="staff.employment_status === 'active' ? 'status-available' : 'status-busy'">
                                                    {{ formatEmploymentStatus(staff.employment_status) }}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="updated-timestamp">
                                                    {{ formatTimeAgo(staff.last_activity) }}
                                                </span>
                                            </td>
                                            <td @click.stop>
                                                <div class="action-dropdown">
                                                    <button class="btn btn-sm btn-secondary">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </button>
                                                    <div class="action-menu">
                                                        <div class="action-menu-item" @click="viewStaffDetails(staff)">
                                                            <i class="fas fa-eye"></i>
                                                            View Profile
                                                        </div>
                                                        <div class="action-menu-item" @click="loadStaffDailyActivities(staff.id)">
                                                            <i class="fas fa-history"></i>
                                                            View Activity
                                                        </div>
                                                        <div class="action-menu-item" @click="editMedicalStaff(staff)"
                                                                v-if="hasPermission('medical_staff', 'update')">
                                                            <i class="fas fa-edit"></i>
                                                            Edit
                                                        </div>
                                                        <div class="action-menu-item text-danger" @click="deleteMedicalStaff(staff)"
                                                                v-if="hasPermission('medical_staff', 'delete')">
                                                            <i class="fas fa-trash"></i>
                                                            Delete
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- On-call Schedule View -->
                    <div v-if="currentView === 'oncall_schedule'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">On-call Schedule</h2>
                                <p class="text-muted">Manage physician on-call duties and emergency coverage</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddOnCallModal" 
                                    v-if="hasPermission('oncall_schedule', 'create')">
                                <i class="fas fa-plus"></i> Add Schedule
                            </button>
                        </div>

                        <!-- Schedule Table -->
                        <div class="card">
                            <div v-if="loading" class="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                            <div v-else-if="onCallSchedule.length === 0" class="empty-state p-6">
                                <i class="fas fa-phone-slash empty-state-icon"></i>
                                <div class="empty-state-title">No On-call Schedules</div>
                                <div class="empty-state-description">
                                    No on-call schedules have been created yet.
                                </div>
                                <button class="btn btn-primary mt-4" @click="showAddOnCallModal" v-if="hasPermission('oncall_schedule', 'create')">
                                    <i class="fas fa-plus"></i> Create Schedule
                                </button>
                            </div>
                            <div v-else class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Primary Physician</th>
                                            <th>Backup Physician</th>
                                            <th>Shift</th>
                                            <th>Coverage Notes</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="schedule in onCallSchedule" :key="schedule.id">
                                            <td>{{ formatDate(schedule.duty_date) }}</td>
                                            <td>{{ getPhysicianName(schedule.primary_physician_id) }}</td>
                                            <td>{{ schedule.backup_physician_id ? getPhysicianName(schedule.backup_physician_id) : 'None' }}</td>
                                            <td>{{ formatTimeRange(schedule.start_time, schedule.end_time) }}</td>
                                            <td class="max-w-xs truncate">{{ schedule.coverage_notes || 'None' }}</td>
                                            <td>
                                                <div class="action-dropdown">
                                                    <button class="btn btn-sm btn-secondary">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </button>
                                                    <div class="action-menu">
                                                        <div class="action-menu-item" @click="editOnCallSchedule({date: schedule.duty_date, schedule})"
                                                                v-if="hasPermission('oncall_schedule', 'update')">
                                                            <i class="fas fa-edit"></i>
                                                            Edit
                                                        </div>
                                                        <div class="action-menu-item" @click="overrideOnCall({date: schedule.duty_date})"
                                                                v-if="hasPermission('oncall_schedule', 'override')">
                                                            <i class="fas fa-exclamation-triangle"></i>
                                                            Override
                                                        </div>
                                                        <div class="action-menu-item text-danger" @click="deleteOnCallSchedule(schedule)"
                                                                v-if="hasPermission('oncall_schedule', 'delete')">
                                                            <i class="fas fa-trash"></i>
                                                            Delete
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Leave Requests View -->
                    <div v-if="currentView === 'leave_requests'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Leave Requests</h2>
                                <p class="text-muted">Review and approve leave requests with coverage management</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddLeaveRequestModal" 
                                    v-if="hasPermission('leave_requests', 'create')">
                                <i class="fas fa-plus"></i> Request Leave
                            </button>
                        </div>

                        <!-- Leave Requests Table -->
                        <div class="card">
                            <div v-if="loading" class="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                            <div v-else-if="leaveRequests.length === 0" class="empty-state p-6">
                                <i class="fas fa-calendar-check empty-state-icon"></i>
                                <div class="empty-state-title">No Leave Requests</div>
                                <div class="empty-state-description">
                                    No leave requests have been submitted yet.
                                </div>
                                <button class="btn btn-primary mt-4" @click="showAddLeaveRequestModal" v-if="hasPermission('leave_requests', 'create')">
                                    <i class="fas fa-plus"></i> Request Leave
                                </button>
                            </div>
                            <div v-else class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Staff Member</th>
                                            <th>Leave Type</th>
                                            <th>Dates</th>
                                            <th>Duration</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="request in leaveRequests" :key="request.id" @click="viewLeaveRequestDetails(request)" style="cursor: pointer;">
                                            <td>{{ getPhysicianName(request.staff_member_id) }}</td>
                                            <td>{{ request.leave_category || request.leave_type }}</td>
                                            <td>{{ formatDate(request.leave_start_date) }} - {{ formatDate(request.leave_end_date) }}</td>
                                            <td>{{ request.total_days || 'N/A' }} days</td>
                                            <td>
                                                <span class="badge" :class="request.status === 'approved' ? 'status-available' : 
                                                                           request.status === 'pending' ? 'status-busy' : 'status-critical'">
                                                    {{ request.status?.toUpperCase() || 'PENDING' }}
                                                </span>
                                            </td>
                                            <td @click.stop>
                                                <div class="action-dropdown">
                                                    <button class="btn btn-sm btn-secondary">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </button>
                                                    <div class="action-menu">
                                                        <div class="action-menu-item" @click="viewLeaveRequestDetails(request)">
                                                            <i class="fas fa-eye"></i>
                                                            View Details
                                                        </div>
                                                        <div class="action-menu-item" @click="approveLeaveRequest(request)"
                                                                v-if="hasPermission('leave_requests', 'approve') && request.status === 'pending'">
                                                            <i class="fas fa-check"></i>
                                                            Approve
                                                        </div>
                                                        <div class="action-menu-item text-danger" @click="rejectLeaveRequest(request)"
                                                                v-if="hasPermission('leave_requests', 'reject') && request.status === 'pending'">
                                                            <i class="fas fa-times"></i>
                                                            Reject
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Resident Rotations View -->
                    <div v-if="currentView === 'resident_rotations'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Resident Rotations</h2>
                                <p class="text-muted">Manage resident training rotations and assignments</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddRotationModal" 
                                    v-if="hasPermission('resident_rotations', 'create')">
                                <i class="fas fa-plus"></i> Add Rotation
                            </button>
                        </div>

                        <!-- Rotations Table -->
                        <div class="card">
                            <div v-if="loading" class="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                            <div v-else-if="filteredRotations.length === 0" class="empty-state p-6">
                                <i class="fas fa-calendar-alt empty-state-icon"></i>
                                <div class="empty-state-title">No Resident Rotations</div>
                                <div class="empty-state-description">
                                    No resident rotations have been created yet.
                                </div>
                                <button class="btn btn-primary mt-4" @click="showAddRotationModal" v-if="hasPermission('resident_rotations', 'create')">
                                    <i class="fas fa-plus"></i> Create Rotation
                                </button>
                            </div>
                            <div v-else class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Rotation ID</th>
                                            <th>Resident</th>
                                            <th>Training Unit</th>
                                            <th>Supervisor</th>
                                            <th>Duration</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="rotation in filteredRotations" :key="rotation.id">
                                            <td>{{ rotation.rotation_id }}</td>
                                            <td>{{ getResidentName(rotation.resident_id) }}</td>
                                            <td>{{ getTrainingUnitName(rotation.training_unit_id) }}</td>
                                            <td>{{ rotation.supervising_attending_id ? getAttendingName(rotation.supervising_attending_id) : 'Unassigned' }}</td>
                                            <td>{{ formatDate(rotation.rotation_start_date) }} - {{ formatDate(rotation.rotation_end_date) }}</td>
                                            <td>
                                                <span class="badge" :class="getRotationCategoryClass(rotation.rotation_category)">
                                                    {{ formatRotationCategory(rotation.rotation_category) }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-dropdown">
                                                    <button class="btn btn-sm btn-secondary">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </button>
                                                    <div class="action-menu">
                                                        <div class="action-menu-item" @click="editRotation(rotation)"
                                                                v-if="hasPermission('resident_rotations', 'update')">
                                                            <i class="fas fa-edit"></i>
                                                            Edit
                                                        </div>
                                                        <div class="action-menu-item" @click="extendRotation(rotation)"
                                                                v-if="hasPermission('resident_rotations', 'extend')">
                                                            <i class="fas fa-calendar-plus"></i>
                                                            Extend
                                                        </div>
                                                        <div class="action-menu-item text-danger" @click="deleteRotation(rotation)"
                                                                v-if="hasPermission('resident_rotations', 'delete')">
                                                            <i class="fas fa-trash"></i>
                                                            Delete
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Training Units View -->
                    <div v-if="currentView === 'training_units'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Training Units</h2>
                                <p class="text-muted">Manage training units and resident capacity allocation</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddTrainingUnitModal" 
                                    v-if="hasPermission('training_units', 'create')">
                                <i class="fas fa-plus"></i> Add Unit
                            </button>
                        </div>

                        <!-- Units Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div v-for="unit in trainingUnits" :key="unit.id" class="card" @dragover.prevent @drop="handleDrop($event, unit)">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-clinic-medical"></i>
                                        {{ unit.unit_name }}
                                    </div>
                                    <span class="badge" :class="unit.unit_status === 'active' ? 'status-available' : 'status-busy'">
                                        {{ unit.unit_status }}
                                    </span>
                                </div>
                                
                                <div class="mb-4">
                                    <p class="text-sm text-gray-600 mb-4">{{ unit.unit_description }}</p>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium">Resident Capacity</span>
                                        <span class="text-sm">{{ unit.current_residents || 0 }} / {{ unit.maximum_residents }}</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" :style="{width: `${((unit.current_residents || 0) / unit.maximum_residents) * 100}%`}"></div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-sm font-medium mb-2">Assigned Residents:</div>
                                    <div class="flex flex-wrap gap-2">
                                        <div v-for="resident in getAssignedResidents(unit.id)" :key="resident.id" 
                                             class="flex items-center gap-2 bg-gray-100 px-3 py-1 rounded-full text-sm">
                                            <span>{{ getInitials(resident.full_name) }}</span>
                                            <span>{{ resident.full_name.split(' ')[0] }}</span>
                                            <button class="text-gray-500 hover:text-red-500" @click="removePlacement(resident.id, unit.id)"
                                                    v-if="hasPermission('placements', 'delete')">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex gap-2">
                                    <button class="btn btn-sm btn-primary flex-1" @click="editTrainingUnit(unit)"
                                            v-if="hasPermission('training_units', 'update')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-success flex-1" @click="assignResidentsToUnit(unit)"
                                            v-if="hasPermission('placements', 'create')">
                                        <i class="fas fa-user-plus"></i> Assign
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Audit Logs View -->
                    <div v-if="currentView === 'audit_logs'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Audit Logs</h2>
                                <p class="text-muted">Track all system activities and permission changes</p>
                            </div>
                            <button class="btn btn-primary" @click="exportAuditLogs" v-if="hasPermission('audit', 'export')">
                                <i class="fas fa-download"></i> Export Logs
                            </button>
                        </div>

                        <!-- Audit Table -->
                        <div class="card">
                            <div v-if="loading" class="loading-overlay">
                                <div class="loading-spinner"></div>
                            </div>
                            <div v-else-if="auditLogs.length === 0" class="empty-state p-6">
                                <i class="fas fa-history empty-state-icon"></i>
                                <div class="empty-state-title">No Audit Logs</div>
                                <div class="empty-state-description">
                                    No system activities have been recorded yet.
                                </div>
                            </div>
                            <div v-else class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Timestamp</th>
                                            <th>User</th>
                                            <th>Action</th>
                                            <th>Resource</th>
                                            <th>Details</th>
                                            <th>Permission Level</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="log in auditLogs" :key="log.id">
                                            <td>{{ formatDateTime(log.timestamp) }}</td>
                                            <td>
                                                <div class="flex items-center gap-2">
                                                    <div class="user-avatar">{{ getInitials(log.user_name) }}</div>
                                                    <div>
                                                        <div class="font-medium">{{ log.user_name }}</div>
                                                        <div class="text-sm text-gray-500">{{ getUserRoleDisplay(log.user_role) }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="flex items-center gap-2">
                                                    <i :class="getAuditIcon(log.action)" class="text-blue-500"></i>
                                                    <span>{{ log.action }}</span>
                                                </div>
                                            </td>
                                            <td>{{ log.resource }}</td>
                                            <td class="max-w-xs truncate">{{ log.details }}</td>
                                            <td>
                                                <span class="badge" :class="log.permission_level === 'full' ? 'badge-admin-advanced' : 'badge-resident-advanced'">
                                                    {{ log.permission_level }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- System Settings View -->
                    <div v-if="currentView === 'system_settings'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">System Settings</h2>
                                <p class="text-muted">Configure system-wide settings and preferences</p>
                            </div>
                            <button class="btn btn-primary" @click="showSystemSettingsModal" 
                                    v-if="hasPermission('system', 'update')">
                                <i class="fas fa-edit"></i> Edit Settings
                            </button>
                        </div>

                        <!-- Settings Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-hospital"></i>
                                        Hospital Information
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="form-label">Hospital Name</label>
                                        <div class="form-control">{{ systemSettings.hospital_name }}</div>
                                    </div>
                                    <div>
                                        <label class="form-label">Department Name</label>
                                        <div class="form-control">{{ systemSettings.department_name }}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-shield-alt"></i>
                                        Security Settings
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" :checked="systemSettings.enable_audit_logging" disabled>
                                        <span class="form-check-label">Enable Audit Logging</span>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" :checked="systemSettings.require_mfa" disabled>
                                        <span class="form-check-label">Require MFA Authentication</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-users-cog"></i>
                                        System Configuration
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="form-label">Maximum Residents per Unit</label>
                                        <div class="form-control">{{ systemSettings.max_residents_per_unit }}</div>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" :checked="systemSettings.maintenance_mode" disabled>
                                        <span class="form-check-label">Maintenance Mode</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Communications View -->
                    <div v-if="currentView === 'communications'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Department Communications</h2>
                                <p class="text-muted">Announcements, capacity planning, and quick updates</p>
                            </div>
                            <button class="btn btn-primary" @click="showCommunicationsModal" 
                                    v-if="hasPermission('communications', 'create')">
                                <i class="fas fa-plus"></i> New Communication
                            </button>
                        </div>

                        <!-- Communications Feed -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2">
                                <div class="card mb-6">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-bullhorn"></i>
                                            Recent Announcements
                                        </div>
                                    </div>
                                    <div class="activity-feed">
                                        <div v-for="announcement in recentAnnouncements" :key="announcement.id" class="activity-item">
                                            <div class="activity-icon" :class="`bg-${getPriorityColor(announcement.priority_level)}`">
                                                <i class="fas fa-bullhorn"></i>
                                            </div>
                                            <div class="activity-content">
                                                <div class="font-medium mb-1">{{ announcement.announcement_title }}</div>
                                                <div class="activity-text">{{ truncateText(announcement.announcement_content, 100) }}</div>
                                                <div class="activity-time">
                                                    {{ formatDateTime(announcement.publish_start_date) }}  
                                                    <span class="badge badge-sm" :class="`badge-${getPriorityColor(announcement.priority_level)}`">
                                                        {{ announcement.priority_level }}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-comment-medical"></i>
                                            Quick Updates
                                        </div>
                                    </div>
                                    <div class="p-4">
                                        <div v-for="update in quickUpdates" :key="update.id" class="mb-4 p-3 bg-gray-50 rounded-lg">
                                            <div class="flex justify-between items-start mb-2">
                                                <div class="font-medium">{{ update.author }}</div>
                                                <span class="text-xs text-gray-500">{{ formatTimeAgo(update.timestamp) }}</span>
                                            </div>
                                            <p class="text-sm text-gray-700">{{ update.message }}</p>
                                            <div v-if="update.tags" class="flex gap-2 mt-2">
                                                <span v-for="tag in update.tags" :key="tag" class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded">
                                                    {{ tag }}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <div class="card mb-6">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-bed"></i>
                                            Today's Capacity
                                        </div>
                                        <span class="updated-timestamp">
                                            <i class="fas fa-sync"></i> Just now
                                        </span>
                                    </div>
                                    <div class="p-4">
                                        <div class="capacity-grid">
                                            <div class="capacity-card">
                                                <div class="capacity-card-header">
                                                    <div class="capacity-unit">Emergency Room</div>
                                                    <div class="capacity-status" :class="currentCapacity.er.status">
                                                        {{ currentCapacity.er.status }}
                                                    </div>
                                                </div>
                                                <div class="capacity-input-group">
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.er.current" min="0" :max="currentCapacity.er.max">
                                                    <span class="capacity-slash">/</span>
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.er.max" min="1">
                                                </div>
                                            </div>
                                            
                                            <div class="capacity-card">
                                                <div class="capacity-card-header">
                                                    <div class="capacity-unit">Pulmo ICU</div>
                                                    <div class="capacity-status" :class="currentCapacity.icu.status">
                                                        {{ currentCapacity.icu.status }}
                                                    </div>
                                                </div>
                                                <div class="capacity-input-group">
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.icu.current" min="0" :max="currentCapacity.icu.max">
                                                    <span class="capacity-slash">/</span>
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.icu.max" min="1">
                                                </div>
                                            </div>
                                            
                                            <div class="capacity-card">
                                                <div class="capacity-card-header">
                                                    <div class="capacity-unit">Ward Beds</div>
                                                    <div class="capacity-status" :class="currentCapacity.ward.status">
                                                        {{ currentCapacity.ward.status }}
                                                    </div>
                                                </div>
                                                <div class="capacity-input-group">
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.ward.current" min="0" :max="currentCapacity.ward.max">
                                                    <span class="capacity-slash">/</span>
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.ward.max" min="1">
                                                </div>
                                            </div>
                                            
                                            <div class="capacity-card">
                                                <div class="capacity-card-header">
                                                    <div class="capacity-unit">Step-down Unit</div>
                                                    <div class="capacity-status" :class="currentCapacity.stepdown.status">
                                                        {{ currentCapacity.stepdown.status }}
                                                    </div>
                                                </div>
                                                <div class="capacity-input-group">
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.stepdown.current" min="0" :max="currentCapacity.stepdown.max">
                                                    <span class="capacity-slash">/</span>
                                                    <input type="number" class="capacity-input" v-model="currentCapacity.stepdown.max" min="1">
                                                </div>
                                            </div>
                                        </div>
                                        <button class="btn btn-primary w-full mt-4" @click="updateCapacity" v-if="hasPermission('communications', 'update')">
                                            <i class="fas fa-save"></i> Update Capacity
                                        </button>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-chart-pie"></i>
                                            Capacity Overview
                                        </div>
                                    </div>
                                    <div class="p-4">
                                        <div v-for="unit in capacityOverview" :key="unit.name" class="mb-4">
                                            <div class="flex justify-between items-center mb-1">
                                                <span class="text-sm font-medium">{{ unit.name }}</span>
                                                <span class="text-sm">{{ unit.current }}/{{ unit.max }}</span>
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress-fill" :class="unit.status" :style="{ width: `${unit.percentage}%` }"></div>
                                            </div>
                                            <div class="progress-text">
                                                <span>{{ unit.percentage }}% occupied</span>
                                                <span class="text-xs" :class="`text-${unit.status}`">{{ unit.status }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Permission Manager Side Panel -->
                    <div class="permission-manager" :class="{ open: showPermissionManager }">
                        <div class="permission-header">
                            <div class="permission-title">
                                <i class="fas fa-user-shield"></i> Permission Manager
                            </div>
                            <div class="permission-subtitle">
                                Configure role-based access controls for all system resources
                            </div>
                        </div>
                        
                        <div class="permission-content">
                            <div v-for="(resource, resourceKey) in permissionResources" :key="resourceKey" 
                                 class="permission-resource">
                                <div class="permission-resource-header">
                                    <div class="permission-resource-title">
                                        {{ resource.name }}
                                        <div class="text-sm text-gray-600">{{ resource.description }}</div>
                                    </div>
                                    <span class="badge" :class="getResourcePermissionLevel(resourceKey) === 'full' ? 'status-available' : 
                                                               getResourcePermissionLevel(resourceKey) === 'write' ? 'status-busy' : 
                                                               getResourcePermissionLevel(resourceKey) === 'read' ? 'status-oncall' : 'status-critical'">
                                        {{ getResourcePermissionLevel(resourceKey) }}
                                    </span>
                                </div>
                                
                                <div class="permission-actions">
                                    <div v-for="action in resource.actions" :key="action" 
                                         class="permission-action" 
                                         :class="{ active: hasPermission(resourceKey, action) }"
                                         @click="togglePermission(currentUser.user_role, resourceKey, action)">
                                        <div class="permission-toggle">
                                            <i class="fas" :class="hasPermission(resourceKey, action) ? 'fa-check-circle' : 'fa-times-circle'"></i>
                                        </div>
                                        <div class="permission-action-label">
                                            {{ formatActionName(action) }}
                                            <div class="text-xs text-gray-500">{{ getPermissionDescription(resourceKey, action) }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="permission-footer">
                            <button class="btn btn-secondary" @click="showPermissionManager = false">
                                Cancel
                            </button>
                            <button class="btn btn-primary" @click="savePermissionChanges" :disabled="savingPermissions">
                                <span v-if="savingPermissions" class="loading"></span>
                                <span v-else>Save Changes</span>
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- ============ MODALS ============ -->
        
        <!-- Staff Details Modal -->
        <div v-if="staffDetailsModal.show" class="modal-overlay staff-details-modal">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user-md"></i>
                        Staff Profile
                    </div>
                    <button class="modal-close" @click="staffDetailsModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="staff-header">
                        <div class="staff-avatar-large">{{ getInitials(staffDetailsModal.staff.full_name) }}</div>
                        <div class="staff-info">
                            <div class="staff-name">{{ staffDetailsModal.staff.full_name }}</div>
                            <div class="staff-meta">
                                <div class="staff-meta-item">
                                    <i class="fas fa-id-badge"></i>
                                    {{ staffDetailsModal.staff.staff_id }}
                                </div>
                                <div class="staff-meta-item">
                                    <i class="fas fa-envelope"></i>
                                    {{ staffDetailsModal.staff.professional_email }}
                                </div>
                                <div class="staff-meta-item">
                                    <i class="fas fa-hospital"></i>
                                    {{ staffDetailsModal.staff.primary_clinic || 'Unassigned' }}
                                </div>
                            </div>
                            <div class="flex gap-4">
                                <span class="badge" :class="getStaffTypeClass(staffDetailsModal.staff.staff_type)">
                                    {{ formatStaffType(staffDetailsModal.staff.staff_type) }}
                                </span>
                                <span class="badge" :class="staffDetailsModal.staff.employment_status === 'active' ? 'status-available' : 'status-busy'">
                                    {{ formatEmploymentStatus(staffDetailsModal.staff.employment_status) }}
                                </span>
                            </div>
                            <div class="staff-stats">
                                <div class="staff-stat">
                                    <div class="staff-stat-value">{{ staffDetailsModal.stats.completedRotations || 0 }}</div>
                                    <div class="staff-stat-label">Rotations</div>
                                </div>
                                <div class="staff-stat">
                                    <div class="staff-stat-value">{{ staffDetailsModal.stats.oncallShifts || 0 }}</div>
                                    <div class="staff-stat-label">On-call</div>
                                </div>
                                <div class="staff-stat">
                                    <div class="staff-stat-value">{{ staffDetailsModal.stats.leaveDays || 0 }}</div>
                                    <div class="staff-stat-label">Leave Days</div>
                                </div>
                                <div class="staff-stat">
                                    <div class="staff-stat-value">{{ staffDetailsModal.stats.supervisionCount || 0 }}</div>
                                    <div class="staff-stat-label">Supervised</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-tabs">
                        <button class="modal-tab" :class="{ active: staffDetailsModal.activeTab === 'details' }" 
                                @click="staffDetailsModal.activeTab = 'details'">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                        <button class="modal-tab" :class="{ active: staffDetailsModal.activeTab === 'activity' }" 
                                @click="staffDetailsModal.activeTab = 'activity'">
                            <i class="fas fa-history"></i> Activity
                        </button>
                        <button class="modal-tab" :class="{ active: staffDetailsModal.activeTab === 'rotations' }" 
                                @click="staffDetailsModal.activeTab = 'rotations'">
                            <i class="fas fa-calendar-alt"></i> Rotations
                        </button>
                        <button class="modal-tab" :class="{ active: staffDetailsModal.activeTab === 'documents' }" 
                                @click="staffDetailsModal.activeTab = 'documents'">
                            <i class="fas fa-file-medical"></i> Documents
                        </button>
                    </div>

                    <!-- Details Tab -->
                    <div v-if="staffDetailsModal.activeTab === 'details'" class="modal-tab-content active">
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="form-group">
                                <label class="form-label">Date of Birth</label>
                                <div class="form-control">{{ staffDetailsModal.staff.date_of_birth || 'N/A' }}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Medical License</label>
                                <div class="form-control">{{ staffDetailsModal.staff.medical_license || 'N/A' }}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Specialization</label>
                                <div class="form-control">{{ staffDetailsModal.staff.specialization || 'N/A' }}</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Years of Experience</label>
                                <div class="form-control">{{ staffDetailsModal.staff.years_experience || 'N/A' }}</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Biography</label>
                            <div class="form-control" style="min-height: 100px;">
                                {{ staffDetailsModal.staff.biography || 'No biography available.' }}
                            </div>
                        </div>
                    </div>

                    <!-- Activity Tab -->
                    <div v-if="staffDetailsModal.activeTab === 'activity'" class="modal-tab-content active">
                        <div class="activity-timeline">
                            <div v-for="activity in staffDetailsModal.activity" :key="activity.id" class="timeline-item">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="activity-text">{{ activity.description }}</div>
                                    <div class="timeline-time">{{ formatDateTime(activity.timestamp) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rotations Tab -->
                    <div v-if="staffDetailsModal.activeTab === 'rotations'" class="modal-tab-content active">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Rotation</th>
                                        <th>Unit</th>
                                        <th>Duration</th>
                                        <th>Status</th>
                                        <th>Evaluation</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="rotation in staffDetailsModal.rotations" :key="rotation.id">
                                        <td>{{ rotation.rotation_id }}</td>
                                        <td>{{ getTrainingUnitName(rotation.training_unit_id) }}</td>
                                        <td>{{ formatDate(rotation.rotation_start_date) }} - {{ formatDate(rotation.rotation_end_date) }}</td>
                                        <td>
                                            <span class="badge" :class="getRotationCategoryClass(rotation.rotation_category)">
                                                {{ formatRotationCategory(rotation.rotation_category) }}
                                            </span>
                                        </td>
                                        <td>
                                            <div class="progress-bar">
                                                <div class="progress-fill" :style="{ width: `${rotation.evaluation_score || 0}%` }"></div>
                                            </div>
                                            <div class="progress-text">
                                                <span>{{ rotation.evaluation_score || 0 }}%</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Documents Tab -->
                    <div v-if="staffDetailsModal.activeTab === 'documents'" class="modal-tab-content active">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="card" v-for="doc in staffDetailsModal.documents" :key="doc.id">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas" :class="getDocumentIcon(doc.type)"></i>
                                        {{ doc.name }}
                                    </div>
                                </div>
                                <div class="p-3">
                                    <p class="text-sm text-gray-600 mb-2">{{ doc.description }}</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-500">{{ formatDate(doc.upload_date) }}</span>
                                        <button class="btn btn-sm btn-primary">
                                            <i class="fas fa-download"></i> Download
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="staffDetailsModal.show = false">Close</button>
                    <button class="btn btn-primary" @click="editMedicalStaff(staffDetailsModal.staff)"
                            v-if="hasPermission('medical_staff', 'update')">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Medical Staff Modal -->
        <div v-if="medicalStaffModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user-md"></i>
                        {{ medicalStaffModal.mode === 'add' ? 'Add Medical Staff' : 'Edit Medical Staff' }}
                    </div>
                    <button class="modal-close" @click="medicalStaffModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-id-card"></i>
                            Basic Information
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" v-model="medicalStaffModal.form.full_name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Staff Type *</label>
                                <select class="form-select" v-model="medicalStaffModal.form.staff_type">
                                    <option value="medical_resident">Medical Resident</option>
                                    <option value="attending_physician">Attending Physician</option>
                                    <option value="fellow">Fellow</option>
                                    <option value="nurse_practitioner">Nurse Practitioner</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Staff ID</label>
                                <input type="text" class="form-control" v-model="medicalStaffModal.form.staff_id">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Employment Status</label>
                                <select class="form-select" v-model="medicalStaffModal.form.employment_status">
                                    <option value="active">Active</option>
                                    <option value="on_leave">On Leave</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Professional Email</label>
                                <input type="email" class="form-control" v-model="medicalStaffModal.form.professional_email">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Primary Clinic/Unit</label>
                                <input type="text" class="form-control" v-model="medicalStaffModal.form.primary_clinic">
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section" v-if="medicalStaffModal.form.staff_type === 'medical_resident'">
                        <div class="modal-section-title">
                            <i class="fas fa-graduation-cap"></i>
                            Resident Details
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Resident Category</label>
                                <select class="form-select" v-model="medicalStaffModal.form.resident_category">
                                    <option value="department_internal">Department Internal</option>
                                    <option value="rotating_other_dept">Rotating Other Dept</option>
                                    <option value="pgy1">PGY-1</option>
                                    <option value="pgy2">PGY-2</option>
                                    <option value="pgy3">PGY-3</option>
                                    <option value="pgy4">PGY-4</option>
                                    <option value="pgy5">PGY-5</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Training Year</label>
                                <input type="number" class="form-control" v-model="medicalStaffModal.form.training_year" min="2020" max="2030">
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-user-shield"></i>
                            Permissions
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="medicalStaffModal.form.can_supervise_residents">
                                <span class="form-check-label">Can Supervise Residents</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="medicalStaffModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveMedicalStaff" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ medicalStaffModal.mode === 'add' ? 'Add Staff' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit On-call Schedule Modal -->
        <div v-if="onCallModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-phone-alt"></i>
                        {{ onCallModal.mode === 'add' ? 'Add On-call Schedule' : 'Edit On-call Schedule' }}
                    </div>
                    <button class="modal-close" @click="onCallModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-calendar"></i>
                            Schedule Details
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Duty Date *</label>
                                <input type="date" class="form-control" v-model="onCallModal.form.duty_date">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Shift Type</label>
                                <select class="form-select" v-model="onCallModal.form.shift_type">
                                    <option value="backup_call">Backup Call</option>
                                    <option value="primary_call">Primary Call</option>
                                    <option value="emergency_call">Emergency Call</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Start Time</label>
                                <input type="time" class="form-control" v-model="onCallModal.form.start_time">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Time</label>
                                <input type="time" class="form-control" v-model="onCallModal.form.end_time">
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-user-md"></i>
                            Physician Assignment
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Primary Physician *</label>
                                <select class="form-select" v-model="onCallModal.form.primary_physician_id">
                                    <option value="">Select Physician</option>
                                    <option v-for="physician in availablePhysicians" :key="physician.id" :value="physician.id">
                                        {{ physician.full_name }} ({{ formatStaffType(physician.staff_type) }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Backup Physician</label>
                                <select class="form-select" v-model="onCallModal.form.backup_physician_id">
                                    <option value="">Select Backup Physician</option>
                                    <option v-for="physician in availablePhysicians" :key="physician.id" :value="physician.id">
                                        {{ physician.full_name }} ({{ formatStaffType(physician.staff_type) }})
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-sticky-note"></i>
                            Additional Information
                        </div>
                        <div class="form-group">
                            <label class="form-label">Coverage Notes</label>
                            <textarea class="form-control" v-model="onCallModal.form.coverage_notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="onCallModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveOnCallSchedule" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ onCallModal.mode === 'add' ? 'Add Schedule' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Training Unit Modal -->
        <div v-if="trainingUnitModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-clinic-medical"></i>
                        {{ trainingUnitModal.mode === 'add' ? 'Add Training Unit' : 'Edit Training Unit' }}
                    </div>
                    <button class="modal-close" @click="trainingUnitModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-info-circle"></i>
                            Unit Information
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Unit Name *</label>
                                <input type="text" class="form-control" v-model="trainingUnitModal.form.unit_name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unit Code</label>
                                <input type="text" class="form-control" v-model="trainingUnitModal.form.unit_code">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <select class="form-select" v-model="trainingUnitModal.form.department_name">
                                    <option value="Pulmonology">Pulmonology</option>
                                    <option value="ICU">ICU</option>
                                    <option value="Cardiology">Cardiology</option>
                                    <option value="Emergency">Emergency Medicine</option>
                                    <option value="Surgery">Surgery</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Specialty</label>
                                <input type="text" class="form-control" v-model="trainingUnitModal.form.specialty">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Maximum Residents</label>
                                <input type="number" class="form-control" v-model="trainingUnitModal.form.maximum_residents" min="1" max="50">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Residents</label>
                                <input type="number" class="form-control" v-model="trainingUnitModal.form.current_residents" min="0" 
                                       :max="trainingUnitModal.form.maximum_residents">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unit Status</label>
                                <select class="form-select" v-model="trainingUnitModal.form.unit_status">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="maintenance">Maintenance</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" v-model="trainingUnitModal.form.unit_description" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="trainingUnitModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveTrainingUnit" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ trainingUnitModal.mode === 'add' ? 'Add Unit' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Rotation Modal -->
        <div v-if="rotationModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-calendar-alt"></i>
                        {{ rotationModal.mode === 'add' ? 'Add Resident Rotation' : 'Edit Rotation' }}
                    </div>
                    <button class="modal-close" @click="rotationModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-info-circle"></i>
                            Basic Information
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Rotation ID *</label>
                                <input type="text" class="form-control" v-model="rotationModal.form.rotation_id">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Resident *</label>
                                <select class="form-select" v-model="rotationModal.form.resident_id">
                                    <option value="">Select Resident</option>
                                    <option v-for="resident in medicalStaff.filter(s => s.staff_type === 'medical_resident')" 
                                            :key="resident.id" :value="resident.id">
                                        {{ resident.full_name }} ({{ resident.staff_id }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Training Unit *</label>
                                <select class="form-select" v-model="rotationModal.form.training_unit_id">
                                    <option value="">Select Unit</option>
                                    <option v-for="unit in trainingUnits" :key="unit.id" :value="unit.id">
                                        {{ unit.unit_name }} ({{ unit.specialty }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Supervising Attending</label>
                                <select class="form-select" v-model="rotationModal.form.supervising_attending_id">
                                    <option value="">Select Attending</option>
                                    <option v-for="attending in availableAttendings" :key="attending.id" :value="attending.id">
                                        {{ attending.full_name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-calendar"></i>
                            Schedule
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Start Date *</label>
                                <input type="date" class="form-control" v-model="rotationModal.form.rotation_start_date">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Date *</label>
                                <input type="date" class="form-control" v-model="rotationModal.form.rotation_end_date">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Rotation Category</label>
                                <select class="form-select" v-model="rotationModal.form.rotation_category">
                                    <option value="clinical_rotation">Clinical Rotation</option>
                                    <option value="elective_rotation">Elective Rotation</option>
                                    <option value="research_rotation">Research</option>
                                    <option value="vacation_rotation">Vacation</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" v-model="rotationModal.form.rotation_status">
                                    <option value="scheduled">Scheduled</option>
                                    <option value="active">Active</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-sticky-note"></i>
                            Notes & Evaluation
                        </div>
                        <div class="form-group">
                            <label class="form-label">Clinical Notes</label>
                            <textarea class="form-control" v-model="rotationModal.form.clinical_notes" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Supervisor Evaluation</label>
                            <textarea class="form-control" v-model="rotationModal.form.supervisor_evaluation" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="rotationModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveRotation" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ rotationModal.mode === 'add' ? 'Create Rotation' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Placement Modal -->
        <div v-if="quickPlacementModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user-plus"></i> Quick Placement
                    </div>
                    <button class="modal-close" @click="quickPlacementModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-user-md"></i>
                            Placement Details
                        </div>
                        <div class="form-group">
                            <label class="form-label">Select Resident</label>
                            <select class="form-select" v-model="quickPlacementModal.form.resident_id">
                                <option value="">Choose a resident</option>
                                <option v-for="resident in availableResidents" :key="resident.id" :value="resident.id">
                                    {{ resident.full_name }} - {{ resident.staff_id }}
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Select Training Unit</label>
                            <select class="form-select" v-model="quickPlacementModal.form.unit_id">
                                <option value="">Choose a unit</option>
                                <option v-for="unit in activeTrainingUnits" :key="unit.id" :value="unit.id">
                                    {{ unit.unit_name }} ({{ unit.current_residents }}/{{ unit.maximum_residents }})
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duration (weeks)</label>
                            <select class="form-select" v-model="quickPlacementModal.form.duration">
                                <option value="4">4 weeks (1 month)</option>
                                <option value="8">8 weeks (2 months)</option>
                                <option value="12">12 weeks (3 months)</option>
                                <option value="16">16 weeks (4 months)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="quickPlacementModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveQuickPlacement" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>Place Resident</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Communications Modal -->
        <div v-if="communicationsModal.show" class="modal-overlay">
            <div class="modal-container modal-wide">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-comments"></i>
                        Department Communications
                    </div>
                    <button class="modal-close" @click="communicationsModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-tabs">
                        <button class="modal-tab" :class="{ active: communicationsModal.activeTab === 'announcement' }" 
                                @click="communicationsModal.activeTab = 'announcement'">
                            <i class="fas fa-bullhorn"></i> Announcement
                        </button>
                        <button class="modal-tab" :class="{ active: communicationsModal.activeTab === 'capacity' }" 
                                @click="communicationsModal.activeTab = 'capacity'">
                            <i class="fas fa-bed"></i> Capacity Planning
                        </button>
                        <button class="modal-tab" :class="{ active: communicationsModal.activeTab === 'quick' }" 
                                @click="communicationsModal.activeTab = 'quick'">
                            <i class="fas fa-comment-medical"></i> Quick Update
                        </button>
                    </div>

                    <!-- Announcement Tab -->
                    <div v-if="communicationsModal.activeTab === 'announcement'" class="modal-tab-content active">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-edit"></i>
                                Announcement Details
                            </div>
                            <div class="form-group">
                                <label class="form-label">Title *</label>
                                <input type="text" class="form-control" v-model="communicationsModal.form.announcement_title">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Content *</label>
                                <textarea class="form-control" v-model="communicationsModal.form.announcement_content" rows="6"></textarea>
                            </div>
                        </div>
                        
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-cog"></i>
                                Settings
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Publish Date *</label>
                                    <input type="date" class="form-control" v-model="communicationsModal.form.publish_start_date">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Expiry Date</label>
                                    <input type="date" class="form-control" v-model="communicationsModal.form.publish_end_date">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Priority Level</label>
                                    <select class="form-select" v-model="communicationsModal.form.priority_level">
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Target Audience</label>
                                    <select class="form-select" v-model="communicationsModal.form.target_audience">
                                        <option value="all">All Staff</option>
                                        <option value="residents">Residents Only</option>
                                        <option value="attendings">Attending Physicians</option>
                                        <option value="nursing">Nursing Staff</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Capacity Planning Tab -->
                    <div v-if="communicationsModal.activeTab === 'capacity'" class="modal-tab-content active">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-hospital"></i>
                                Daily Capacity Planning
                            </div>
                            <p class="text-sm text-gray-600 mb-4">Set expected patient numbers for today</p>
                            
                            <div class="capacity-grid">
                                <div class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">Emergency Room</div>
                                        <div class="capacity-status" :class="getCapacityStatus(communicationsModal.capacity.er)">
                                            {{ getCapacityStatus(communicationsModal.capacity.er) }}
                                        </div>
                                    </div>
                                    <div class="capacity-input-group">
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.er.current" 
                                               placeholder="Current" min="0" :max="communicationsModal.capacity.er.max">
                                        <span class="capacity-slash">/</span>
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.er.max" 
                                               placeholder="Capacity" min="1">
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control form-control-sm" 
                                               v-model="communicationsModal.capacity.er.notes" placeholder="Notes (e.g., 'High flu season')">
                                    </div>
                                </div>
                                
                                <div class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">Pulmo ICU</div>
                                        <div class="capacity-status" :class="getCapacityStatus(communicationsModal.capacity.icu)">
                                            {{ getCapacityStatus(communicationsModal.capacity.icu) }}
                                        </div>
                                    </div>
                                    <div class="capacity-input-group">
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.icu.current" 
                                               placeholder="Current" min="0" :max="communicationsModal.capacity.icu.max">
                                        <span class="capacity-slash">/</span>
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.icu.max" 
                                               placeholder="Capacity" min="1">
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control form-control-sm" 
                                               v-model="communicationsModal.capacity.icu.notes" placeholder="Notes">
                                    </div>
                                </div>
                                
                                <div class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">Ward Beds</div>
                                        <div class="capacity-status" :class="getCapacityStatus(communicationsModal.capacity.ward)">
                                            {{ getCapacityStatus(communicationsModal.capacity.ward) }}
                                        </div>
                                    </div>
                                    <div class="capacity-input-group">
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.ward.current" 
                                               placeholder="Current" min="0" :max="communicationsModal.capacity.ward.max">
                                        <span class="capacity-slash">/</span>
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.ward.max" 
                                               placeholder="Capacity" min="1">
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control form-control-sm" 
                                               v-model="communicationsModal.capacity.ward.notes" placeholder="Notes">
                                    </div>
                                </div>
                                
                                <div class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">Step-down Unit</div>
                                        <div class="capacity-status" :class="getCapacityStatus(communicationsModal.capacity.stepdown)">
                                            {{ getCapacityStatus(communicationsModal.capacity.stepdown) }}
                                        </div>
                                    </div>
                                    <div class="capacity-input-group">
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.stepdown.current" 
                                               placeholder="Current" min="0" :max="communicationsModal.capacity.stepdown.max">
                                        <span class="capacity-slash">/</span>
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.stepdown.max" 
                                               placeholder="Capacity" min="1">
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control form-control-sm" 
                                               v-model="communicationsModal.capacity.stepdown.notes" placeholder="Notes">
                                    </div>
                                </div>
                                
                                <div class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">Outpatient Clinic</div>
                                        <div class="capacity-status" :class="getCapacityStatus(communicationsModal.capacity.clinic)">
                                            {{ getCapacityStatus(communicationsModal.capacity.clinic) }}
                                        </div>
                                    </div>
                                    <div class="capacity-input-group">
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.clinic.current" 
                                               placeholder="Expected" min="0">
                                        <span class="capacity-slash">/</span>
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.clinic.max" 
                                               placeholder="Appointments" min="1">
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control form-control-sm" 
                                               v-model="communicationsModal.capacity.clinic.notes" placeholder="Notes">
                                    </div>
                                </div>
                                
                                <div class="capacity-card">
                                    <div class="capacity-card-header">
                                        <div class="capacity-unit">Bronchoscopy Suite</div>
                                        <div class="capacity-status" :class="getCapacityStatus(communicationsModal.capacity.bronch)">
                                            {{ getCapacityStatus(communicationsModal.capacity.bronch) }}
                                        </div>
                                    </div>
                                    <div class="capacity-input-group">
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.bronch.current" 
                                               placeholder="Scheduled" min="0">
                                        <span class="capacity-slash">/</span>
                                        <input type="number" class="capacity-input" v-model="communicationsModal.capacity.bronch.max" 
                                               placeholder="Capacity" min="1">
                                    </div>
                                    <div class="mt-2">
                                        <input type="text" class="form-control form-control-sm" 
                                               v-model="communicationsModal.capacity.bronch.notes" placeholder="Notes">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group mt-4">
                                <label class="form-label">Overall Notes & Alerts</label>
                                <textarea class="form-control" v-model="communicationsModal.capacity.overall_notes" rows="3" 
                                          placeholder="Add any additional notes or alerts for the department..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Update Tab -->
                    <div v-if="communicationsModal.activeTab === 'quick'" class="modal-tab-content active">
                        <div class="modal-section">
                            <div class="modal-section-title">
                                <i class="fas fa-comment-medical"></i>
                                Quick Status Update
                            </div>
                            <div class="form-group">
                                <label class="form-label">Message *</label>
                                <textarea class="form-control" v-model="communicationsModal.quickUpdate.message" rows="4" 
                                          placeholder="What's the latest update? (e.g., 'CT scanner maintenance until 2 PM', 'New guideline for asthma management available')"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Priority</label>
                                    <select class="form-select" v-model="communicationsModal.quickUpdate.priority">
                                        <option value="info">Information</option>
                                        <option value="warning">Warning</option>
                                        <option value="alert">Alert</option>
                                        <option value="update">Update</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Expires In</label>
                                    <select class="form-select" v-model="communicationsModal.quickUpdate.expires">
                                        <option value="1">1 hour</option>
                                        <option value="4">4 hours</option>
                                        <option value="8">8 hours</option>
                                        <option value="24">24 hours</option>
                                        <option value="168">1 week</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tags (comma separated)</label>
                                <input type="text" class="form-control" v-model="communicationsModal.quickUpdate.tags" 
                                       placeholder="equipment, guidelines, staffing, maintenance">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="communicationsModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveCommunication" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>
                            <i class="fas" :class="getCommunicationIcon(communicationsModal.activeTab)"></i>
                            {{ getCommunicationButtonText(communicationsModal.activeTab) }}
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Leave Request Details Modal -->
        <div v-if="leaveDetailsModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-calendar-check"></i>
                        Leave Request Details
                    </div>
                    <button class="modal-close" @click="leaveDetailsModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="leave-details-view">
                        <div class="leave-info-grid">
                            <div class="leave-info-item">
                                <div class="leave-info-label">Staff Member</div>
                                <div class="leave-info-value">{{ getPhysicianName(leaveDetailsModal.request.staff_member_id) }}</div>
                            </div>
                            <div class="leave-info-item">
                                <div class="leave-info-label">Leave Type</div>
                                <div class="leave-info-value">{{ leaveDetailsModal.request.leave_type }}</div>
                            </div>
                            <div class="leave-info-item">
                                <div class="leave-info-label">Duration</div>
                                <div class="leave-info-value">{{ leaveDetailsModal.request.total_days }} days</div>
                            </div>
                            <div class="leave-info-item">
                                <div class="leave-info-label">Status</div>
                                <div class="leave-info-value">
                                    <span class="badge" :class="leaveDetailsModal.request.status === 'approved' ? 'status-available' : 
                                                               leaveDetailsModal.request.status === 'pending' ? 'status-busy' : 'status-critical'">
                                        {{ leaveDetailsModal.request.status?.toUpperCase() || 'PENDING' }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="leave-info-label">Dates</div>
                            <div class="leave-info-value">
                                {{ formatDate(leaveDetailsModal.request.leave_start_date) }} to {{ formatDate(leaveDetailsModal.request.leave_end_date) }}
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="leave-info-label">Reason</div>
                            <div class="form-control" style="min-height: 80px;">
                                {{ leaveDetailsModal.request.reason || 'No reason provided.' }}
                            </div>
                        </div>
                        
                        <div v-if="leaveDetailsModal.request.approver_notes" class="mb-4">
                            <div class="leave-info-label">Approver Notes</div>
                            <div class="form-control" style="min-height: 60px;">
                                {{ leaveDetailsModal.request.approver_notes }}
                            </div>
                        </div>
                        
                        <div class="leave-timeline">
                            <div class="timeline-status" :class="leaveDetailsModal.request.created_at ? 'completed' : ''">
                                <div class="timeline-dot-small"></div>
                                <div class="timeline-text">Request Submitted</div>
                                <div class="timeline-date">{{ formatDateTime(leaveDetailsModal.request.created_at) }}</div>
                            </div>
                            
                            <div class="timeline-status" :class="leaveDetailsModal.request.reviewed_at ? 'completed' : 
                                                                leaveDetailsModal.request.status === 'pending' ? 'current' : ''">
                                <div class="timeline-dot-small"></div>
                                <div class="timeline-text">Under Review</div>
                                <div class="timeline-date" v-if="leaveDetailsModal.request.reviewed_at">
                                    {{ formatDateTime(leaveDetailsModal.request.reviewed_at) }}
                                </div>
                            </div>
                            
                            <div class="timeline-status" :class="leaveDetailsModal.request.status === 'approved' ? 'completed' : 
                                                                leaveDetailsModal.request.status === 'rejected' ? 'completed' : ''">
                                <div class="timeline-dot-small"></div>
                                <div class="timeline-text">{{ leaveDetailsModal.request.status === 'approved' ? 'Approved' : 
                                                              leaveDetailsModal.request.status === 'rejected' ? 'Rejected' : 'Decision' }}</div>
                                <div class="timeline-date" v-if="leaveDetailsModal.request.decision_date">
                                    {{ formatDateTime(leaveDetailsModal.request.decision_date) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="leaveDetailsModal.show = false">Close</button>
                    <div v-if="hasPermission('leave_requests', 'approve') && leaveDetailsModal.request.status === 'pending'">
                        <button class="btn btn-success" @click="approveLeaveRequest(leaveDetailsModal.request)">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="btn btn-danger" @click="rejectLeaveRequest(leaveDetailsModal.request)">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add/Edit Leave Request Modal -->
        <div v-if="leaveRequestModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-calendar-check"></i>
                        {{ leaveRequestModal.mode === 'add' ? 'Request Leave' : 'Review Leave Request' }}
                    </div>
                    <button class="modal-close" @click="leaveRequestModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div v-if="leaveRequestModal.mode === 'review'" class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-info-circle"></i>
                            Request Information
                        </div>
                        <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                            <div class="text-sm font-medium">Request Submitted by: {{ leaveRequestModal.request?.staff_name || 'Unknown' }}</div>
                            <div class="text-sm text-gray-600">Submitted on: {{ formatDateTime(leaveRequestModal.request?.created_at) }}</div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-calendar-alt"></i>
                            Leave Details
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Start Date *</label>
                                <input type="date" class="form-control" v-model="leaveRequestModal.form.start_date" 
                                       :disabled="leaveRequestModal.mode === 'review'">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Date *</label>
                                <input type="date" class="form-control" v-model="leaveRequestModal.form.end_date"
                                       :disabled="leaveRequestModal.mode === 'review'">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Leave Type</label>
                                <select class="form-select" v-model="leaveRequestModal.form.leave_type"
                                        :disabled="leaveRequestModal.mode === 'review'">
                                    <option value="vacation">Vacation</option>
                                    <option value="sick_leave">Sick Leave</option>
                                    <option value="conference">Conference</option>
                                    <option value="personal">Personal</option>
                                    <option value="maternity_paternity">Maternity/Paternity</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" v-model="leaveRequestModal.form.status"
                                        :disabled="!hasPermission('leave_requests', 'update')">
                                    <option value="pending">Pending</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Reason</label>
                            <textarea class="form-control" v-model="leaveRequestModal.form.reason" rows="3"
                                    :disabled="leaveRequestModal.mode === 'review'"></textarea>
                        </div>
                    </div>
                    
                    <div v-if="leaveRequestModal.mode === 'review'" class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-edit"></i>
                            Approver Notes
                        </div>
                        <div class="form-group">
                            <textarea class="form-control" v-model="leaveRequestModal.form.approver_notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="leaveRequestModal.show = false">Cancel</button>
                    <div v-if="leaveRequestModal.mode === 'review'" class="flex gap-2">
                        <button class="btn btn-success" @click="approveLeaveRequest(leaveRequestModal.request)"
                                v-if="hasPermission('leave_requests', 'approve') && leaveRequestModal.form.status === 'pending'">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="btn btn-danger" @click="rejectLeaveRequest(leaveRequestModal.request)"
                                v-if="hasPermission('leave_requests', 'reject') && leaveRequestModal.form.status === 'pending'">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                    <button v-else class="btn btn-primary" @click="saveLeaveRequest" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>Submit Request</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- System Settings Modal -->
        <div v-if="systemSettingsModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-cog"></i> System Settings
                    </div>
                    <button class="modal-close" @click="systemSettingsModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-hospital"></i>
                            Hospital Information
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Hospital Name</label>
                                <input type="text" class="form-control" v-model="systemSettingsModal.form.hospital_name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department Name</label>
                                <input type="text" class="form-control" v-model="systemSettingsModal.form.department_name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Max Residents per Unit</label>
                                <input type="number" class="form-control" v-model="systemSettingsModal.form.max_residents_per_unit" min="1" max="50">
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-shield-alt"></i>
                            Security Settings
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="systemSettingsModal.form.enable_audit_logging">
                                <span class="form-check-label">Enable Audit Logging</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="systemSettingsModal.form.require_mfa">
                                <span class="form-check-label">Require MFA Authentication</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="systemSettingsModal.form.maintenance_mode">
                                <span class="form-check-label">Maintenance Mode</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="systemSettingsModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveSystemSettings" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>Save Settings</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- User Profile Modal -->
        <div v-if="userProfileModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user"></i> Profile Settings
                    </div>
                    <button class="modal-close" @click="userProfileModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-id-card"></i>
                            Personal Information
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" v-model="userProfileModal.form.full_name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" v-model="userProfileModal.form.email" disabled>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="text" class="form-control" v-model="userProfileModal.form.phone">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <input type="text" class="form-control" v-model="userProfileModal.form.department">
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-bell"></i>
                            Notification Preferences
                        </div>
                        <div class="form-group">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input" v-model="userProfileModal.form.notifications_enabled">
                                <span class="form-check-label">Enable Email Notifications</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="userProfileModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveUserProfile" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>Save Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Import/Export Modal -->
        <div v-if="importExportModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas" :class="importExportModal.mode === 'import' ? 'fa-upload' : 'fa-download'"></i>
                        {{ importExportModal.mode === 'import' ? 'Import Data' : 'Export Data' }}
                    </div>
                    <button class="modal-close" @click="importExportModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <div class="modal-section-title">
                            <i class="fas fa-database"></i>
                            Data Selection
                        </div>
                        <div class="form-group">
                            <label class="form-label">Select Table</label>
                            <select class="form-select" v-model="importExportModal.selectedTable">
                                <option value="medical_staff">Medical Staff</option>
                                <option value="training_units">Training Units</option>
                                <option value="resident_rotations">Resident Rotations</option>
                                <option value="audit_logs">Audit Logs</option>
                            </select>
                        </div>
                        
                        <div v-if="importExportModal.mode === 'export'" class="form-group">
                            <label class="form-label">Export Format</label>
                            <select class="form-select" v-model="importExportModal.exportFormat">
                                <option value="csv">CSV (Comma Separated Values)</option>
                                <option value="json">JSON (JavaScript Object Notation)</option>
                                <option value="excel">Excel Spreadsheet</option>
                            </select>
                        </div>
                        
                        <div v-if="importExportModal.mode === 'import'" class="form-group">
                            <label class="form-label">Select File</label>
                            <input type="file" class="form-control" @change="handleFileSelect" accept=".csv,.json,.xlsx">
                            <small class="text-gray-600">Supported formats: CSV, JSON, Excel</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="importExportModal.show = false">Cancel</button>
                    <button v-if="importExportModal.mode === 'export'" class="btn btn-primary" @click="exportData" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-download"></i> Export</span>
                    </button>
                    <button v-if="importExportModal.mode === 'import'" class="btn btn-primary" @click="importData" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-upload"></i> Import</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ VUE APP INITIALIZATION ============
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // ============ AUTHENTICATION ============
                    currentUser: null,
                    loginForm: {
                        email: 'admin@neumocare.org',
                        password: 'password123',
                        user_role: 'system_admin',
                        require_mfa: false,
                        mfa_code: ''
                    },
                    loading: false,
                    
                    // ============ UI STATE ============
                    currentView: 'daily_operations',
                    sidebarCollapsed: false,
                    mobileMenuOpen: false,
                    statsSidebarOpen: false,
                    userMenuOpen: false,
                    showPermissionManager: false,
                    saving: false,
                    savingPermissions: false,
                    
                    // ============ SEARCH & FILTERS ============
                    searchQuery: '',
                    searchScope: 'all',
                    searchFilter: 'all',
                    showRecentSearches: false,
                    recentSearches: [
                        { query: 'Dr. Smith', time: '10 min ago' },
                        { query: 'ICU Rotation', time: '1 hour ago' },
                        { query: 'Pulmonology', time: '2 hours ago' }
                    ],
                    
                    // ============ STAFF MANAGEMENT ============
                    staffSearch: '',
                    staffFilter: {
                        staff_type: '',
                        employment_status: ''
                    },
                    
                    // ============ NOTIFICATIONS ============
                    toasts: [],
                    unreadNotifications: 3,
                    
                    // ============ DATA STORES ============
                    medicalStaff: [],
                    onCallSchedule: [],
                    leaveRequests: [],
                    trainingUnits: [],
                    residentRotations: [],
                    auditLogs: [],
                    announcements: [],
                    quickUpdates: [],
                    
                    // ============ STATS & METRICS ============
                    stats: {
                        totalStaff: 142,
                        activeResidents: 58,
                        attendings: 24,
                        coverageAlerts: 6
                    },
                    
                    liveStats: {
                        occupancy: 85,
                        occupancyTrend: 2.5,
                        onDutyStaff: 42,
                        staffTrend: 3,
                        pendingRequests: 18,
                        erCapacity: { current: 12, max: 15, status: 'low' },
                        icuCapacity: { current: 8, max: 10, status: 'medium' },
                        wardCapacity: { current: 45, max: 50, status: 'low' },
                        todayAdmissions: 7,
                        avgStay: 4.2
                    },
                    
                    currentCapacity: {
                        er: { current: 12, max: 15, status: 'low' },
                        icu: { current: 8, max: 10, status: 'medium' },
                        ward: { current: 45, max: 50, status: 'low' },
                        stepdown: { current: 6, max: 8, status: 'low' }
                    },
                    
                    capacityOverview: [
                        { name: 'ER', current: 12, max: 15, percentage: 80, status: 'low' },
                        { name: 'ICU', current: 8, max: 10, percentage: 80, status: 'medium' },
                        { name: 'Ward', current: 45, max: 50, percentage: 90, status: 'high' },
                        { name: 'Step-down', current: 6, max: 8, percentage: 75, status: 'low' }
                    ],
                    
                    emergencyAlerts: [
                        { id: 1, message: 'ICU bed occupancy at 95%', priority: 'high' },
                        { id: 2, message: 'Bronchoscopy suite maintenance scheduled', priority: 'medium' },
                        { id: 3, message: 'ER wait time exceeding 2 hours', priority: 'high' }
                    ],
                    
                    coverageAlerts: [
                        { id: 1, unit_name: 'Pulmonology ICU', unit_id: 1, current: 2, capacity: 4, priority: 'high' },
                        { id: 2, unit_name: 'Respiratory Therapy', unit_id: 2, current: 3, capacity: 6, priority: 'medium' },
                        { id: 3, unit_name: 'Sleep Medicine', unit_id: 3, current: 1, capacity: 3, priority: 'high' }
                    ],
                    
                    todaysOnCall: [
                        { id: 1, primary_physician_id: 1, start_time: '08:00', end_time: '20:00' },
                        { id: 2, primary_physician_id: 2, start_time: '20:00', end_time: '08:00' }
                    ],
                    
                    nextSevenDays: [],
                    
                    recentAnnouncements: [
                        { id: 1, announcement_title: 'New Asthma Guidelines', announcement_content: 'Please review the updated asthma management guidelines...', priority_level: 'high', publish_start_date: new Date().toISOString() },
                        { id: 2, announcement_title: 'Department Meeting', announcement_content: 'Monthly department meeting scheduled for Friday...', priority_level: 'medium', publish_start_date: new Date().toISOString() }
                    ],
                    
                    // ============ UI INTERACTION STATE ============
                    draggingCard: null,
                    pinnedCards: {
                        totalStaff: false,
                        activeResidents: true,
                        attendings: false,
                        coverageAlerts: true
                    },
                    
                    collapsedCards: {
                        emergencyAlerts: false,
                        todaysOnCall: false,
                        coverageAlerts: false,
                        sevenDaySchedule: false
                    },
                    
                    lastUpdated: {
                        todaysOnCall: Date.now() - 300000, // 5 minutes ago
                        coverageAlerts: Date.now() - 600000, // 10 minutes ago
                        sevenDaySchedule: Date.now() - 900000 // 15 minutes ago
                    },
                    
                    // ============ MODAL STATES ============
                    medicalStaffModal: {
                        show: false,
                        mode: 'add',
                        form: {
                            full_name: '',
                            staff_type: 'medical_resident',
                            staff_id: '',
                            employment_status: 'active',
                            professional_email: '',
                            primary_clinic: '',
                            resident_category: 'department_internal',
                            training_year: new Date().getFullYear(),
                            can_supervise_residents: false
                        }
                    },
                    
                    staffDetailsModal: {
                        show: false,
                        staff: {},
                        activeTab: 'details',
                        stats: {},
                        activity: [],
                        rotations: [],
                        documents: []
                    },
                    
                    onCallModal: {
                        show: false,
                        mode: 'add',
                        form: {
                            duty_date: '',
                            shift_type: 'primary_call',
                            start_time: '08:00',
                            end_time: '20:00',
                            primary_physician_id: '',
                            backup_physician_id: '',
                            coverage_notes: ''
                        }
                    },
                    
                    trainingUnitModal: {
                        show: false,
                        mode: 'add',
                        form: {
                            unit_name: '',
                            unit_code: '',
                            department_name: 'Pulmonology',
                            specialty: '',
                            maximum_residents: 6,
                            current_residents: 0,
                            unit_status: 'active',
                            unit_description: ''
                        }
                    },
                    
                    rotationModal: {
                        show: false,
                        mode: 'add',
                        form: {
                            rotation_id: '',
                            resident_id: '',
                            training_unit_id: '',
                            supervising_attending_id: '',
                            rotation_start_date: '',
                            rotation_end_date: '',
                            rotation_category: 'clinical_rotation',
                            rotation_status: 'scheduled',
                            clinical_notes: '',
                            supervisor_evaluation: ''
                        }
                    },
                    
                    quickPlacementModal: {
                        show: false,
                        form: {
                            resident_id: '',
                            unit_id: '',
                            duration: '4'
                        }
                    },
                    
                    communicationsModal: {
                        show: false,
                        activeTab: 'announcement',
                        form: {
                            announcement_title: '',
                            announcement_content: '',
                            publish_start_date: new Date().toISOString().split('T')[0],
                            publish_end_date: '',
                            priority_level: 'medium',
                            target_audience: 'all'
                        },
                        capacity: {
                            er: { current: 12, max: 15, notes: '' },
                            icu: { current: 8, max: 10, notes: '' },
                            ward: { current: 45, max: 50, notes: '' },
                            stepdown: { current: 6, max: 8, notes: '' },
                            clinic: { current: 25, max: 40, notes: '' },
                            bronch: { current: 4, max: 6, notes: '' },
                            overall_notes: ''
                        },
                        quickUpdate: {
                            message: '',
                            priority: 'info',
                            expires: '24',
                            tags: ''
                        }
                    },
                    
                    leaveDetailsModal: {
                        show: false,
                        request: {}
                    },
                    
                    leaveRequestModal: {
                        show: false,
                        mode: 'add',
                        request: null,
                        form: {
                            start_date: '',
                            end_date: '',
                            leave_type: 'vacation',
                            status: 'pending',
                            reason: '',
                            approver_notes: ''
                        }
                    },
                    
                    systemSettingsModal: {
                        show: false,
                        form: {
                            hospital_name: 'NeumoCare General Hospital',
                            department_name: 'Pulmonology Department',
                            max_residents_per_unit: 6,
                            enable_audit_logging: true,
                            require_mfa: false,
                            maintenance_mode: false
                        }
                    },
                    
                    userProfileModal: {
                        show: false,
                        form: {
                            full_name: '',
                            email: '',
                            phone: '',
                            department: '',
                            notifications_enabled: true
                        }
                    },
                    
                    importExportModal: {
                        show: false,
                        mode: 'import',
                        selectedTable: 'medical_staff',
                        exportFormat: 'csv',
                        selectedFile: null
                    },
                    
                    // ============ SYSTEM SETTINGS ============
                    systemSettings: {
                        hospital_name: 'NeumoCare General Hospital',
                        department_name: 'Pulmonology Department',
                        max_residents_per_unit: 6,
                        enable_audit_logging: true,
                        require_mfa: false,
                        maintenance_mode: false
                    },
                    
                    // ============ PERMISSION SYSTEM ============
                    permissionResources: {
                        medical_staff: {
                            name: 'Medical Staff',
                            description: 'Manage medical staff records and profiles',
                            actions: ['read', 'create', 'update', 'delete', 'import', 'export', 'notify', 'report']
                        },
                        oncall_schedule: {
                            name: 'On-call Schedule',
                            description: 'Manage physician on-call duties',
                            actions: ['read', 'create', 'update', 'delete', 'override']
                        },
                        leave_requests: {
                            name: 'Leave Requests',
                            description: 'Manage staff leave requests',
                            actions: ['read', 'create', 'update', 'approve', 'reject']
                        },
                        resident_rotations: {
                            name: 'Resident Rotations',
                            description: 'Manage resident training rotations',
                            actions: ['read', 'create', 'update', 'delete', 'extend']
                        },
                        training_units: {
                            name: 'Training Units',
                            description: 'Manage training units and capacity',
                            actions: ['read', 'create', 'update', 'delete']
                        },
                        placements: {
                            name: 'Placements',
                            description: 'Manage resident unit placements',
                            actions: ['read', 'create', 'update', 'delete']
                        },
                        communications: {
                            name: 'Communications',
                            description: 'Manage department communications',
                            actions: ['read', 'create', 'update', 'delete']
                        },
                        audit: {
                            name: 'Audit Logs',
                            description: 'View system audit logs',
                            actions: ['read', 'export']
                        },
                        system: {
                            name: 'System Settings',
                            description: 'Manage system configuration',
                            actions: ['read', 'update', 'admin']
                        }
                    },
                    
                    // ============ DEMO DATA ============
                    availablePhysicians: [
                        { id: 1, full_name: 'Dr. Sarah Johnson', staff_type: 'attending_physician' },
                        { id: 2, full_name: 'Dr. Michael Chen', staff_type: 'attending_physician' },
                        { id: 3, full_name: 'Dr. Robert Miller', staff_type: 'medical_resident' }
                    ],
                    
                    availableAttendings: [
                        { id: 1, full_name: 'Dr. Sarah Johnson' },
                        { id: 2, full_name: 'Dr. Michael Chen' }
                    ],
                    
                    availableResidents: [
                        { id: 3, full_name: 'Dr. Robert Miller', staff_id: 'RES001' },
                        { id: 4, full_name: 'Dr. Emily Wilson', staff_id: 'RES002' },
                        { id: 5, full_name: 'Dr. James Brown', staff_id: 'RES003' }
                    ],
                    
                    activeTrainingUnits: [
                        { id: 1, unit_name: 'Pulmonology ICU', current_residents: 2, maximum_residents: 4 },
                        { id: 2, unit_name: 'Respiratory Therapy', current_residents: 3, maximum_residents: 6 },
                        { id: 3, unit_name: 'Sleep Medicine', current_residents: 1, maximum_residents: 3 }
                    ]
                };
            },
            
            computed: {
                // ============ FILTERED DATA ============
                filteredMedicalStaff() {
                    let filtered = this.medicalStaff;
                    
                    if (this.staffSearch) {
                        const search = this.staffSearch.toLowerCase();
                        filtered = filtered.filter(staff => 
                            staff.full_name.toLowerCase().includes(search) ||
                            staff.staff_id?.toLowerCase().includes(search) ||
                            staff.professional_email?.toLowerCase().includes(search)
                        );
                    }
                    
                    if (this.staffFilter.staff_type) {
                        filtered = filtered.filter(staff => staff.staff_type === this.staffFilter.staff_type);
                    }
                    
                    if (this.staffFilter.employment_status) {
                        filtered = filtered.filter(staff => staff.employment_status === this.staffFilter.employment_status);
                    }
                    
                    return filtered;
                },
                
                filteredRotations() {
                    return this.residentRotations;
                },
                
                // ============ AVAILABLE DATA ============
                availablePhysicians() {
                    return this.medicalStaff.filter(staff => 
                        staff.employment_status === 'active' && 
                        (staff.staff_type === 'attending_physician' || staff.staff_type === 'medical_resident')
                    );
                },
                
                availableAttendings() {
                    return this.medicalStaff.filter(staff => 
                        staff.employment_status === 'active' && 
                        staff.staff_type === 'attending_physician'
                    );
                },
                
                availableResidents() {
                    return this.medicalStaff.filter(staff => 
                        staff.employment_status === 'active' && 
                        staff.staff_type === 'medical_resident'
                    );
                },
                
                activeTrainingUnits() {
                    return this.trainingUnits.filter(unit => unit.unit_status === 'active');
                }
            },
            
            mounted() {
                this.initializeDemoData();
                this.generateNextSevenDays();
                this.updateLiveStats();
                
                // Auto-update live stats every 30 seconds
                setInterval(() => {
                    this.updateLiveStats();
                }, 30000);
            },
            
            methods: {
                // ============ INITIALIZATION ============
                initializeDemoData() {
                    // Medical Staff
                    this.medicalStaff = [
                        { id: 1, full_name: 'Dr. Sarah Johnson', staff_type: 'attending_physician', staff_id: 'ATT001', employment_status: 'active', professional_email: 's.johnson@neumocare.org', primary_clinic: 'Pulmonology ICU', last_activity: Date.now() - 3600000 },
                        { id: 2, full_name: 'Dr. Michael Chen', staff_type: 'attending_physician', staff_id: 'ATT002', employment_status: 'active', professional_email: 'm.chen@neumocare.org', primary_clinic: 'Respiratory Therapy', last_activity: Date.now() - 7200000 },
                        { id: 3, full_name: 'Dr. Robert Miller', staff_type: 'medical_resident', staff_id: 'RES001', employment_status: 'active', professional_email: 'r.miller@neumocare.org', primary_clinic: 'Pulmonology ICU', last_activity: Date.now() - 1800000 },
                        { id: 4, full_name: 'Dr. Emily Wilson', staff_type: 'medical_resident', staff_id: 'RES002', employment_status: 'active', professional_email: 'e.wilson@neumocare.org', primary_clinic: 'Sleep Medicine', last_activity: Date.now() - 5400000 },
                        { id: 5, full_name: 'Dr. James Brown', staff_type: 'medical_resident', staff_id: 'RES003', employment_status: 'on_leave', professional_email: 'j.brown@neumocare.org', primary_clinic: 'Respiratory Therapy', last_activity: Date.now() - 86400000 }
                    ];
                    
                    // On-call Schedule
                    this.onCallSchedule = [
                        { id: 1, duty_date: new Date().toISOString().split('T')[0], primary_physician_id: 1, backup_physician_id: 2, start_time: '08:00', end_time: '20:00', coverage_notes: 'Primary coverage' },
                        { id: 2, duty_date: this.addDays(new Date(), 1).toISOString().split('T')[0], primary_physician_id: 2, backup_physician_id: null, start_time: '20:00', end_time: '08:00', coverage_notes: 'Night shift' }
                    ];
                    
                    // Leave Requests
                    this.leaveRequests = [
                        { id: 1, staff_member_id: 3, leave_type: 'vacation', leave_start_date: this.addDays(new Date(), 7).toISOString().split('T')[0], leave_end_date: this.addDays(new Date(), 14).toISOString().split('T')[0], total_days: 7, status: 'pending', reason: 'Family vacation', created_at: new Date(Date.now() - 86400000).toISOString() },
                        { id: 2, staff_member_id: 4, leave_type: 'conference', leave_start_date: this.addDays(new Date(), 3).toISOString().split('T')[0], leave_end_date: this.addDays(new Date(), 5).toISOString().split('T')[0], total_days: 3, status: 'approved', reason: 'Medical conference', created_at: new Date(Date.now() - 172800000).toISOString() }
                    ];
                    
                    // Training Units
                    this.trainingUnits = [
                        { id: 1, unit_name: 'Pulmonology ICU', unit_code: 'PICU', department_name: 'Pulmonology', specialty: 'Critical Care', maximum_residents: 4, current_residents: 2, unit_status: 'active', unit_description: 'Specialized ICU for pulmonary critical care patients' },
                        { id: 2, unit_name: 'Respiratory Therapy', unit_code: 'RT', department_name: 'Pulmonology', specialty: 'Therapy', maximum_residents: 6, current_residents: 3, unit_status: 'active', unit_description: 'Respiratory therapy and rehabilitation unit' },
                        { id: 3, unit_name: 'Sleep Medicine', unit_code: 'SLEEP', department_name: 'Pulmonology', specialty: 'Sleep Disorders', maximum_residents: 3, current_residents: 1, unit_status: 'active', unit_description: 'Sleep disorder diagnosis and treatment center' }
                    ];
                    
                    // Resident Rotations
                    this.residentRotations = [
                        { id: 1, rotation_id: 'ROT001', resident_id: 3, training_unit_id: 1, supervising_attending_id: 1, rotation_start_date: this.addDays(new Date(), -30).toISOString().split('T')[0], rotation_end_date: this.addDays(new Date(), 30).toISOString().split('T')[0], rotation_category: 'clinical_rotation', rotation_status: 'active' },
                        { id: 2, rotation_id: 'ROT002', resident_id: 4, training_unit_id: 3, supervising_attending_id: 2, rotation_start_date: this.addDays(new Date(), -15).toISOString().split('T')[0], rotation_end_date: this.addDays(new Date(), 45).toISOString().split('T')[0], rotation_category: 'clinical_rotation', rotation_status: 'active' }
                    ];
                    
                    // Audit Logs
                    this.auditLogs = [
                        { id: 1, timestamp: new Date(Date.now() - 3600000).toISOString(), user_name: 'Dr. Sarah Johnson', user_role: 'attending_physician', action: 'create', resource: 'medical_staff', details: 'Added new resident Dr. Robert Miller', permission_level: 'full' },
                        { id: 2, timestamp: new Date(Date.now() - 7200000).toISOString(), user_name: 'System Admin', user_role: 'system_admin', action: 'update', resource: 'system_settings', details: 'Updated department capacity settings', permission_level: 'admin' }
                    ];
                    
                    // Quick Updates
                    this.quickUpdates = [
                        { id: 1, author: 'Dr. Chen', timestamp: Date.now() - 1800000, message: 'CT scanner maintenance completed ahead of schedule', tags: ['equipment', 'maintenance'] },
                        { id: 2, author: 'Nursing Staff', timestamp: Date.now() - 3600000, message: 'New asthma medication protocols available in shared drive', tags: ['guidelines', 'medication'] }
                    ];
                },
                
                generateNextSevenDays() {
                    const days = [];
                    for (let i = 0; i < 7; i++) {
                        const date = this.addDays(new Date(), i);
                        const schedule = this.onCallSchedule.find(s => 
                            s.duty_date === date.toISOString().split('T')[0]
                        );
                        days.push({
                            date: date.toISOString().split('T')[0],
                            schedule: schedule
                        });
                    }
                    this.nextSevenDays = days;
                },
                
                updateLiveStats() {
                    // Simulate live data updates
                    this.liveStats.occupancy = Math.floor(Math.random() * 20) + 75;
                    this.liveStats.onDutyStaff = Math.floor(Math.random() * 10) + 35;
                    this.liveStats.todayAdmissions = Math.floor(Math.random() * 5) + 5;
                    this.liveStats.erCapacity.current = Math.floor(Math.random() * 4) + 10;
                    this.liveStats.icuCapacity.current = Math.floor(Math.random() * 3) + 6;
                    this.liveStats.wardCapacity.current = Math.floor(Math.random() * 10) + 40;
                    
                    // Update status based on capacity
                    this.liveStats.erCapacity.status = this.getCapacityStatus(this.liveStats.erCapacity);
                    this.liveStats.icuCapacity.status = this.getCapacityStatus(this.liveStats.icuCapacity);
                    this.liveStats.wardCapacity.status = this.getCapacityStatus(this.liveStats.wardCapacity);
                },
                
                // ============ AUTHENTICATION ============
                handleAdvancedLogin() {
                    this.loading = true;
                    
                    // Simulate API call
                    setTimeout(() => {
                        this.currentUser = {
                            id: 1,
                            full_name: 'Dr. System Administrator',
                            email: this.loginForm.email,
                            user_role: this.loginForm.user_role
                        };
                        
                        this.showToast('success', 'Login Successful', 'Welcome to NeumoCare Hospital Management System');
                        this.loading = false;
                    }, 1000);
                },
                
                handleLogout() {
                    this.currentUser = null;
                    this.showToast('info', 'Logged Out', 'You have been successfully logged out');
                },
                
                // ============ UI HELPERS ============
                switchView(view) {
                    this.currentView = view;
                    this.mobileMenuOpen = false;
                },
                
                getCurrentTitle() {
                    const titles = {
                        daily_operations: 'Dashboard Overview',
                        medical_staff: 'Medical Staff',
                        resident_rotations: 'Resident Rotations',
                        oncall_schedule: 'On-call Schedule',
                        leave_requests: 'Leave Requests',
                        training_units: 'Training Units',
                        communications: 'Communications',
                        audit_logs: 'Audit Logs',
                        system_settings: 'System Settings'
                    };
                    return titles[this.currentView] || 'Dashboard';
                },
                
                getCurrentSubtitle() {
                    const subtitles = {
                        daily_operations: 'Real-time department overview and alerts',
                        medical_staff: 'Manage medical professionals and their profiles',
                        resident_rotations: 'Track and manage resident training rotations',
                        oncall_schedule: 'Schedule and monitor on-call physician duties',
                        leave_requests: 'Review and approve staff leave requests',
                        training_units: 'Manage training units and resident capacity',
                        communications: 'Department announcements and updates',
                        audit_logs: 'System activity and permission changes',
                        system_settings: 'Configure system preferences and security'
                    };
                    return subtitles[this.currentView] || 'NeumoCare Hospital Management';
                },
                
                getSearchPlaceholder() {
                    const placeholders = {
                        daily_operations: 'Search staff, units, or schedules...',
                        medical_staff: 'Search by name, ID, or email...',
                        resident_rotations: 'Search rotations or residents...',
                        oncall_schedule: 'Search physicians or dates...',
                        leave_requests: 'Search staff or leave types...',
                        training_units: 'Search units or specialties...',
                        communications: 'Search announcements or updates...',
                        audit_logs: 'Search users or actions...',
                        system_settings: 'Search settings...'
                    };
                    return placeholders[this.currentView] || 'Search...';
                },
                
                toggleStatsSidebar() {
                    this.statsSidebarOpen = !this.statsSidebarOpen;
                },
                
                toggleUserMenu() {
                    this.userMenuOpen = !this.userMenuOpen;
                },
                
                togglePermissionManager() {
                    this.showPermissionManager = !this.showPermissionManager;
                },
                
                toggleSearchScope() {
                    const scopes = ['all', 'staff', 'units', 'rotations'];
                    const currentIndex = scopes.indexOf(this.searchScope);
                    this.searchScope = scopes[(currentIndex + 1) % scopes.length];
                },
                
                setSearchFilter(filter) {
                    this.searchFilter = filter;
                },
                
                selectRecentSearch(search) {
                    this.searchQuery = search.query;
                    this.handleAdvancedSearch();
                },
                
                clearRecentSearches() {
                    this.recentSearches = [];
                    this.showToast('info', 'Search History Cleared', 'Your recent searches have been cleared');
                },
                
                handleAdvancedSearch() {
                    if (!this.searchQuery.trim()) return;
                    
                    // Add to recent searches
                    this.recentSearches.unshift({
                        query: this.searchQuery,
                        time: 'Just now'
                    });
                    
                    // Keep only last 5 searches
                    if (this.recentSearches.length > 5) {
                        this.recentSearches.pop();
                    }
                    
                    this.showToast('info', 'Search Results', `Searching for "${this.searchQuery}" in ${this.searchScope}`);
                },
                
                // ============ INTERACTIVE WIDGETS ============
                startDrag(event, cardId) {
                    this.draggingCard = cardId;
                    event.dataTransfer.setData('text/plain', cardId);
                },
                
                endDrag() {
                    this.draggingCard = null;
                },
                
                handleDrop(event, unit) {
                    event.preventDefault();
                    if (this.draggingCard) {
                        this.showToast('info', 'Card Moved', `Card placed in ${unit.unit_name}`);
                    }
                },
                
                togglePinCard(cardId) {
                    this.pinnedCards[cardId] = !this.pinnedCards[cardId];
                    const action = this.pinnedCards[cardId] ? 'pinned' : 'unpinned';
                    this.showToast('info', 'Card Updated', `Card ${action}`);
                },
                
                toggleCollapseCard(cardId) {
                    this.collapsedCards[cardId] = !this.collapsedCards[cardId];
                },
                
                // ============ STAFF MANAGEMENT ============
                showAddMedicalStaffModal() {
                    this.medicalStaffModal.mode = 'add';
                    this.medicalStaffModal.form = {
                        full_name: '',
                        staff_type: 'medical_resident',
                        staff_id: '',
                        employment_status: 'active',
                        professional_email: '',
                        primary_clinic: '',
                        resident_category: 'department_internal',
                        training_year: new Date().getFullYear(),
                        can_supervise_residents: false
                    };
                    this.medicalStaffModal.show = true;
                },
                
                editMedicalStaff(staff) {
                    this.medicalStaffModal.mode = 'edit';
                    this.medicalStaffModal.form = { ...staff };
                    this.medicalStaffModal.show = true;
                },
                
                viewStaffDetails(staff) {
                    this.staffDetailsModal.staff = staff;
                    this.staffDetailsModal.stats = {
                        completedRotations: Math.floor(Math.random() * 10),
                        oncallShifts: Math.floor(Math.random() * 20),
                        leaveDays: Math.floor(Math.random() * 15),
                        supervisionCount: Math.floor(Math.random() * 5)
                    };
                    
                    // Generate sample activity
                    this.staffDetailsModal.activity = [
                        { id: 1, description: 'Completed ICU rotation', timestamp: new Date(Date.now() - 86400000).toISOString() },
                        { id: 2, description: 'Attended pulmonary conference', timestamp: new Date(Date.now() - 172800000).toISOString() },
                        { id: 3, description: 'Submitted research paper', timestamp: new Date(Date.now() - 259200000).toISOString() }
                    ];
                    
                    // Generate sample rotations
                    this.staffDetailsModal.rotations = this.residentRotations.filter(r => r.resident_id === staff.id);
                    
                    // Generate sample documents
                    this.staffDetailsModal.documents = [
                        { id: 1, name: 'Medical License', type: 'license', description: 'Active medical license', upload_date: new Date(Date.now() - 86400000).toISOString() },
                        { id: 2, name: 'CV/Resume', type: 'document', description: 'Updated curriculum vitae', upload_date: new Date(Date.now() - 172800000).toISOString() }
                    ];
                    
                    this.staffDetailsModal.show = true;
                },
                
                saveMedicalStaff() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        if (this.medicalStaffModal.mode === 'add') {
                            const newStaff = {
                                id: this.medicalStaff.length + 1,
                                ...this.medicalStaffModal.form,
                                last_activity: Date.now()
                            };
                            this.medicalStaff.push(newStaff);
                            this.showToast('success', 'Staff Added', `${newStaff.full_name} has been added to the system`);
                        } else {
                            const index = this.medicalStaff.findIndex(s => s.id === this.medicalStaffModal.form.id);
                            if (index !== -1) {
                                this.medicalStaff[index] = { ...this.medicalStaffModal.form };
                                this.showToast('success', 'Staff Updated', `${this.medicalStaffModal.form.full_name} has been updated`);
                            }
                        }
                        
                        this.saving = false;
                        this.medicalStaffModal.show = false;
                    }, 500);
                },
                
                deleteMedicalStaff(staff) {
                    if (confirm(`Are you sure you want to delete ${staff.full_name}?`)) {
                        this.medicalStaff = this.medicalStaff.filter(s => s.id !== staff.id);
                        this.showToast('success', 'Staff Deleted', `${staff.full_name} has been removed from the system`);
                    }
                },
                
                resetStaffFilters() {
                    this.staffSearch = '';
                    this.staffFilter = {
                        staff_type: '',
                        employment_status: ''
                    };
                },
                
                applyStaffFilters() {
                    this.showToast('info', 'Filters Applied', 'Staff filters have been updated');
                },
                
                // ============ ON-CALL SCHEDULE ============
                showAddOnCallModal() {
                    this.onCallModal.mode = 'add';
                    this.onCallModal.form = {
                        duty_date: new Date().toISOString().split('T')[0],
                        shift_type: 'primary_call',
                        start_time: '08:00',
                        end_time: '20:00',
                        primary_physician_id: '',
                        backup_physician_id: '',
                        coverage_notes: ''
                    };
                    this.onCallModal.show = true;
                },
                
                editOnCallSchedule(day) {
                    this.onCallModal.mode = 'edit';
                    if (day.schedule) {
                        this.onCallModal.form = { ...day.schedule };
                    } else {
                        this.onCallModal.form = {
                            duty_date: day.date,
                            shift_type: 'primary_call',
                            start_time: '08:00',
                            end_time: '20:00',
                            primary_physician_id: '',
                            backup_physician_id: '',
                            coverage_notes: ''
                        };
                    }
                    this.onCallModal.show = true;
                },
                
                saveOnCallSchedule() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        if (this.onCallModal.mode === 'add') {
                            const newSchedule = {
                                id: this.onCallSchedule.length + 1,
                                ...this.onCallModal.form
                            };
                            this.onCallSchedule.push(newSchedule);
                            this.showToast('success', 'Schedule Added', 'New on-call schedule has been created');
                        } else {
                            const index = this.onCallSchedule.findIndex(s => s.id === this.onCallModal.form.id);
                            if (index !== -1) {
                                this.onCallSchedule[index] = { ...this.onCallModal.form };
                                this.showToast('success', 'Schedule Updated', 'On-call schedule has been updated');
                            }
                        }
                        
                        this.saving = false;
                        this.onCallModal.show = false;
                        this.generateNextSevenDays();
                    }, 500);
                },
                
                deleteOnCallSchedule(schedule) {
                    if (confirm('Are you sure you want to delete this on-call schedule?')) {
                        this.onCallSchedule = this.onCallSchedule.filter(s => s.id !== schedule.id);
                        this.showToast('success', 'Schedule Deleted', 'On-call schedule has been removed');
                        this.generateNextSevenDays();
                    }
                },
                
                overrideOnCall(day) {
                    if (confirm('Override this on-call schedule with emergency coverage?')) {
                        this.showToast('warning', 'Schedule Overridden', 'Emergency coverage has been assigned');
                    }
                },
                
                // ============ TRAINING UNITS ============
                showAddTrainingUnitModal() {
                    this.trainingUnitModal.mode = 'add';
                    this.trainingUnitModal.form = {
                        unit_name: '',
                        unit_code: '',
                        department_name: 'Pulmonology',
                        specialty: '',
                        maximum_residents: 6,
                        current_residents: 0,
                        unit_status: 'active',
                        unit_description: ''
                    };
                    this.trainingUnitModal.show = true;
                },
                
                editTrainingUnit(unit) {
                    this.trainingUnitModal.mode = 'edit';
                    this.trainingUnitModal.form = { ...unit };
                    this.trainingUnitModal.show = true;
                },
                
                saveTrainingUnit() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        if (this.trainingUnitModal.mode === 'add') {
                            const newUnit = {
                                id: this.trainingUnits.length + 1,
                                ...this.trainingUnitModal.form
                            };
                            this.trainingUnits.push(newUnit);
                            this.showToast('success', 'Unit Added', `${newUnit.unit_name} has been added`);
                        } else {
                            const index = this.trainingUnits.findIndex(u => u.id === this.trainingUnitModal.form.id);
                            if (index !== -1) {
                                this.trainingUnits[index] = { ...this.trainingUnitModal.form };
                                this.showToast('success', 'Unit Updated', `${this.trainingUnitModal.form.unit_name} has been updated`);
                            }
                        }
                        
                        this.saving = false;
                        this.trainingUnitModal.show = false;
                    }, 500);
                },
                
                getAssignedResidents(unitId) {
                    return this.medicalStaff.filter(staff => 
                        staff.staff_type === 'medical_resident' && 
                        staff.primary_clinic === this.trainingUnits.find(u => u.id === unitId)?.unit_name
                    );
                },
                
                assignResidentsToUnit(unit) {
                    this.showToast('info', 'Assign Residents', `Opening resident assignment for ${unit.unit_name}`);
                },
                
                removePlacement(residentId, unitId) {
                    if (confirm('Remove this resident from the unit?')) {
                        this.showToast('success', 'Resident Removed', 'Resident has been removed from the unit');
                    }
                },
                
                // ============ ROTATIONS ============
                showAddRotationModal() {
                    this.rotationModal.mode = 'add';
                    this.rotationModal.form = {
                        rotation_id: `ROT${String(this.residentRotations.length + 1).padStart(3, '0')}`,
                        resident_id: '',
                        training_unit_id: '',
                        supervising_attending_id: '',
                        rotation_start_date: new Date().toISOString().split('T')[0],
                        rotation_end_date: this.addDays(new Date(), 30).toISOString().split('T')[0],
                        rotation_category: 'clinical_rotation',
                        rotation_status: 'scheduled',
                        clinical_notes: '',
                        supervisor_evaluation: ''
                    };
                    this.rotationModal.show = true;
                },
                
                editRotation(rotation) {
                    this.rotationModal.mode = 'edit';
                    this.rotationModal.form = { ...rotation };
                    this.rotationModal.show = true;
                },
                
                saveRotation() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        if (this.rotationModal.mode === 'add') {
                            const newRotation = {
                                id: this.residentRotations.length + 1,
                                ...this.rotationModal.form
                            };
                            this.residentRotations.push(newRotation);
                            this.showToast('success', 'Rotation Created', `Rotation ${newRotation.rotation_id} has been created`);
                        } else {
                            const index = this.residentRotations.findIndex(r => r.id === this.rotationModal.form.id);
                            if (index !== -1) {
                                this.residentRotations[index] = { ...this.rotationModal.form };
                                this.showToast('success', 'Rotation Updated', `Rotation ${this.rotationModal.form.rotation_id} has been updated`);
                            }
                        }
                        
                        this.saving = false;
                        this.rotationModal.show = false;
                    }, 500);
                },
                
                extendRotation(rotation) {
                    const newEndDate = this.addDays(new Date(rotation.rotation_end_date), 30).toISOString().split('T')[0];
                    if (confirm(`Extend rotation until ${newEndDate}?`)) {
                        rotation.rotation_end_date = newEndDate;
                        this.showToast('success', 'Rotation Extended', 'Rotation has been extended by 30 days');
                    }
                },
                
                deleteRotation(rotation) {
                    if (confirm(`Delete rotation ${rotation.rotation_id}?`)) {
                        this.residentRotations = this.residentRotations.filter(r => r.id !== rotation.id);
                        this.showToast('success', 'Rotation Deleted', 'Rotation has been removed');
                    }
                },
                
                // ============ QUICK PLACEMENT ============
                showQuickPlacementModal() {
                    this.quickPlacementModal.show = true;
                },
                
                saveQuickPlacement() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        const resident = this.medicalStaff.find(s => s.id === this.quickPlacementModal.form.resident_id);
                        const unit = this.trainingUnits.find(u => u.id === this.quickPlacementModal.form.unit_id);
                        
                        if (resident && unit) {
                            this.showToast('success', 'Placement Complete', `${resident.full_name} assigned to ${unit.unit_name} for ${this.quickPlacementModal.form.duration} weeks`);
                        }
                        
                        this.saving = false;
                        this.quickPlacementModal.show = false;
                    }, 500);
                },
                
                quickAssignToUnit(alert) {
                    this.quickPlacementModal.form.unit_id = alert.unit_id;
                    this.quickPlacementModal.show = true;
                },
                
                // ============ COMMUNICATIONS ============
                showCommunicationsModal() {
                    this.communicationsModal.show = true;
                },
                
                saveCommunication() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        if (this.communicationsModal.activeTab === 'announcement') {
                            const newAnnouncement = {
                                id: this.announcements.length + 1,
                                ...this.communicationsModal.form,
                                publish_start_date: new Date(this.communicationsModal.form.publish_start_date).toISOString()
                            };
                            this.announcements.unshift(newAnnouncement);
                            this.recentAnnouncements.unshift(newAnnouncement);
                            this.showToast('success', 'Announcement Published', 'New announcement has been published');
                        } else if (this.communicationsModal.activeTab === 'capacity') {
                            this.currentCapacity = { ...this.communicationsModal.capacity };
                            this.showToast('success', 'Capacity Updated', 'Department capacity has been updated');
                        } else if (this.communicationsModal.activeTab === 'quick') {
                            const newUpdate = {
                                id: this.quickUpdates.length + 1,
                                author: this.currentUser.full_name,
                                timestamp: Date.now(),
                                message: this.communicationsModal.quickUpdate.message,
                                tags: this.communicationsModal.quickUpdate.tags.split(',').map(tag => tag.trim()).filter(tag => tag)
                            };
                            this.quickUpdates.unshift(newUpdate);
                            this.showToast('success', 'Update Posted', 'Quick update has been posted');
                        }
                        
                        this.saving = false;
                        this.communicationsModal.show = false;
                    }, 500);
                },
                
                getCommunicationIcon(tab) {
                    const icons = {
                        announcement: 'fa-bullhorn',
                        capacity: 'fa-bed',
                        quick: 'fa-comment-medical'
                    };
                    return icons[tab] || 'fa-paper-plane';
                },
                
                getCommunicationButtonText(tab) {
                    const texts = {
                        announcement: 'Publish Announcement',
                        capacity: 'Update Capacity',
                        quick: 'Post Update'
                    };
                    return texts[tab] || 'Save';
                },
                
                // ============ LEAVE REQUESTS ============
                showAddLeaveRequestModal() {
                    this.leaveRequestModal.mode = 'add';
                    this.leaveRequestModal.request = null;
                    this.leaveRequestModal.form = {
                        start_date: new Date().toISOString().split('T')[0],
                        end_date: this.addDays(new Date(), 7).toISOString().split('T')[0],
                        leave_type: 'vacation',
                        status: 'pending',
                        reason: '',
                        approver_notes: ''
                    };
                    this.leaveRequestModal.show = true;
                },
                
                viewLeaveRequestDetails(request) {
                    this.leaveDetailsModal.request = request;
                    this.leaveDetailsModal.show = true;
                },
                
                saveLeaveRequest() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        const newRequest = {
                            id: this.leaveRequests.length + 1,
                            staff_member_id: this.currentUser.id,
                            ...this.leaveRequestModal.form,
                            total_days: this.calculateDaysDifference(this.leaveRequestModal.form.start_date, this.leaveRequestModal.form.end_date),
                            created_at: new Date().toISOString()
                        };
                        
                        this.leaveRequests.push(newRequest);
                        this.showToast('success', 'Leave Request Submitted', 'Your leave request has been submitted for approval');
                        
                        this.saving = false;
                        this.leaveRequestModal.show = false;
                    }, 500);
                },
                
                approveLeaveRequest(request) {
                    request.status = 'approved';
                    request.decision_date = new Date().toISOString();
                    this.showToast('success', 'Leave Approved', 'Leave request has been approved');
                    this.leaveDetailsModal.show = false;
                },
                
                rejectLeaveRequest(request) {
                    request.status = 'rejected';
                    request.decision_date = new Date().toISOString();
                    this.showToast('warning', 'Leave Rejected', 'Leave request has been rejected');
                    this.leaveDetailsModal.show = false;
                },
                
                // ============ SYSTEM SETTINGS ============
                showSystemSettingsModal() {
                    this.systemSettingsModal.form = { ...this.systemSettings };
                    this.systemSettingsModal.show = true;
                },
                
                saveSystemSettings() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        this.systemSettings = { ...this.systemSettingsModal.form };
                        this.showToast('success', 'Settings Saved', 'System settings have been updated');
                        
                        this.saving = false;
                        this.systemSettingsModal.show = false;
                    }, 500);
                },
                
                // ============ USER PROFILE ============
                showUserProfile() {
                    this.userProfileModal.form = {
                        full_name: this.currentUser.full_name,
                        email: this.currentUser.email,
                        phone: '',
                        department: 'Pulmonology Department',
                        notifications_enabled: true
                    };
                    this.userProfileModal.show = true;
                    this.userMenuOpen = false;
                },
                
                saveUserProfile() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        this.currentUser.full_name = this.userProfileModal.form.full_name;
                        this.showToast('success', 'Profile Updated', 'Your profile has been updated');
                        
                        this.saving = false;
                        this.userProfileModal.show = false;
                    }, 500);
                },
                
                // ============ IMPORT/EXPORT ============
                showImportModal(table) {
                    this.importExportModal.mode = 'import';
                    this.importExportModal.selectedTable = table;
                    this.importExportModal.show = true;
                },
                
                handleFileSelect(event) {
                    this.importExportModal.selectedFile = event.target.files[0];
                },
                
                importData() {
                    if (!this.importExportModal.selectedFile) {
                        this.showToast('error', 'No File Selected', 'Please select a file to import');
                        return;
                    }
                    
                    this.saving = true;
                    
                    setTimeout(() => {
                        this.showToast('success', 'Import Complete', `Data imported from ${this.importExportModal.selectedFile.name}`);
                        this.saving = false;
                        this.importExportModal.show = false;
                    }, 1000);
                },
                
                exportData() {
                    this.saving = true;
                    
                    setTimeout(() => {
                        this.showToast('success', 'Export Complete', `Data exported in ${this.importExportModal.exportFormat.toUpperCase()} format`);
                        this.saving = false;
                        this.importExportModal.show = false;
                    }, 1000);
                },
                
                exportStaffList() {
                    this.showToast('info', 'Export Started', 'Medical staff list export in progress...');
                },
                
                exportAuditLogs() {
                    this.showToast('info', 'Export Started', 'Audit logs export in progress...');
                },
                
                // ============ ALERTS & NOTIFICATIONS ============
                dismissAllAlerts() {
                    this.emergencyAlerts = [];
                    this.showToast('info', 'Alerts Dismissed', 'All emergency alerts have been dismissed');
                },
                
                dismissCoverageAlert(alertId) {
                    this.coverageAlerts = this.coverageAlerts.filter(alert => alert.id !== alertId);
                    this.showToast('info', 'Alert Dismissed', 'Coverage alert has been dismissed');
                },
                
                markAllNotificationsAsRead() {
                    this.unreadNotifications = 0;
                    this.showToast('info', 'Notifications Cleared', 'All notifications marked as read');
                },
                
                sendBulkNotifications() {
                    this.showToast('info', 'Notifications Sent', 'Bulk notifications sent to all staff');
                },
                
                showStaffReport() {
                    this.showToast('info', 'Report Generated', 'Staff report has been generated and is ready for download');
                },
                
                // ============ PERMISSION SYSTEM ============
                hasPermission(resource, action) {
                    // Simplified permission check based on user role
                    const userRole = this.currentUser?.user_role;
                    
                    if (!userRole) return false;
                    
                    // System admin has all permissions
                    if (userRole === 'system_admin') return true;
                    
                    // Department head has most permissions
                    if (userRole === 'department_head') {
                        return !['system', 'audit'].includes(resource) || action === 'read';
                    }
                    
                    // Resident manager has limited permissions
                    if (userRole === 'resident_manager') {
                        const allowedResources = ['medical_staff', 'resident_rotations', 'training_units', 'placements'];
                        return allowedResources.includes(resource                            && ['read', 'create', 'update'].includes(action);
                    }
                    
                    // Attending physician has viewing permissions
                    if (userRole === 'attending_physician') {
                        return ['read'].includes(action);
                    }
                    
                    // Viewing doctor has minimal permissions
                    if (userRole === 'viewing_doctor') {
                        return resource === 'medical_staff' && action === 'read';
                    }
                    
                    return false;
                },
                
                hasAnyPermission(resources) {
                    return resources.some(resource => this.hasPermission(resource, 'read'));
                },
                
                getResourcePermissionLevel(resourceKey) {
                    const resource = this.permissionResources[resourceKey];
                    if (!resource) return 'none';
                    
                    // Check all actions for this resource
                    const hasFull = resource.actions.every(action => this.hasPermission(resourceKey, action));
                    if (hasFull) return 'full';
                    
                    const hasWrite = ['create', 'update', 'delete'].some(action => this.hasPermission(resourceKey, action));
                    if (hasWrite) return 'write';
                    
                    const hasRead = this.hasPermission(resourceKey, 'read');
                    if (hasRead) return 'read';
                    
                    return 'none';
                },
                
                getPermissionDescription(resource, action) {
                    const descriptions = {
                        read: 'View data',
                        create: 'Add new records',
                        update: 'Modify existing records',
                        delete: 'Remove records',
                        import: 'Import data from files',
                        export: 'Export data to files',
                        notify: 'Send notifications',
                        report: 'Generate reports',
                        override: 'Override schedules',
                        approve: 'Approve requests',
                        reject: 'Reject requests',
                        extend: 'Extend durations',
                        admin: 'Full system access'
                    };
                    return descriptions[action] || action;
                },
                
                togglePermission(role, resource, action) {
                    // In a real app, this would make an API call to update permissions
                    this.showToast('permission', 'Permission Changed', 
                        `${role} ${this.hasPermission(resource, action) ? 'removed' : 'granted'} ${action} permission for ${resource}`);
                },
                
                savePermissionChanges() {
                    this.savingPermissions = true;
                    
                    setTimeout(() => {
                        this.showToast('success', 'Permissions Saved', 'Permission changes have been saved');
                        this.savingPermissions = false;
                        this.showPermissionManager = false;
                    }, 1000);
                },
                
                // ============ FORMATTING HELPERS ============
                formatDate(dateString) {
                    if (!dateString) return 'N/A';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                },
                
                formatDateShort(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric' 
                    });
                },
                
                formatDateTime(dateString) {
                    if (!dateString) return 'N/A';
                    const date = new Date(dateString);
                    return date.toLocaleString('en-US', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },
                
                formatTimeAgo(timestamp) {
                    if (!timestamp) return 'Never';
                    
                    const now = Date.now();
                    const diff = now - timestamp;
                    const seconds = Math.floor(diff / 1000);
                    const minutes = Math.floor(seconds / 60);
                    const hours = Math.floor(minutes / 60);
                    
                    if (seconds < 60) return 'just now';
                    if (minutes < 60) return `${minutes}m ago`;
                    if (hours < 24) return `${hours}h ago`;
                    
                    const days = Math.floor(hours / 24);
                    if (days < 30) return `${days}d ago`;
                    
                    return this.formatDate(new Date(timestamp));
                },
                
                formatTimeRange(start, end) {
                    return `${this.formatTime(start)} - ${this.formatTime(end)}`;
                },
                
                formatTime(timeString) {
                    if (!timeString) return '';
                    const [hours, minutes] = timeString.split(':');
                    const hour = parseInt(hours);
                    const ampm = hour >= 12 ? 'PM' : 'AM';
                    const displayHour = hour % 12 || 12;
                    return `${displayHour}:${minutes} ${ampm}`;
                },
                
                getInitials(name) {
                    if (!name) return '??';
                    return name
                        .split(' ')
                        .map(part => part[0])
                        .join('')
                        .toUpperCase()
                        .slice(0, 2);
                },
                
                getUserRoleDisplay(role) {
                    const roles = {
                        system_admin: 'System Administrator',
                        department_head: 'Head of Department',
                        resident_manager: 'Resident Manager',
                        attending_physician: 'Attending Physician',
                        viewing_doctor: 'Viewing Doctor'
                    };
                    return roles[role] || role;
                },
                
                formatStaffType(type) {
                    const types = {
                        medical_resident: 'Medical Resident',
                        attending_physician: 'Attending Physician',
                        fellow: 'Fellow',
                        nurse_practitioner: 'Nurse Practitioner'
                    };
                    return types[type] || type;
                },
                
                formatEmploymentStatus(status) {
                    const statuses = {
                        active: 'Active',
                        on_leave: 'On Leave',
                        inactive: 'Inactive'
                    };
                    return statuses[status] || status;
                },
                
                formatRotationCategory(category) {
                    const categories = {
                        clinical_rotation: 'Clinical',
                        elective_rotation: 'Elective',
                        research_rotation: 'Research',
                        vacation_rotation: 'Vacation'
                    };
                    return categories[category] || category;
                },
                
                formatActionName(action) {
                    const actions = {
                        read: 'View',
                        create: 'Create',
                        update: 'Update',
                        delete: 'Delete',
                        import: 'Import',
                        export: 'Export',
                        notify: 'Notify',
                        report: 'Report',
                        override: 'Override',
                        approve: 'Approve',
                        reject: 'Reject',
                        extend: 'Extend',
                        admin: 'Admin'
                    };
                    return actions[action] || action;
                },
                
                truncateText(text, maxLength) {
                    if (!text) return '';
                    if (text.length <= maxLength) return text;
                    return text.substring(0, maxLength) + '...';
                },
                
                // ============ STYLING HELPERS ============
                getStaffTypeClass(type) {
                    const classes = {
                        medical_resident: 'badge-resident-advanced',
                        attending_physician: 'badge-attending-advanced',
                        fellow: 'badge-info',
                        nurse_practitioner: 'badge-primary'
                    };
                    return classes[type] || 'badge-info';
                },
                
                getRotationCategoryClass(category) {
                    const classes = {
                        clinical_rotation: 'badge-success',
                        elective_rotation: 'badge-primary',
                        research_rotation: 'badge-info',
                        vacation_rotation: 'badge-warning'
                    };
                    return classes[category] || 'badge-info';
                },
                
                getPriorityColor(priority) {
                    const colors = {
                        low: 'info',
                        medium: 'warning',
                        high: 'danger',
                        urgent: 'danger'
                    };
                    return colors[priority] || 'info';
                },
                
                getDayStatus(day) {
                    if (!day.schedule) return 'bg-gray-100';
                    return 'bg-blue-50 border border-blue-200';
                },
                
                getAuditIcon(action) {
                    const icons = {
                        create: 'fa-plus-circle',
                        update: 'fa-edit',
                        delete: 'fa-trash',
                        read: 'fa-eye',
                        login: 'fa-sign-in-alt',
                        logout: 'fa-sign-out-alt'
                    };
                    return icons[action] || 'fa-history';
                },
                
                getDocumentIcon(type) {
                    const icons = {
                        license: 'fa-file-certificate',
                        certificate: 'fa-award',
                        document: 'fa-file-alt',
                        medical: 'fa-file-medical'
                    };
                    return icons[type] || 'fa-file';
                },
                
                getCapacityStatus(capacity) {
                    if (!capacity || !capacity.max) return 'unknown';
                    const percentage = (capacity.current / capacity.max) * 100;
                    
                    if (percentage < 70) return 'low';
                    if (percentage < 85) return 'medium';
                    return 'high';
                },
                
                // ============ DATA HELPERS ============
                addDays(date, days) {
                    const result = new Date(date);
                    result.setDate(result.getDate() + days);
                    return result;
                },
                
                calculateDaysDifference(start, end) {
                    const startDate = new Date(start);
                    const endDate = new Date(end);
                    const diffTime = Math.abs(endDate - startDate);
                    return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                },
                
                getPhysicianName(physicianId) {
                    if (!physicianId) return 'Unassigned';
                    const physician = this.medicalStaff.find(s => s.id === physicianId);
                    return physician ? physician.full_name : `Physician ${physicianId}`;
                },
                
                getResidentName(residentId) {
                    return this.getPhysicianName(residentId);
                },
                
                getAttendingName(attendingId) {
                    return this.getPhysicianName(attendingId);
                },
                
                getTrainingUnitName(unitId) {
                    if (!unitId) return 'Unassigned';
                    const unit = this.trainingUnits.find(u => u.id === unitId);
                    return unit ? unit.unit_name : `Unit ${unitId}`;
                },
                
                viewUnitDetails(unitId) {
                    const unit = this.trainingUnits.find(u => u.id === unitId);
                    if (unit) {
                        this.trainingUnitModal.mode = 'edit';
                        this.trainingUnitModal.form = { ...unit };
                        this.trainingUnitModal.show = true;
                    }
                },
                
                viewScheduleDetails(date) {
                    this.showToast('info', 'Schedule Details', `Viewing schedule for ${this.formatDate(date)}`);
                },
                
                loadStaffDailyActivities(staffId) {
                    this.showToast('info', 'Activity Loaded', 'Daily activities loaded successfully');
                },
                
                updateCapacity() {
                    // Update all capacities based on current values
                    this.liveStats.erCapacity.current = this.currentCapacity.er.current;
                    this.liveStats.erCapacity.max = this.currentCapacity.er.max;
                    this.liveStats.erCapacity.status = this.getCapacityStatus(this.currentCapacity.er);
                    
                    this.liveStats.icuCapacity.current = this.currentCapacity.icu.current;
                    this.liveStats.icuCapacity.max = this.currentCapacity.icu.max;
                    this.liveStats.icuCapacity.status = this.getCapacityStatus(this.currentCapacity.icu);
                    
                    this.liveStats.wardCapacity.current = this.currentCapacity.ward.current;
                    this.liveStats.wardCapacity.max = this.currentCapacity.ward.max;
                    this.liveStats.wardCapacity.status = this.getCapacityStatus(this.currentCapacity.ward);
                    
                    // Update capacity overview
                    this.capacityOverview = [
                        { 
                            name: 'ER', 
                            current: this.currentCapacity.er.current, 
                            max: this.currentCapacity.er.max, 
                            percentage: Math.round((this.currentCapacity.er.current / this.currentCapacity.er.max) * 100),
                            status: this.getCapacityStatus(this.currentCapacity.er)
                        },
                        { 
                            name: 'ICU', 
                            current: this.currentCapacity.icu.current, 
                            max: this.currentCapacity.icu.max, 
                            percentage: Math.round((this.currentCapacity.icu.current / this.currentCapacity.icu.max) * 100),
                            status: this.getCapacityStatus(this.currentCapacity.icu)
                        },
                        { 
                            name: 'Ward', 
                            current: this.currentCapacity.ward.current, 
                            max: this.currentCapacity.ward.max, 
                            percentage: Math.round((this.currentCapacity.ward.current / this.currentCapacity.ward.max) * 100),
                            status: this.getCapacityStatus(this.currentCapacity.ward)
                        },
                        { 
                            name: 'Step-down', 
                            current: this.currentCapacity.stepdown.current, 
                            max: this.currentCapacity.stepdown.max, 
                            percentage: Math.round((this.currentCapacity.stepdown.current / this.currentCapacity.stepdown.max) * 100),
                            status: this.getCapacityStatus(this.currentCapacity.stepdown)
                        }
                    ];
                    
                    this.showToast('success', 'Capacity Updated', 'Department capacity has been updated');
                },
                
                // ============ TOAST SYSTEM ============
                showToast(type, title, message) {
                    const icons = {
                        success: 'fa-check-circle',
                        error: 'fa-exclamation-circle',
                        warning: 'fa-exclamation-triangle',
                        info: 'fa-info-circle',
                        permission: 'fa-user-shield'
                    };
                    
                    const toast = {
                        id: Date.now(),
                        type,
                        icon: icons[type] || 'fa-info-circle',
                        title,
                        message
                    };
                    
                    this.toasts.push(toast);
                    
                    // Auto remove after 5 seconds
                    setTimeout(() => {
                        this.removeToast(toast.id);
                    }, 5000);
                },
                
                removeToast(id) {
                    this.toasts = this.toasts.filter(toast => toast.id !== id);
                }
            }
        }).mount('#app');
    </script>

    <!-- ============ app.js - DATABASE & BACKEND INTEGRATION ============ -->
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://your-project.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        class DatabaseService {
            constructor() {
                this.app = null;
            }
            
            // Link Vue app with database service
            linkVueApp(vueApp) {
                this.app = vueApp;
                this.initializeRealData();
            }
            
            async initializeRealData() {
                try {
                    // Load medical staff
                    await this.loadMedicalStaff();
                    
                    // Load on-call schedules
                    await this.loadOnCallSchedules();
                    
                    // Load training units
                    await this.loadTrainingUnits();
                    
                    // Load resident rotations
                    await this.loadResidentRotations();
                    
                    // Load leave requests
                    await this.loadLeaveRequests();
                    
                    // Load audit logs
                    await this.loadAuditLogs();
                    
                    // Load announcements
                    await this.loadAnnouncements();
                    
                    console.log('All data loaded successfully');
                } catch (error) {
                    console.error('Error initializing data:', error);
                    this.app.showToast('error', 'Data Load Error', 'Failed to load initial data from database');
                }
            }
            
            // ============ MEDICAL STAFF ============
            async loadMedicalStaff() {
                try {
                    const { data, error } = await supabase
                        .from('medical_staff')
                        .select('*')
                        .order('full_name', { ascending: true });
                    
                    if (error) throw error;
                    
                    this.app.medicalStaff = data.map(staff => ({
                        ...staff,
                        last_activity: new Date(staff.updated_at || staff.created_at).getTime()
                    }));
                    
                    // Update stats
                    this.app.stats.totalStaff = this.app.medicalStaff.length;
                    this.app.stats.activeResidents = this.app.medicalStaff.filter(s => 
                        s.staff_type === 'medical_resident' && s.employment_status === 'active'
                    ).length;
                    this.app.stats.attendings = this.app.medicalStaff.filter(s => 
                        s.staff_type === 'attending_physician' && s.employment_status === 'active'
                    ).length;
                    
                } catch (error) {
                    console.error('Error loading medical staff:', error);
                    throw error;
                }
            }
            
            async saveMedicalStaff(staffData) {
                try {
                    let data, error;
                    
                    if (staffData.id) {
                        // Update existing staff
                        const { data: updated, error: updateError } = await supabase
                            .from('medical_staff')
                            .update({
                                ...staffData,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', staffData.id)
                            .select()
                            .single();
                        
                        data = updated;
                        error = updateError;
                    } else {
                        // Create new staff
                        const { data: created, error: createError } = await supabase
                            .from('medical_staff')
                            .insert([
                                {
                                    ...staffData,
                                    created_at: new Date().toISOString(),
                                    updated_at: new Date().toISOString()
                                }
                            ])
                            .select()
                            .single();
                        
                        data = created;
                        error = createError;
                    }
                    
                    if (error) throw error;
                    
                    // Refresh the data
                    await this.loadMedicalStaff();
                    
                    return data;
                } catch (error) {
                    console.error('Error saving medical staff:', error);
                    throw error;
                }
            }
            
            async deleteMedicalStaff(staffId) {
                try {
                    const { error } = await supabase
                        .from('medical_staff')
                        .delete()
                        .eq('id', staffId);
                    
                    if (error) throw error;
                    
                    // Refresh the data
                    await this.loadMedicalStaff();
                    
                } catch (error) {
                    console.error('Error deleting medical staff:', error);
                    throw error;
                }
            }
            
            // ============ ON-CALL SCHEDULES ============
            async loadOnCallSchedules() {
                try {
                    const { data, error } = await supabase
                        .from('oncall_schedule')
                        .select('*')
                        .order('duty_date', { ascending: true });
                    
                    if (error) throw error;
                    
                    this.app.onCallSchedule = data;
                    this.app.generateNextSevenDays();
                    
                } catch (error) {
                    console.error('Error loading on-call schedules:', error);
                    throw error;
                }
            }
            
            async saveOnCallSchedule(scheduleData) {
                try {
                    let data, error;
                    
                    if (scheduleData.id) {
                        // Update existing schedule
                        const { data: updated, error: updateError } = await supabase
                            .from('oncall_schedule')
                            .update({
                                ...scheduleData,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', scheduleData.id)
                            .select()
                            .single();
                        
                        data = updated;
                        error = updateError;
                    } else {
                        // Create new schedule
                        const { data: created, error: createError } = await supabase
                            .from('oncall_schedule')
                            .insert([
                                {
                                    ...scheduleData,
                                    created_at: new Date().toISOString(),
                                    updated_at: new Date().toISOString()
                                }
                            ])
                            .select()
                            .single();
                        
                        data = created;
                        error = createError;
                    }
                    
                    if (error) throw error;
                    
                    // Refresh the data
                    await this.loadOnCallSchedules();
                    
                    return data;
                } catch (error) {
                    console.error('Error saving on-call schedule:', error);
                    throw error;
                }
            }
            
            async deleteOnCallSchedule(scheduleId) {
                try {
                    const { error } = await supabase
                        .from('oncall_schedule')
                        .delete()
                        .eq('id', scheduleId);
                    
                    if (error) throw error;
                    
                    // Refresh the data
                    await this.loadOnCallSchedules();
                    
                } catch (error) {
                    console.error('Error deleting on-call schedule:', error);
                    throw error;
                }
            }
            
            // ============ TRAINING UNITS ============
            async loadTrainingUnits() {
                try {
                    const { data, error } = await supabase
                        .from('training_units')
                        .select('*')
                        .order('unit_name', { ascending: true });
                    
                    if (error) throw error;
                    
                    this.app.trainingUnits = data;
                    
                } catch (error) {
                    console.error('Error loading training units:', error);
                    throw error;
                }
            }
            
            async saveTrainingUnit(unitData) {
                try {
                    let data, error;
                    
                    if (unitData.id) {
                        // Update existing unit
                        const { data: updated, error: updateError } = await supabase
                            .from('training_units')
                            .update({
                                ...unitData,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', unitData.id)
                            .select()
                            .single();
                        
                        data = updated;
                        error = updateError;
                    } else {
                        // Create new unit
                        const { data: created, error: createError } = await supabase
                            .from('training_units')
                            .insert([
                                {
                                    ...unitData,
                                    created_at: new Date().toISOString(),
                                    updated_at: new Date().toISOString()
                                }
                            ])
                            .select()
                            .single();
                        
                        data = created;
                        error = createError;
                    }
                    
                    if (error) throw error;
                    
                    // Refresh the data
                    await this.loadTrainingUnits();
                    
                    return data;
                } catch (error) {
                    console.error('Error saving training unit:', error);
                    throw error;
                }
            }
            
            // ============ RESIDENT ROTATIONS ============
            async loadResidentRotations() {
                try {
                    const { data, error } = await supabase
                        .from('resident_rotations')
                        .select('*')
                        .order('rotation_start_date', { ascending: true });
                    
                    if (error) throw error;
                    
                    this.app.residentRotations = data;
                    
                } catch (error) {
                    console.error('Error loading resident rotations:', error);
                    throw error;
                }
            }
            
            async saveResidentRotation(rotationData) {
                try {
                    let data, error;
                    
                    if (rotationData.id) {
                        // Update existing rotation
                        const { data: updated, error: updateError } = await supabase
                            .from('resident_rotations')
                            .update({
                                ...rotationData,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', rotationData.id)
                            .select()
                            .single();
                        
                        data = updated;
                        error = updateError;
                    } else {
                        // Create new rotation
                        const { data: created, error: createError } = await supabase
                            .from('resident_rotations')
                            .insert([
                                {
                                    ...rotationData,
                                    created_at: new Date().toISOString(),
                                    updated_at: new Date().toISOString()
                                }
                            ])
                            .select()
                            .single();
                        
                        data = created;
                        error = createError;
                    }
                    
                    if (error) throw error;
                    
                    // Refresh the data
                    await this.loadResidentRotations();
                    
                    return data;
                } catch (error) {
                    console.error('Error saving resident rotation:', error);
                    throw error;
                }
            }
            
            async deleteResidentRotation(rotationId) {
                try {
                    const { error } = await supabase
                        .from('resident_rotations')
                        .delete()
                        .eq('id', rotationId);
                    
                    if (error) throw error;
                    
                    // Refresh the data
                    await this.loadResidentRotations();
                    
                } catch (error) {
                    console.error('Error deleting resident rotation:', error);
                    throw error;
                }
            }
            
            // ============ LEAVE REQUESTS ============
            async loadLeaveRequests() {
                try {
                    const { data, error } = await supabase
                        .from('leave_requests')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    
                    this.app.leaveRequests = data;
                    
                } catch (error) {
                    console.error('Error loading leave requests:', error);
                    throw error;
                }
            }
            
            async saveLeaveRequest(leaveData) {
                try {
                    let data, error;
                    
                    if (leaveData.id) {
                        // Update existing leave request
                        const { data: updated, error: updateError } = await supabase
                            .from('leave_requests')
                            .update({
                                ...leaveData,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', leaveData.id)
                            .select()
                            .single();
                        
                        data = updated;
                        error = updateError;
                    } else {
                        // Create new leave request
                        const { data: created, error: createError } = await supabase
                            .from('leave_requests')
                            .insert([
                                {
                                    ...leaveData,
                                    created_at: new Date().toISOString(),
                                    updated_at: new Date().toISOString()
                                }
                            ])
                            .select()
                            .single();
                        
                        data = created;
                        error = createError;
                    }
                    
                    if (error) throw error;
                    
                    // Refresh the data
                    await this.loadLeaveRequests();
                    
                    return data;
                } catch (error) {
                    console.error('Error saving leave request:', error);
                    throw error;
                }
            }
            
            // ============ AUDIT LOGS ============
            async loadAuditLogs() {
                try {
                    const { data, error } = await supabase
                        .from('audit_logs')
                        .select('*')
                        .order('timestamp', { ascending: false })
                        .limit(100);
                    
                    if (error) throw error;
                    
                    this.app.auditLogs = data;
                    
                } catch (error) {
                    console.error('Error loading audit logs:', error);
                    throw error;
                }
            }
            
            async logAuditEvent(userId, action, resource, details) {
                try {
                    const { error } = await supabase
                        .from('audit_logs')
                        .insert([
                            {
                                user_id: userId,
                                user_name: this.app.currentUser?.full_name || 'Unknown',
                                user_role: this.app.currentUser?.user_role || 'unknown',
                                action,
                                resource,
                                details,
                                timestamp: new Date().toISOString(),
                                permission_level: this.app.getResourcePermissionLevel(resource)
                            }
                        ]);
                    
                    if (error) throw error;
                    
                    // Refresh audit logs
                    await this.loadAuditLogs();
                    
                } catch (error) {
                    console.error('Error logging audit event:', error);
                }
            }
            
            // ============ ANNOUNCEMENTS ============
            async loadAnnouncements() {
                try {
                    const { data, error } = await supabase
                        .from('announcements')
                        .select('*')
                        .order('publish_start_date', { ascending: false })
                        .limit(10);
                    
                    if (error) throw error;
                    
                    this.app.announcements = data;
                    this.app.recentAnnouncements = data.slice(0, 5);
                    
                } catch (error) {
                    console.error('Error loading announcements:', error);
                    throw error;
                }
            }
            
            async saveAnnouncement(announcementData) {
                try {
                    const { data, error } = await supabase
                        .from('announcements')
                        .insert([
                            {
                                ...announcementData,
                                created_at: new Date().toISOString(),
                                updated_at: new Date().toISOString()
                            }
                        ])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    // Refresh announcements
                    await this.loadAnnouncements();
                    
                    return data;
                } catch (error) {
                    console.error('Error saving announcement:', error);
                    throw error;
                }
            }
            
            // ============ REAL-TIME SUBSCRIPTIONS ============
            setupRealtimeSubscriptions() {
                // Medical Staff updates
                supabase
                    .channel('medical-staff-changes')
                    .on('postgres_changes', 
                        { event: '*', schema: 'public', table: 'medical_staff' }, 
                        async (payload) => {
                            console.log('Medical staff change received:', payload);
                            await this.loadMedicalStaff();
                        }
                    )
                    .subscribe();
                
                // On-call schedule updates
                supabase
                    .channel('oncall-schedule-changes')
                    .on('postgres_changes', 
                        { event: '*', schema: 'public', table: 'oncall_schedule' }, 
                        async (payload) => {
                            console.log('On-call schedule change received:', payload);
                            await this.loadOnCallSchedules();
                        }
                    )
                    .subscribe();
                
                // Leave request updates
                supabase
                    .channel('leave-requests-changes')
                    .on('postgres_changes', 
                        { event: '*', schema: 'public', table: 'leave_requests' }, 
                        async (payload) => {
                            console.log('Leave request change received:', payload);
                            await this.loadLeaveRequests();
                        }
                    )
                    .subscribe();
                
                console.log('Realtime subscriptions established');
            }
            
            // ============ AUTHENTICATION ============
            async authenticateUser(email, password, userRole) {
                try {
                    // In a real app, you would use Supabase Auth
                    // For demo purposes, we'll simulate authentication
                    
                    // Check if user exists in medical_staff table
                    const { data: staff, error } = await supabase
                        .from('medical_staff')
                        .select('*')
                        .eq('professional_email', email)
                        .single();
                    
                    if (error || !staff) {
                        // For demo, allow admin login
                        if (email === 'admin@neumocare.org' && password === 'password123') {
                            return {
                                id: 0,
                                full_name: 'System Administrator',
                                email: email,
                                user_role: userRole
                            };
                        }
                        throw new Error('Invalid credentials');
                    }
                    
                    // Verify password (in real app, use Supabase Auth)
                    if (password !== 'password123') { // Demo password
                        throw new Error('Invalid credentials');
                    }
                    
                    return {
                        id: staff.id,
                        full_name: staff.full_name,
                        email: staff.professional_email,
                        user_role: this.determineUserRole(staff)
                    };
                    
                } catch (error) {
                    console.error('Authentication error:', error);
                    throw error;
                }
            }
            
            determineUserRole(staff) {
                // Determine user role based on staff type and permissions
                if (staff.staff_type === 'attending_physician' && staff.can_supervise_residents) {
                    return 'department_head';
                } else if (staff.staff_type === 'attending_physician') {
                    return 'attending_physician';
                } else if (staff.staff_type === 'medical_resident') {
                    return 'viewing_doctor';
                }
                return 'viewing_doctor';
            }
            
            // ============ DATA EXPORT ============
            async exportData(table, format) {
                try {
                    const { data, error } = await supabase
                        .from(table)
                        .select('*');
                    
                    if (error) throw error;
                    
                    if (format === 'csv') {
                        return this.convertToCSV(data);
                    } else if (format === 'json') {
                        return JSON.stringify(data, null, 2);
                    } else {
                        return data;
                    }
                    
                } catch (error) {
                    console.error('Error exporting data:', error);
                    throw error;
                }
            }
            
            convertToCSV(data) {
                if (!data.length) return '';
                
                const headers = Object.keys(data[0]);
                const csvRows = [
                    headers.join(','),
                    ...data.map(row => 
                        headers.map(header => 
                            JSON.stringify(row[header] || '')
                        ).join(',')
                    )
                ];
                
                return csvRows.join('\n');
            }
            
            // ============ STATISTICS ============
            async getLiveStats() {
                try {
                    // Get current occupancy stats
                    const { data: occupancy, error: occupancyError } = await supabase
                        .from('hospital_capacity')
                        .select('*')
                        .order('timestamp', { ascending: false })
                        .limit(1)
                        .single();
                    
                    if (!occupancyError && occupancy) {
                        this.app.liveStats = {
                            occupancy: occupancy.occupancy_rate || 85,
                            occupancyTrend: occupancy.trend || 2.5,
                            onDutyStaff: await this.getOnDutyStaffCount(),
                            staffTrend: 3,
                            pendingRequests: await this.getPendingRequestsCount(),
                            erCapacity: {
                                current: occupancy.er_current || 12,
                                max: occupancy.er_max || 15,
                                status: this.app.getCapacityStatus({ 
                                    current: occupancy.er_current, 
                                    max: occupancy.er_max 
                                })
                            },
                            icuCapacity: {
                                current: occupancy.icu_current || 8,
                                max: occupancy.icu_max || 10,
                                status: this.app.getCapacityStatus({ 
                                    current: occupancy.icu_current, 
                                    max: occupancy.icu_max 
                                })
                            },
                            wardCapacity: {
                                current: occupancy.ward_current || 45,
                                max: occupancy.ward_max || 50,
                                status: this.app.getCapacityStatus({ 
                                    current: occupancy.ward_current, 
                                    max: occupancy.ward_max 
                                })
                            },
                            todayAdmissions: await this.getTodayAdmissions(),
                            avgStay: occupancy.avg_stay || 4.2
                        };
                    }
                    
                } catch (error) {
                    console.error('Error getting live stats:', error);
                }
            }
            
            async getOnDutyStaffCount() {
                try {
                    const { count, error } = await supabase
                        .from('medical_staff')
                        .select('*', { count: 'exact', head: true })
                        .eq('employment_status', 'active')
                        .eq('is_on_duty', true);
                    
                    if (error) throw error;
                    
                    return count || 42;
                } catch (error) {
                    console.error('Error getting on-duty staff count:', error);
                    return 42;
                }
            }
            
            async getPendingRequestsCount() {
                try {
                    const { count, error } = await supabase
                        .from('leave_requests')
                        .select('*', { count: 'exact', head: true })
                        .eq('status', 'pending');
                    
                    if (error) throw error;
                    
                    return count || 18;
                } catch (error) {
                    console.error('Error getting pending requests count:', error);
                    return 18;
                }
            }
            
            async getTodayAdmissions() {
                try {
                    const today = new Date().toISOString().split('T')[0];
                    const { count, error } = await supabase
                        .from('patient_admissions')
                        .select('*', { count: 'exact', head: true })
                        .gte('admission_date', today)
                        .lte('admission_date', today);
                    
                    if (error) throw error;
                    
                    return count || 7;
                } catch (error) {
                    console.error('Error getting today admissions:', error);
                    return 7;
                }
            }
            
            // ============ COVERAGE ALERTS ============
            async checkCoverageAlerts() {
                try {
                    const { data: units, error } = await supabase
                        .from('training_units')
                        .select('*')
                        .eq('unit_status', 'active');
                    
                    if (error) throw error;
                    
                    const alerts = [];
                    
                    for (const unit of units) {
                        // Get current resident count for this unit
                        const { count, error: countError } = await supabase
                            .from('resident_placements')
                            .select('*', { count: 'exact', head: true })
                            .eq('unit_id', unit.id)
                            .eq('placement_status', 'active');
                        
                        if (!countError) {
                            const current = count || 0;
                            const capacity = unit.maximum_residents;
                            const occupancyRate = (current / capacity) * 100;
                            
                            if (occupancyRate < 50) {
                                alerts.push({
                                    id: unit.id,
                                    unit_name: unit.unit_name,
                                    unit_id: unit.id,
                                    current: current,
                                    capacity: capacity,
                                    priority: occupancyRate < 30 ? 'high' : 'medium'
                                });
                            }
                        }
                    }
                    
                    this.app.coverageAlerts = alerts;
                    this.app.stats.coverageAlerts = alerts.length;
                    
                } catch (error) {
                    console.error('Error checking coverage alerts:', error);
                }
            }
            
            // ============ INTEGRATION METHODS ============
            // These methods replace the demo methods in Vue app with real database calls
            
            integrateWithVueApp() {
                // Override Vue methods with database calls
                const originalMethods = {
                    handleAdvancedLogin: this.app.handleAdvancedLogin,
                    saveMedicalStaff: this.app.saveMedicalStaff,
                    deleteMedicalStaff: this.app.deleteMedicalStaff,
                    saveOnCallSchedule: this.app.saveOnCallSchedule,
                    deleteOnCallSchedule: this.app.deleteOnCallSchedule,
                    saveTrainingUnit: this.app.saveTrainingUnit,
                    saveResidentRotation: this.app.saveResidentRotation,
                    deleteResidentRotation: this.app.deleteResidentRotation,
                    saveLeaveRequest: this.app.saveLeaveRequest,
                    approveLeaveRequest: this.app.approveLeaveRequest,
                    rejectLeaveRequest: this.app.rejectLeaveRequest,
                    saveCommunication: this.app.saveCommunication,
                    exportData: this.app.exportData
                };
                
                // Authentication
                this.app.handleAdvancedLogin = async () => {
                    this.app.loading = true;
                    
                    try {
                        const user = await this.authenticateUser(
                            this.app.loginForm.email,
                            this.app.loginForm.password,
                            this.app.loginForm.user_role
                        );
                        
                        this.app.currentUser = user;
                        
                        // Log audit event
                        await this.logAuditEvent(
                            user.id,
                            'login',
                            'system',
                            `User logged in as ${user.user_role}`
                        );
                        
                        // Load real data
                        await this.initializeRealData();
                        
                        // Setup realtime subscriptions
                        this.setupRealtimeSubscriptions();
                        
                        this.app.showToast('success', 'Login Successful', 'Welcome to NeumoCare Hospital Management System');
                        
                    } catch (error) {
                        this.app.showToast('error', 'Login Failed', error.message || 'Invalid credentials');
                    } finally {
                        this.app.loading = false;
                    }
                };
                
                // Medical Staff
                this.app.saveMedicalStaff = async () => {
                    this.app.saving = true;
                    
                    try {
                        await this.saveMedicalStaff(this.app.medicalStaffModal.form);
                        
                        // Log audit event
                        await this.logAuditEvent(
                            this.app.currentUser.id,
                            this.app.medicalStaffModal.mode === 'add' ? 'create' : 'update',
                            'medical_staff',
                            `${this.app.medicalStaffModal.mode === 'add' ? 'Added' : 'Updated'} staff: ${this.app.medicalStaffModal.form.full_name}`
                        );
                        
                        this.app.showToast(
                            'success',
                            this.app.medicalStaffModal.mode === 'add' ? 'Staff Added' : 'Staff Updated',
                            `${this.app.medicalStaffModal.form.full_name} has been ${this.app.medicalStaffModal.mode === 'add' ? 'added to' : 'updated in'} the system`
                        );
                        
                        this.app.medicalStaffModal.show = false;
                        
                    } catch (error) {
                        this.app.showToast('error', 'Save Failed', error.message || 'Failed to save medical staff');
                    } finally {
                        this.app.saving = false;
                    }
                };
                
                this.app.deleteMedicalStaff = async (staff) => {
                    if (confirm(`Are you sure you want to delete ${staff.full_name}?`)) {
                        try {
                            await this.deleteMedicalStaff(staff.id);
                            
                            // Log audit event
                            await this.logAuditEvent(
                                this.app.currentUser.id,
                                'delete',
                                'medical_staff',
                                `Deleted staff: ${staff.full_name}`
                            );
                            
                            this.app.showToast('success', 'Staff Deleted', `${staff.full_name} has been removed from the system`);
                            
                        } catch (error) {
                            this.app.showToast('error', 'Delete Failed', error.message || 'Failed to delete medical staff');
                        }
                    }
                };
                
                // On-call Schedule
                this.app.saveOnCallSchedule = async () => {
                    this.app.saving = true;
                    
                    try {
                        await this.saveOnCallSchedule(this.app.onCallModal.form);
                        
                        // Log audit event
                        await this.logAuditEvent(
                            this.app.currentUser.id,
                            this.app.onCallModal.mode === 'add' ? 'create' : 'update',
                            'oncall_schedule',
                            `${this.app.onCallModal.mode === 'add' ? 'Added' : 'Updated'} on-call schedule`
                        );
                        
                        this.app.showToast(
                            'success',
                            this.app.onCallModal.mode === 'add' ? 'Schedule Added' : 'Schedule Updated',
                            `On-call schedule has been ${this.app.onCallModal.mode === 'add' ? 'created' : 'updated'}`
                        );
                        
                        this.app.onCallModal.show = false;
                        this.app.generateNextSevenDays();
                        
                    } catch (error) {
                        this.app.showToast('error', 'Save Failed', error.message || 'Failed to save on-call schedule');
                    } finally {
                        this.app.saving = false;
                    }
                };
                
                this.app.deleteOnCallSchedule = async (schedule) => {
                    if (confirm('Are you sure you want to delete this on-call schedule?')) {
                        try {
                            await this.deleteOnCallSchedule(schedule.id);
                            
                            // Log audit event
                            await this.logAuditEvent(
                                this.app.currentUser.id,
                                'delete',
                                'oncall_schedule',
                                `Deleted on-call schedule for ${schedule.duty_date}`
                            );
                            
                            this.app.showToast('success', 'Schedule Deleted', 'On-call schedule has been removed');
                            this.app.generateNextSevenDays();
                            
                        } catch (error) {
                            this.app.showToast('error', 'Delete Failed', error.message || 'Failed to delete on-call schedule');
                        }
                    }
                };
                
                // Training Units
                this.app.saveTrainingUnit = async () => {
                    this.app.saving = true;
                    
                    try {
                        await this.saveTrainingUnit(this.app.trainingUnitModal.form);
                        
                        // Log audit event
                        await this.logAuditEvent(
                            this.app.currentUser.id,
                            this.app.trainingUnitModal.mode === 'add' ? 'create' : 'update',
                            'training_units',
                            `${this.app.trainingUnitModal.mode === 'add' ? 'Added' : 'Updated'} training unit: ${this.app.trainingUnitModal.form.unit_name}`
                        );
                        
                        this.app.showToast(
                            'success',
                            this.app.trainingUnitModal.mode === 'add' ? 'Unit Added' : 'Unit Updated',
                            `${this.app.trainingUnitModal.form.unit_name} has been ${this.app.trainingUnitModal.mode === 'add' ? 'added' : 'updated'}`
                        );
                        
                        this.app.trainingUnitModal.show = false;
                        
                    } catch (error) {
                        this.app.showToast('error', 'Save Failed', error.message || 'Failed to save training unit');
                    } finally {
                        this.app.saving = false;
                    }
                };
                
                // Resident Rotations
                this.app.saveResidentRotation = async () => {
                    this.app.saving = true;
                    
                    try {
                        await this.saveResidentRotation(this.app.rotationModal.form);
                        
                        // Log audit event
                        await this.logAuditEvent(
                            this.app.currentUser.id,
                            this.app.rotationModal.mode === 'add' ? 'create' : 'update',
                            'resident_rotations',
                            `${this.app.rotationModal.mode === 'add' ? 'Created' : 'Updated'} rotation: ${this.app.rotationModal.form.rotation_id}`
                        );
                        
                        this.app.showToast(
                            'success',
                            this.app.rotationModal.mode === 'add' ? 'Rotation Created' : 'Rotation Updated',
                            `Rotation ${this.app.rotationModal.form.rotation_id} has been ${this.app.rotationModal.mode === 'add' ? 'created' : 'updated'}`
                        );
                        
                        this.app.rotationModal.show = false;
                        
                    } catch (error) {
                        this.app.showToast('error', 'Save Failed', error.message || 'Failed to save resident rotation');
                    } finally {
                        this.app.saving = false;
                    }
                };
                
                this.app.deleteResidentRotation = async (rotation) => {
                    if (confirm(`Delete rotation ${rotation.rotation_id}?`)) {
                        try {
                            await this.deleteResidentRotation(rotation.id);
                            
                            // Log audit event
                            await this.logAuditEvent(
                                this.app.currentUser.id,
                                'delete',
                                'resident_rotations',
                                `Deleted rotation: ${rotation.rotation_id}`
                            );
                            
                            this.app.showToast('success', 'Rotation Deleted', 'Rotation has been removed');
                            
                        } catch (error) {
                            this.app.showToast('error', 'Delete Failed', error.message || 'Failed to delete resident rotation');
                        }
                    }
                };
                
                // Leave Requests
                this.app.saveLeaveRequest = async () => {
                    this.app.saving = true;
                    
                    try {
                        const leaveData = {
                            ...this.app.leaveRequestModal.form,
                            staff_member_id: this.app.currentUser.id,
                            total_days: this.app.calculateDaysDifference(
                                this.app.leaveRequestModal.form.start_date,
                                this.app.leaveRequestModal.form.end_date
                            )
                        };
                        
                        await this.saveLeaveRequest(leaveData);
                        
                        // Log audit event
                        await this.logAuditEvent(
                            this.app.currentUser.id,
                            'create',
                            'leave_requests',
                            `Submitted leave request for ${leaveData.total_days} days`
                        );
                        
                        this.app.showToast('success', 'Leave Request Submitted', 'Your leave request has been submitted for approval');
                        this.app.leaveRequestModal.show = false;
                        
                    } catch (error) {
                        this.app.showToast('error', 'Submit Failed', error.message || 'Failed to submit leave request');
                    } finally {
                        this.app.saving = false;
                    }
                };
                
                this.app.approveLeaveRequest = async (request) => {
                    try {
                        request.status = 'approved';
                        request.decision_date = new Date().toISOString();
                        
                        await this.saveLeaveRequest(request);
                        
                        // Log audit event
                        await this.logAuditEvent(
                            this.app.currentUser.id,
                            'approve',
                            'leave_requests',
                            `Approved leave request ID: ${request.id}`
                        );
                        
                        this.app.showToast('success', 'Leave Approved', 'Leave request has been approved');
                        this.app.leaveDetailsModal.show = false;
                        
                    } catch (error) {
                        this.app.showToast('error', 'Approval Failed', error.message || 'Failed to approve leave request');
                    }
                };
                
                this.app.rejectLeaveRequest = async (request) => {
                    try {
                        request.status = 'rejected';
                        request.decision_date = new Date().toISOString();
                        
                        await this.saveLeaveRequest(request);
                        
                        // Log audit event
                        await this.logAuditEvent(
                            this.app.currentUser.id,
                            'reject',
                            'leave_requests',
                            `Rejected leave request ID: ${request.id}`
                        );
                        
                        this.app.showToast('warning', 'Leave Rejected', 'Leave request has been rejected');
                        this.app.leaveDetailsModal.show = false;
                        
                    } catch (error) {
                        this.app.showToast('error', 'Rejection Failed', error.message || 'Failed to reject leave request');
                    }
                };
                
                // Communications
                this.app.saveCommunication = async () => {
                    this.app.saving = true;
                    
                    try {
                        if (this.app.communicationsModal.activeTab === 'announcement') {
                            await this.saveAnnouncement(this.app.communicationsModal.form);
                            
                            // Log audit event
                            await this.logAuditEvent(
                                this.app.currentUser.id,
                                'create',
                                'communications',
                                `Published announcement: ${this.app.communicationsModal.form.announcement_title}`
                            );
                            
                            this.app.showToast('success', 'Announcement Published', 'New announcement has been published');
                            
                        } else if (this.app.communicationsModal.activeTab === 'capacity') {
                            // Save capacity data to database
                            // This would typically go to a hospital_capacity table
                            
                            // Log audit event
                            await this.logAuditEvent(
                                this.app.currentUser.id,
                                'update',
                                'communications',
                                'Updated department capacity planning'
                            );
                            
                            this.app.showToast('success', 'Capacity Updated', 'Department capacity has been updated');
                            
                        } else if (this.app.communicationsModal.activeTab === 'quick') {
                            // Save quick update to database
                            // This would typically go to a quick_updates table
                            
                            // Log audit event
                            await this.logAuditEvent(
                                this.app.currentUser.id,
                                'create',
                                'communications',
                                'Posted quick update'
                            );
                            
                            this.app.showToast('success', 'Update Posted', 'Quick update has been posted');
                        }
                        
                        this.app.communicationsModal.show = false;
                        
                    } catch (error) {
                        this.app.showToast('error', 'Save Failed', error.message || 'Failed to save communication');
                    } finally {
                        this.app.saving = false;
                    }
                };
                
                // Export Data
                this.app.exportData = async () => {
                    this.app.saving = true;
                    
                    try {
                        const data = await this.exportData(
                            this.app.importExportModal.selectedTable,
                            this.app.importExportModal.exportFormat
                        );
                        
                        // Create download link
                        const blob = new Blob([data], { type: 'text/plain' });
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${this.app.importExportModal.selectedTable}_export.${this.app.importExportModal.exportFormat === 'json' ? 'json' : 'csv'}`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        
                        // Log audit event
                        await this.logAuditEvent(
                            this.app.currentUser.id,
                            'export',
                            this.app.importExportModal.selectedTable,
                            `Exported data in ${this.app.importExportModal.exportFormat.toUpperCase()} format`
                        );
                        
                        this.app.showToast('success', 'Export Complete', `Data exported successfully`);
                        this.app.importExportModal.show = false;
                        
                    } catch (error) {
                        this.app.showToast('error', 'Export Failed', error.message || 'Failed to export data');
                    } finally {
                        this.app.saving = false;
                    }
                };
                
                // Update the updateLiveStats method to use real data
                const originalUpdateLiveStats = this.app.updateLiveStats;
                this.app.updateLiveStats = async () => {
                    await this.getLiveStats();
                    await this.checkCoverageAlerts();
                };
                
                console.log('Vue app integrated with database service');
            }
        }
        
        // Initialize and link the database service when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            const dbService = new DatabaseService();
            
            // Get the Vue app instance (we need to wait for it to be mounted)
            setTimeout(() => {
                const vueApp = document.querySelector('#app').__vue_app__?.config.globalProperties.$root;
                if (vueApp) {
                    dbService.linkVueApp(vueApp);
                    dbService.integrateWithVueApp();
                    
                    // Start periodic updates
                    setInterval(() => {
                        dbService.getLiveStats();
                        dbService.checkCoverageAlerts();
                    }, 30000); // Every 30 seconds
                } else {
                    console.warn('Vue app not found, running in demo mode');
                }
            }, 1000);
        });
    </script>
</body>
</html>
