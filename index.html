<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRBA Hospital Management System</title>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* ============ BASE STYLES ============ */
        :root {
            --primary-color: #1a73e8;
            --primary-dark: #0d47a1;
            --primary-light: #e8f0fe;
            --secondary-color: #34a853;
            --danger-color: #ea4335;
            --warning-color: #fbbc05;
            --info-color: #4285f4;
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f4;
            --gray-200: #e8eaed;
            --gray-300: #dadce0;
            --gray-400: #bdc1c6;
            --gray-500: #9aa0a6;
            --gray-600: #80868b;
            --gray-700: #5f6368;
            --gray-800: #3c4043;
            --gray-900: #202124;
            
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.15);
            --shadow-xl: 0 20px 60px rgba(0,0,0,0.2);
            
            --border-radius-sm: 6px;
            --border-radius-md: 10px;
            --border-radius-lg: 16px;
            --border-radius-xl: 24px;
            
            --transition-fast: 150ms;
            --transition-normal: 250ms;
            --transition-slow: 350ms;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            line-height: 1.3;
        }

        /* ============ UTILITY CLASSES ============ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .text-primary { color: var(--primary-color); }
        .text-success { color: var(--secondary-color); }
        .text-danger { color: var(--danger-color); }
        .text-warning { color: var(--warning-color); }
        .text-info { color: var(--info-color); }
        .text-muted { color: var(--gray-600); }

        .bg-primary { background: var(--primary-color); }
        .bg-success { background: var(--secondary-color); }
        .bg-danger { background: var(--danger-color); }
        .bg-warning { background: var(--warning-color); }
        .bg-info { background: var(--info-color); }
        .bg-light { background: var(--gray-50); }

        .shadow-sm { box-shadow: var(--shadow-sm); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }

        .rounded-sm { border-radius: var(--border-radius-sm); }
        .rounded-md { border-radius: var(--border-radius-md); }
        .rounded-lg { border-radius: var(--border-radius-lg); }
        .rounded-xl { border-radius: var(--border-radius-xl); }

        .transition { transition: all var(--transition-normal) ease; }

        /* ============ BUTTONS ============ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius-md);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 14px;
            line-height: 1;
            cursor: pointer;
            transition: all var(--transition-normal) ease;
            white-space: nowrap;
        }

        .btn i { font-size: 14px; }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-800);
            border: 1px solid var(--gray-300);
        }
        .btn-secondary:hover {
            background: var(--gray-200);
            border-color: var(--gray-400);
        }

        .btn-success {
            background: var(--secondary-color);
            color: white;
        }
        .btn-success:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        .btn-danger:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-sm { padding: 6px 12px; font-size: 13px; }
        .btn-lg { padding: 14px 28px; font-size: 16px; }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 50%;
        }

        /* ============ BADGES ============ */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-resident-advanced {
            background: linear-gradient(135deg, #4285f4, #34a853);
            color: white;
        }

        .badge-attending-advanced {
            background: linear-gradient(135deg, #ea4335, #fbbc05);
            color: white;
        }

        .badge-admin-advanced {
            background: linear-gradient(135deg, #8e24aa, #1a237e);
            color: white;
        }

        .badge-supervisor-advanced {
            background: linear-gradient(135deg, #00acc1, #00897b);
            color: white;
        }

        /* ============ STATUS BADGES ============ */
        .status-available {
            background: linear-gradient(135deg, #34a853, #0d9d58);
            color: white;
        }

        .status-busy {
            background: linear-gradient(135deg, #fbbc05, #f9ab00);
            color: white;
        }

        .status-critical {
            background: linear-gradient(135deg, #ea4335, #d23f31);
            color: white;
        }

        .status-oncall {
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            color: white;
        }

        .status-reported {
            background: linear-gradient(135deg, #8e24aa, #7b1fa2);
            color: white;
        }

        /* ============ CARDS ============ */
        .card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal) ease;
            border: 1px solid var(--gray-200);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--gray-100);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary-color);
        }

        /* ============ FORMS ============ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-800);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            transition: all var(--transition-normal) ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .form-check-input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .form-check-label {
            font-size: 14px;
            color: var(--gray-700);
            cursor: pointer;
        }

        /* ============ TABLES ============ */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--border-radius-md);
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        }

        .table th {
            padding: 16px;
            text-align: left;
            color: white;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--gray-200);
        }

        .table tbody tr {
            border-bottom: 1px solid var(--gray-100);
            transition: all var(--transition-fast) ease;
        }

        .table tbody tr:hover {
            background: var(--primary-light);
        }

        .table td {
            padding: 16px;
            font-size: 14px;
            color: var(--gray-700);
            vertical-align: middle;
        }

        /* ============ MODALS ============ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .modal-container {
            background: white;
            border-radius: var(--border-radius-lg);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 2px solid var(--gray-100);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast) ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 2px solid var(--gray-100);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: var(--gray-50);
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
        }

        /* ============ TOASTS ============ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: white;
            border-radius: var(--border-radius-md);
            padding: 16px 20px;
            min-width: 300px;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--primary-color);
            animation: toastSlideIn 0.3s ease;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-icon {
            font-size: 20px;
            color: var(--primary-color);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--gray-900);
        }

        .toast-message {
            font-size: 13px;
            color: var(--gray-700);
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray-500);
            font-size: 14px;
            cursor: pointer;
            padding: 2px;
        }

        .toast-success { border-left-color: var(--secondary-color); }
        .toast-success .toast-icon { color: var(--secondary-color); }

        .toast-error { border-left-color: var(--danger-color); }
        .toast-error .toast-icon { color: var(--danger-color); }

        .toast-warning { border-left-color: var(--warning-color); }
        .toast-warning .toast-icon { color: var(--warning-color); }

        .toast-permission { border-left-color: #8e24aa; }
        .toast-permission .toast-icon { color: #8e24aa; }

        /* ============ LOGIN SCREEN ============ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: white;
            border-radius: var(--border-radius-xl);
            padding: 48px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow-xl);
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .login-logo i {
            font-size: 42px;
            color: var(--primary-color);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-title {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: var(--gray-600);
            font-size: 16px;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ============ MAIN LAYOUT ============ */
        .app-layout {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        }

        /* ============ SIDEBAR ============ */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, var(--gray-900) 0%, var(--gray-800) 100%);
            color: white;
            display: flex;
            flex-direction: column;
            transition: all var(--transition-normal) ease;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 18px;
        }

        .sidebar-logo i {
            font-size: 24px;
            color: var(--primary-color);
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            transition: all var(--transition-fast) ease;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-section-title {
            padding: 0 24px 8px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gray-500);
            font-weight: 500;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu-item {
            margin: 2px 0;
        }

        .sidebar-menu-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            color: var(--gray-400);
            text-decoration: none;
            transition: all var(--transition-fast) ease;
            font-size: 14px;
            font-weight: 500;
            border-left: 3px solid transparent;
        }

        .sidebar-menu-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        .sidebar-menu-link.active {
            background: rgba(26, 115, 232, 0.2);
            color: white;
            border-left-color: var(--primary-color);
        }

        .sidebar-menu-link i {
            font-size: 16px;
            width: 24px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-role {
            font-size: 12px;
            color: var(--gray-500);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-collapsed .sidebar-header {
            justify-content: center;
        }

        .sidebar-collapsed .sidebar-logo span,
        .sidebar-collapsed .sidebar-section-title,
        .sidebar-collapsed .sidebar-menu-link span,
        .sidebar-collapsed .user-info,
        .sidebar-collapsed .sidebar-toggle span {
            display: none;
        }

        .sidebar-collapsed .sidebar-logo,
        .sidebar-collapsed .sidebar-menu-link {
            justify-content: center;
        }

        .sidebar-collapsed .sidebar-menu-link i {
            font-size: 18px;
        }

        /* ============ MAIN CONTENT ============ */
        .main-content {
            flex: 1;
            margin-left: 260px;
            transition: all var(--transition-normal) ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content-expanded {
            margin-left: 80px;
        }

        /* ============ TOP NAVBAR ============ */
        .top-navbar {
            background: white;
            padding: 16px 32px;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .navbar-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
        }

        .navbar-subtitle {
            font-size: 14px;
            color: var(--gray-600);
            margin-left: 10px;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 20px;
            color: var(--gray-700);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
        }

        .mobile-menu-toggle:hover {
            background: var(--gray-100);
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px 10px 42px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            transition: all var(--transition-normal) ease;
            background: var(--gray-50);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
            font-size: 16px;
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification-badge {
            position: relative;
        }

        .badge-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger-color);
            color: white;
            font-size: 11px;
            font-weight: 600;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-menu {
            position: relative;
        }

        .user-menu-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            background: none;
            border: none;
            padding: 8px 12px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast) ease;
        }

        .user-menu-toggle:hover {
            background: var(--gray-100);
        }

        .user-menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            z-index: 1000;
            overflow: hidden;
            animation: dropdownFade 0.2s ease;
        }

        @keyframes dropdownFade {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            color: var(--gray-700);
            text-decoration: none;
            transition: all var(--transition-fast) ease;
            font-size: 14px;
            border-bottom: 1px solid var(--gray-100);
        }

        .user-menu-item:hover {
            background: var(--gray-50);
            color: var(--primary-color);
        }

        .user-menu-item:last-child {
            border-bottom: none;
        }

        /* ============ CONTENT AREA ============ */
        .content-area {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        /* ============ DASHBOARD ============ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .dashboard-section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ============ STATS CARDS ============ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal) ease;
            border: 1px solid var(--gray-200);
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-icon.primary { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); }
        .stat-icon.success { background: linear-gradient(135deg, var(--secondary-color), #0d9d58); }
        .stat-icon.warning { background: linear-gradient(135deg, var(--warning-color), #f57c00); }
        .stat-icon.danger { background: linear-gradient(135deg, var(--danger-color), #c62828); }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-900);
            line-height: 1;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 10px;
            margin-top: 4px;
            display: inline-block;
        }

        .stat-change.positive {
            background: rgba(52, 168, 83, 0.1);
            color: var(--secondary-color);
        }

        .stat-change.negative {
            background: rgba(234, 67, 53, 0.1);
            color: var(--danger-color);
        }

        /* ============ ACTIVITY FEED ============ */
        .activity-feed {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }

        .activity-item {
            display: flex;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 14px;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* ============ PERMISSION MANAGER ============ */
        .permission-manager {
            position: fixed;
            top: 0;
            right: -500px;
            width: 500px;
            height: 100vh;
            background: white;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-normal) ease;
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }

        .permission-manager.open {
            right: 0;
        }

        .permission-header {
            padding: 24px;
            background: linear-gradient(135deg, var(--gray-900), var(--gray-800));
            color: white;
        }

        .permission-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .permission-subtitle {
            font-size: 14px;
            color: var(--gray-400);
        }

        .permission-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .permission-resource {
            margin-bottom: 24px;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }

        .permission-resource-header {
            background: var(--gray-50);
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .permission-resource-title {
            font-weight: 600;
            color: var(--gray-900);
        }

        .permission-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            padding: 16px;
            background: white;
        }

        .permission-action {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border: 2px solid var(--gray-300);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-fast) ease;
        }

        .permission-action:hover {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }

        .permission-action.active {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }

        .permission-action.active .permission-toggle {
            color: var(--primary-color);
        }

        .permission-toggle {
            color: var(--gray-400);
            font-size: 12px;
        }

        .permission-action-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-800);
        }

        .permission-footer {
            padding: 20px;
            border-top: 1px solid var(--gray-200);
            background: var(--gray-50);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* ============ MOBILE RESPONSIVE ============ */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .search-box {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .navbar-right {
                flex-direction: column;
                align-items: flex-end;
            }
            
            .search-box {
                width: 100%;
                max-width: 200px;
            }
            
            .permission-manager {
                width: 100%;
                right: -100%;
            }
            
            .content-area {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 32px 20px;
            }
            
            .modal-container {
                width: 95%;
            }
            
            .top-navbar {
                padding: 12px 16px;
            }
            
            .navbar-title {
                font-size: 16px;
            }
        }

        /* ============ CUSTOM SCROLLBAR ============ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }

        /* ============ LOADING STATES ============ */
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--gray-300);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ============ ANIMATIONS ============ */
        .fade-enter-active, .fade-leave-active {
            transition: opacity var(--transition-normal) ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }

        .slide-enter-active, .slide-leave-active {
            transition: transform var(--transition-normal) ease;
        }
        .slide-enter-from, .slide-leave-to {
            transform: translateX(-20px);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ============ TOAST CONTAINER ============ -->
        <div class="toast-container">
            <div v-for="toast in toasts" :key="toast.id" 
                 :class="['toast', `toast-${toast.type}`]">
                <div class="toast-icon">
                    <i :class="toast.icon"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">{{ toast.title }}</div>
                    <div class="toast-message">{{ toast.message }}</div>
                </div>
                <button class="toast-close" @click="removeToast(toast.id)">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- ============ LOGIN SCREEN ============ -->
        <div v-if="!currentUser" class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">
                        <i class="fas fa-hospital-alt"></i>
                        <span class="login-title">DRBA HMS</span>
                    </div>
                    <p class="login-subtitle">Advanced Hospital Management System with Dynamic Role-Based Access</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" v-model="loginForm.email" placeholder="admin@hospital.org">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" v-model="loginForm.password" placeholder="password123">
                </div>
                
                <div class="form-group">
                    <label class="form-label">User Role</label>
                    <select class="form-select" v-model="loginForm.user_role">
                        <option value="system_admin">System Administrator</option>
                        <option value="department_head">Head of Department</option>
                        <option value="resident_manager">Resident Manager</option>
                        <option value="attending_physician">Attending Physician</option>
                        <option value="viewing_doctor">Viewing Doctor</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-check">
                        <input type="checkbox" class="form-check-input" v-model="loginForm.require_mfa">
                        <span class="form-check-label">Require MFA Authentication</span>
                    </label>
                </div>
                
                <div v-if="loginForm.require_mfa" class="form-group">
                    <label class="form-label">MFA Code</label>
                    <input type="text" class="form-control" v-model="loginForm.mfa_code" placeholder="000000">
                </div>
                
                <button class="btn btn-primary btn-lg w-100" @click="handleAdvancedLogin" :disabled="loading">
                    <span v-if="loading" class="loading"></span>
                    <span v-else><i class="fas fa-sign-in-alt"></i> Login to DRBA System</span>
                </button>
                
                <div class="text-center mt-4 text-muted">
                    <small>Demo Credentials: admin@hospital.org / password123</small>
                </div>
            </div>
        </div>

        <!-- ============ MAIN APPLICATION ============ -->
        <div v-else class="app-layout">
            <!-- Sidebar -->
            <aside class="sidebar" :class="{ 'sidebar-collapsed': sidebarCollapsed }">
                <div class="sidebar-header">
                    <div class="sidebar-logo">
                        <i class="fas fa-hospital-alt"></i>
                        <span>DRBA HMS</span>
                    </div>
                    <button class="sidebar-toggle" @click="sidebarCollapsed = !sidebarCollapsed">
                        <i class="fas" :class="sidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
                    </button>
                </div>
                
                <nav class="sidebar-nav">
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Core Modules</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'daily_operations' }" 
                                   @click.prevent="switchView('daily_operations')">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <span>Daily Operations</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'medical_staff' }" 
                                   @click.prevent="switchView('medical_staff')" v-if="hasPermission('medical_staff', 'read')">
                                    <i class="fas fa-user-md"></i>
                                    <span>Medical Staff</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'training_units' }" 
                                   @click.prevent="switchView('training_units')" v-if="hasPermission('training_units', 'read')">
                                    <i class="fas fa-clinic-medical"></i>
                                    <span>Training Units</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'resident_rotations' }" 
                                   @click.prevent="switchView('resident_rotations')" v-if="hasPermission('resident_rotations', 'read')">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>Resident Rotations</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">Scheduling</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'oncall_schedule' }" 
                                   @click.prevent="switchView('oncall_schedule')" v-if="hasPermission('oncall_schedule', 'read')">
                                    <i class="fas fa-phone-alt"></i>
                                    <span>On-call Schedule</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'leave_requests' }" 
                                   @click.prevent="switchView('leave_requests')" v-if="hasPermission('leave_requests', 'read')">
                                    <i class="fas fa-calendar-check"></i>
                                    <span>Leave Requests</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="sidebar-section" v-if="hasAnyPermission(['announcements', 'audit', 'system'])">
                        <div class="sidebar-section-title">Administration</div>
                        <ul class="sidebar-menu">
                            <li class="sidebar-menu-item" v-if="hasPermission('announcements', 'read')">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'announcements' }" 
                                   @click.prevent="switchView('announcements')">
                                    <i class="fas fa-bullhorn"></i>
                                    <span>Announcements</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item" v-if="hasPermission('audit', 'read')">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'audit_logs' }" 
                                   @click.prevent="switchView('audit_logs')">
                                    <i class="fas fa-history"></i>
                                    <span>Audit Logs</span>
                                </a>
                            </li>
                            <li class="sidebar-menu-item" v-if="hasPermission('system', 'read')">
                                <a href="#" class="sidebar-menu-link" :class="{ active: currentView === 'system_settings' }" 
                                   @click.prevent="switchView('system_settings')">
                                    <i class="fas fa-cog"></i>
                                    <span>System Settings</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
                
                <div class="sidebar-footer">
                    <div class="sidebar-user">
                        <div class="user-avatar">{{ getInitials(currentUser.full_name) }}</div>
                        <div class="user-info">
                            <div class="user-name">{{ currentUser.full_name }}</div>
                            <div class="user-role">{{ getUserRoleDisplay(currentUser.user_role) }}</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content" :class="{ 'main-content-expanded': sidebarCollapsed }">
                <!-- Top Navbar -->
                <header class="top-navbar">
                    <div class="navbar-left">
                        <button class="mobile-menu-toggle" @click="mobileMenuOpen = !mobileMenuOpen">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div>
                            <span class="navbar-title">{{ getCurrentTitle() }}</span>
                            <span class="navbar-subtitle">{{ getCurrentSubtitle() }}</span>
                        </div>
                    </div>
                    
                    <div class="navbar-right">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" :placeholder="getSearchPlaceholder()" 
                                   v-model="searchQuery" @keyup.enter="handleAdvancedSearch">
                        </div>
                        
                        <div class="navbar-actions">
                            <div class="notification-badge">
                                <button class="btn btn-icon btn-secondary" @click="markAllNotificationsAsRead">
                                    <i class="fas fa-bell"></i>
                                    <span class="badge-count" v-if="unreadNotifications > 0">{{ unreadNotifications }}</span>
                                </button>
                            </div>
                            
                            <button class="btn btn-icon btn-secondary" @click="togglePermissionManager" 
                                    v-if="hasPermission('system', 'admin')">
                                <i class="fas fa-user-shield"></i>
                            </button>
                            
                            <div class="user-menu">
                                <button class="user-menu-toggle" @click="toggleUserMenu">
                                    <div class="user-avatar">{{ getInitials(currentUser.full_name) }}</div>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                
                                <div class="user-menu-dropdown" v-if="userMenuOpen">
                                    <a href="#" class="user-menu-item" @click.prevent="showUserProfile">
                                        <i class="fas fa-user"></i>
                                        <span>Profile Settings</span>
                                    </a>
                                    <a href="#" class="user-menu-item" @click.prevent="showSystemSettingsModal" 
                                       v-if="hasPermission('system', 'read')">
                                        <i class="fas fa-cog"></i>
                                        <span>System Settings</span>
                                    </a>
                                    <a href="#" class="user-menu-item" @click.prevent="handleLogout">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>Logout</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Content Area -->
                <div class="content-area">
                    <!-- Daily Operations View -->
                    <div v-if="currentView === 'daily_operations'">
                        <!-- Stats Overview -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon primary">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ stats.totalStaff }}</div>
                                    <div class="stat-label">Total Medical Staff</div>
                                    <div class="stat-change positive">+12% this month</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon success">
                                    <i class="fas fa-user-graduate"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ stats.activeResidents }}</div>
                                    <div class="stat-label">Active Residents</div>
                                    <div class="stat-change positive">+8% this quarter</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon warning">
                                    <i class="fas fa-stethoscope"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ stats.attendings }}</div>
                                    <div class="stat-label">Attending Physicians</div>
                                    <div class="stat-change positive">+5% this year</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon danger">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value">{{ coverageAlerts.length }}</div>
                                    <div class="stat-label">Coverage Alerts</div>
                                    <div class="stat-change negative">Requires attention</div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="dashboard-grid mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Emergency Alerts
                                    </div>
                                </div>
                                <div class="activity-feed">
                                    <div v-for="alert in emergencyAlerts" :key="alert.id" class="activity-item">
                                        <div class="activity-icon bg-danger">
                                            <i class="fas fa-exclamation"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-text">{{ alert.message }}</div>
                                            <div class="activity-time">Priority: {{ alert.priority.toUpperCase() }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-clipboard-check"></i>
                                        Today's On-call
                                    </div>
                                    <button class="btn btn-sm btn-outline" @click="showAddOnCallModal" 
                                            v-if="hasPermission('oncall_schedule', 'create')">
                                        <i class="fas fa-plus"></i> Add
                                    </button>
                                </div>
                                <div class="activity-feed">
                                    <div v-for="schedule in todaysOnCall" :key="schedule.id" class="activity-item">
                                        <div class="activity-icon bg-info">
                                            <i class="fas fa-phone-alt"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-text">{{ getPhysicianName(schedule.primary_physician_id) }}</div>
                                            <div class="activity-time">{{ formatTimeRange(schedule.start_time, schedule.end_time) }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Coverage Alerts -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-user-clock"></i>
                                    Coverage Alerts
                                </div>
                                <button class="btn btn-sm btn-success" @click="showQuickPlacementModal" 
                                        v-if="hasPermission('placements', 'create')">
                                    <i class="fas fa-plus"></i> Quick Placement
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Training Unit</th>
                                            <th>Current Residents</th>
                                            <th>Capacity</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="alert in coverageAlerts" :key="alert.id">
                                            <td>{{ alert.unit_name }}</td>
                                            <td>{{ alert.current }}</td>
                                            <td>{{ alert.capacity }}</td>
                                            <td>
                                                <span class="badge" :class="alert.priority === 'high' ? 'status-critical' : 'status-busy'">
                                                    {{ alert.priority === 'high' ? 'Critical' : 'Warning' }}
                                                </span>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-primary" @click="quickAssignToUnit(alert)">
                                                    <i class="fas fa-user-plus"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 7-Day Schedule -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-calendar-week"></i>
                                    Next 7 Days Schedule
                                </div>
                            </div>
                            <div class="p-4">
                                <div class="grid grid-cols-7 gap-2">
                                    <div v-for="day in nextSevenDays" :key="day.date" class="text-center">
                                        <div class="p-3 rounded-lg" :class="getDayStatus(day)">
                                            <div class="font-medium">{{ formatDateShort(day.date) }}</div>
                                            <div v-if="day.schedule" class="text-xs mt-1">
                                                {{ getPhysicianName(day.schedule.primary_physician_id).split(' ')[0] }}
                                            </div>
                                            <div v-else class="text-xs mt-1 text-gray-500">
                                                Uncovered
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <button class="btn btn-sm btn-secondary" @click="editOnCallSchedule(day)"
                                                    v-if="hasPermission('oncall_schedule', 'update')">
                                                Edit
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medical Staff View -->
                    <div v-if="currentView === 'medical_staff'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Medical Staff Management</h2>
                                <p class="text-muted">Manage all medical staff with advanced permission controls</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddMedicalStaffModal" 
                                    v-if="hasPermission('medical_staff', 'create')">
                                <i class="fas fa-plus"></i> Add Medical Staff
                            </button>
                        </div>

                        <!-- Filters -->
                        <div class="card mb-4">
                            <div class="p-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <input type="text" class="form-control" v-model="staffSearch" placeholder="Search staff by name or ID...">
                                    </div>
                                    <div>
                                        <select class="form-select" v-model="staffFilter.staff_type">
                                            <option value="">All Staff Types</option>
                                            <option value="medical_resident">Medical Resident</option>
                                            <option value="attending_physician">Attending Physician</option>
                                            <option value="fellow">Fellow</option>
                                            <option value="nurse_practitioner">Nurse Practitioner</option>
                                        </select>
                                    </div>
                                    <div>
                                        <select class="form-select" v-model="staffFilter.employment_status">
                                            <option value="">All Statuses</option>
                                            <option value="active">Active</option>
                                            <option value="on_leave">On Leave</option>
                                            <option value="inactive">Inactive</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Staff Table -->
                        <div class="card">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Staff Type</th>
                                            <th>Staff ID</th>
                                            <th>Department</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="staff in filteredMedicalStaff" :key="staff.id">
                                            <td>
                                                <div class="flex items-center gap-3">
                                                    <div class="user-avatar">{{ getInitials(staff.full_name) }}</div>
                                                    <div>
                                                        <div class="font-medium">{{ staff.full_name }}</div>
                                                        <div class="text-sm text-gray-500">{{ staff.professional_email }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge" :class="getStaffTypeClass(staff.staff_type)">
                                                    {{ formatStaffType(staff.staff_type) }}
                                                </span>
                                            </td>
                                            <td>{{ staff.staff_id }}</td>
                                            <td>{{ staff.primary_clinic || 'Unassigned' }}</td>
                                            <td>
                                                <span class="badge" :class="staff.employment_status === 'active' ? 'status-available' : 'status-busy'">
                                                    {{ formatEmploymentStatus(staff.employment_status) }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="flex gap-2">
                                                    <button class="btn btn-sm btn-secondary" @click="loadStaffDailyActivities(staff.id)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-primary" @click="editMedicalStaff(staff)"
                                                            v-if="hasPermission('medical_staff', 'update')">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" @click="deleteMedicalStaff(staff)"
                                                            v-if="hasPermission('medical_staff', 'delete')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- On-call Schedule View -->
                    <div v-if="currentView === 'oncall_schedule'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">On-call Schedule</h2>
                                <p class="text-muted">Manage physician on-call duties and emergency coverage</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddOnCallModal" 
                                    v-if="hasPermission('oncall_schedule', 'create')">
                                <i class="fas fa-plus"></i> Add Schedule
                            </button>
                        </div>

                        <!-- Schedule Table -->
                        <div class="card">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Primary Physician</th>
                                            <th>Backup Physician</th>
                                            <th>Shift</th>
                                            <th>Coverage Notes</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="schedule in onCallSchedule" :key="schedule.id">
                                            <td>{{ formatDate(schedule.duty_date) }}</td>
                                            <td>{{ getPhysicianName(schedule.primary_physician_id) }}</td>
                                            <td>{{ schedule.backup_physician_id ? getPhysicianName(schedule.backup_physician_id) : 'None' }}</td>
                                            <td>{{ formatTimeRange(schedule.start_time, schedule.end_time) }}</td>
                                            <td class="max-w-xs truncate">{{ schedule.coverage_notes || 'None' }}</td>
                                            <td>
                                                <div class="flex gap-2">
                                                    <button class="btn btn-sm btn-primary" @click="editOnCallSchedule({date: schedule.duty_date, schedule})"
                                                            v-if="hasPermission('oncall_schedule', 'update')">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" @click="overrideOnCall({date: schedule.duty_date})"
                                                            v-if="hasPermission('oncall_schedule', 'override')">
                                                        <i class="fas fa-exclamation-triangle"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Leave Requests View -->
                    <div v-if="currentView === 'leave_requests'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Leave Requests</h2>
                                <p class="text-muted">Review and approve leave requests with coverage management</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddLeaveRequestModal" 
                                    v-if="hasPermission('leave_requests', 'create')">
                                <i class="fas fa-plus"></i> Request Leave
                            </button>
                        </div>

                        <!-- Leave Requests Table -->
                        <div class="card">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Staff Member</th>
                                            <th>Leave Type</th>
                                            <th>Dates</th>
                                            <th>Duration</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="request in leaveRequests" :key="request.id">
                                            <td>{{ getPhysicianName(request.staff_member_id) }}</td>
                                            <td>{{ request.leave_category || request.leave_type }}</td>
                                            <td>{{ formatDate(request.leave_start_date) }} - {{ formatDate(request.leave_end_date) }}</td>
                                            <td>{{ request.total_days || 'N/A' }} days</td>
                                            <td>
                                                <span class="badge" :class="request.status === 'approved' ? 'status-available' : 
                                                                           request.status === 'pending' ? 'status-busy' : 'status-critical'">
                                                    {{ request.status?.toUpperCase() || 'PENDING' }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="flex gap-2">
                                                    <button class="btn btn-sm btn-secondary" @click="viewLeaveRequestDetails(request)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-success" @click="approveLeaveRequest(request)"
                                                            v-if="hasPermission('leave_requests', 'approve') && request.status === 'pending'">
                                                        <i class="fas fa-check"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" @click="rejectLeaveRequest(request)"
                                                            v-if="hasPermission('leave_requests', 'reject') && request.status === 'pending'">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Resident Rotations View -->
                    <div v-if="currentView === 'resident_rotations'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Resident Rotations</h2>
                                <p class="text-muted">Manage resident training rotations and assignments</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddRotationModal" 
                                    v-if="hasPermission('resident_rotations', 'create')">
                                <i class="fas fa-plus"></i> Add Rotation
                            </button>
                        </div>

                        <!-- Rotations Table -->
                        <div class="card">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Rotation ID</th>
                                            <th>Resident</th>
                                            <th>Training Unit</th>
                                            <th>Supervisor</th>
                                            <th>Duration</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="rotation in filteredRotations" :key="rotation.id">
                                            <td>{{ rotation.rotation_id }}</td>
                                            <td>{{ getResidentName(rotation.resident_id) }}</td>
                                            <td>{{ getTrainingUnitName(rotation.training_unit_id) }}</td>
                                            <td>{{ rotation.supervising_attending_id ? getAttendingName(rotation.supervising_attending_id) : 'Unassigned' }}</td>
                                            <td>{{ formatDate(rotation.rotation_start_date) }} - {{ formatDate(rotation.rotation_end_date) }}</td>
                                            <td>
                                                <span class="badge" :class="getRotationCategoryClass(rotation.rotation_category)">
                                                    {{ formatRotationCategory(rotation.rotation_category) }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="flex gap-2">
                                                    <button class="btn btn-sm btn-secondary" @click="editRotation(rotation)"
                                                            v-if="hasPermission('resident_rotations', 'update')">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-warning" @click="extendRotation(rotation)"
                                                            v-if="hasPermission('resident_rotations', 'extend')">
                                                        <i class="fas fa-calendar-plus"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" @click="deleteRotation(rotation)"
                                                            v-if="hasPermission('resident_rotations', 'delete')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Training Units View -->
                    <div v-if="currentView === 'training_units'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Training Units</h2>
                                <p class="text-muted">Manage training units and resident capacity allocation</p>
                            </div>
                            <button class="btn btn-primary" @click="showAddTrainingUnitModal" 
                                    v-if="hasPermission('training_units', 'create')">
                                <i class="fas fa-plus"></i> Add Unit
                            </button>
                        </div>

                        <!-- Units Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div v-for="unit in trainingUnits" :key="unit.id" class="card" @dragover.prevent @drop="handleDrop($event, unit)">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-clinic-medical"></i>
                                        {{ unit.unit_name }}
                                    </div>
                                    <span class="badge" :class="unit.unit_status === 'active' ? 'status-available' : 'status-busy'">
                                        {{ unit.unit_status }}
                                    </span>
                                </div>
                                
                                <div class="mb-4">
                                    <p class="text-sm text-gray-600 mb-4">{{ unit.unit_description }}</p>
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium">Resident Capacity</span>
                                        <span class="text-sm">{{ unit.current_residents || 0 }} / {{ unit.maximum_residents }}</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" :style="{width: `${((unit.current_residents || 0) / unit.maximum_residents) * 100}%`}"></div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-sm font-medium mb-2">Assigned Residents:</div>
                                    <div class="flex flex-wrap gap-2">
                                        <div v-for="resident in getAssignedResidents(unit.id)" :key="resident.id" 
                                             class="flex items-center gap-2 bg-gray-100 px-3 py-1 rounded-full text-sm">
                                            <span>{{ getInitials(resident.full_name) }}</span>
                                            <span>{{ resident.full_name.split(' ')[0] }}</span>
                                            <button class="text-gray-500 hover:text-red-500" @click="removePlacement(resident.id, unit.id)"
                                                    v-if="hasPermission('placements', 'delete')">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex gap-2">
                                    <button class="btn btn-sm btn-primary flex-1" @click="editTrainingUnit(unit)"
                                            v-if="hasPermission('training_units', 'update')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-success flex-1" @click="assignResidentsToUnit(unit)"
                                            v-if="hasPermission('placements', 'create')">
                                        <i class="fas fa-user-plus"></i> Assign
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Audit Logs View -->
                    <div v-if="currentView === 'audit_logs'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">Audit Logs</h2>
                                <p class="text-muted">Track all system activities and permission changes</p>
                            </div>
                            <button class="btn btn-primary" @click="exportAuditLogs" v-if="hasPermission('audit', 'export')">
                                <i class="fas fa-download"></i> Export Logs
                            </button>
                        </div>

                        <!-- Audit Table -->
                        <div class="card">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Timestamp</th>
                                            <th>User</th>
                                            <th>Action</th>
                                            <th>Resource</th>
                                            <th>Details</th>
                                            <th>Permission Level</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="log in auditLogs" :key="log.id">
                                            <td>{{ formatDateTime(log.timestamp) }}</td>
                                            <td>
                                                <div class="flex items-center gap-2">
                                                    <div class="user-avatar">{{ getInitials(log.user_name) }}</div>
                                                    <div>
                                                        <div class="font-medium">{{ log.user_name }}</div>
                                                        <div class="text-sm text-gray-500">{{ getUserRoleDisplay(log.user_role) }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="flex items-center gap-2">
                                                    <i :class="getAuditIcon(log.action)" class="text-blue-500"></i>
                                                    <span>{{ log.action }}</span>
                                                </div>
                                            </td>
                                            <td>{{ log.resource }}</td>
                                            <td class="max-w-xs truncate">{{ log.details }}</td>
                                            <td>
                                                <span class="badge" :class="log.permission_level === 'full' ? 'badge-admin-advanced' : 'badge-resident-advanced'">
                                                    {{ log.permission_level }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- System Settings View -->
                    <div v-if="currentView === 'system_settings'">
                        <div class="section-header mb-6">
                            <div>
                                <h2 class="section-title">System Settings</h2>
                                <p class="text-muted">Configure system-wide settings and preferences</p>
                            </div>
                            <button class="btn btn-primary" @click="showSystemSettingsModal" 
                                    v-if="hasPermission('system', 'update')">
                                <i class="fas fa-edit"></i> Edit Settings
                            </button>
                        </div>

                        <!-- Settings Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-hospital"></i>
                                        Hospital Information
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="form-label">Hospital Name</label>
                                        <div class="form-control">{{ systemSettings.hospital_name }}</div>
                                    </div>
                                    <div>
                                        <label class="form-label">Department Name</label>
                                        <div class="form-control">{{ systemSettings.department_name }}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-shield-alt"></i>
                                        Security Settings
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" :checked="systemSettings.enable_audit_logging" disabled>
                                        <span class="form-check-label">Enable Audit Logging</span>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" :checked="systemSettings.require_mfa" disabled>
                                        <span class="form-check-label">Require MFA Authentication</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-users-cog"></i>
                                        System Configuration
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="form-label">Maximum Residents per Unit</label>
                                        <div class="form-control">{{ systemSettings.max_residents_per_unit }}</div>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" :checked="systemSettings.maintenance_mode" disabled>
                                        <span class="form-check-label">Maintenance Mode</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Permission Manager Side Panel -->
                    <div class="permission-manager" :class="{ open: showPermissionManager }">
                        <div class="permission-header">
                            <div class="permission-title">
                                <i class="fas fa-user-shield"></i> Permission Manager
                            </div>
                            <div class="permission-subtitle">
                                Configure role-based access controls for all system resources
                            </div>
                        </div>
                        
                        <div class="permission-content">
                            <div v-for="(resource, resourceKey) in permissionResources" :key="resourceKey" 
                                 class="permission-resource">
                                <div class="permission-resource-header">
                                    <div class="permission-resource-title">
                                        {{ resource.name }}
                                        <div class="text-sm text-gray-600">{{ resource.description }}</div>
                                    </div>
                                    <span class="badge" :class="getResourcePermissionLevel(resourceKey) === 'full' ? 'status-available' : 
                                                               getResourcePermissionLevel(resourceKey) === 'write' ? 'status-busy' : 
                                                               getResourcePermissionLevel(resourceKey) === 'read' ? 'status-oncall' : 'status-critical'">
                                        {{ getResourcePermissionLevel(resourceKey) }}
                                    </span>
                                </div>
                                
                                <div class="permission-actions">
                                    <div v-for="action in resource.actions" :key="action" 
                                         class="permission-action" 
                                         :class="{ active: hasPermission(resourceKey, action) }"
                                         @click="togglePermission(currentUser.user_role, resourceKey, action)">
                                        <div class="permission-toggle">
                                            <i class="fas" :class="hasPermission(resourceKey, action) ? 'fa-check-circle' : 'fa-times-circle'"></i>
                                        </div>
                                        <div class="permission-action-label">
                                            {{ formatActionName(action) }}
                                            <div class="text-xs text-gray-500">{{ getPermissionDescription(resourceKey, action) }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="permission-footer">
                            <button class="btn btn-secondary" @click="showPermissionManager = false">
                                Cancel
                            </button>
                            <button class="btn btn-primary" @click="savePermissionChanges" :disabled="savingPermissions">
                                <span v-if="savingPermissions" class="loading"></span>
                                <span v-else>Save Changes</span>
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- ============ MODALS ============ -->
        
        <!-- Add/Edit Medical Staff Modal -->
        <div v-if="medicalStaffModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user-md"></i>
                        {{ medicalStaffModal.mode === 'add' ? 'Add Medical Staff' : 'Edit Medical Staff' }}
                    </div>
                    <button class="modal-close" @click="medicalStaffModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Full Name *</label>
                            <input type="text" class="form-control" v-model="medicalStaffModal.form.full_name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Staff Type *</label>
                            <select class="form-select" v-model="medicalStaffModal.form.staff_type">
                                <option value="medical_resident">Medical Resident</option>
                                <option value="attending_physician">Attending Physician</option>
                                <option value="fellow">Fellow</option>
                                <option value="nurse_practitioner">Nurse Practitioner</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Staff ID</label>
                            <input type="text" class="form-control" v-model="medicalStaffModal.form.staff_id">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Employment Status</label>
                            <select class="form-select" v-model="medicalStaffModal.form.employment_status">
                                <option value="active">Active</option>
                                <option value="on_leave">On Leave</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Professional Email</label>
                            <input type="email" class="form-control" v-model="medicalStaffModal.form.professional_email">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Primary Clinic/Unit</label>
                            <input type="text" class="form-control" v-model="medicalStaffModal.form.primary_clinic">
                        </div>
                        <div class="form-group" v-if="medicalStaffModal.form.staff_type === 'medical_resident'">
                            <label class="form-label">Resident Category</label>
                            <select class="form-select" v-model="medicalStaffModal.form.resident_category">
                                <option value="department_internal">Department Internal</option>
                                <option value="rotating_other_dept">Rotating Other Dept</option>
                                <option value="pgy1">PGY-1</option>
                                <option value="pgy2">PGY-2</option>
                                <option value="pgy3">PGY-3</option>
                                <option value="pgy4">PGY-4</option>
                                <option value="pgy5">PGY-5</option>
                            </select>
                        </div>
                        <div class="form-group" v-if="medicalStaffModal.form.staff_type === 'medical_resident'">
                            <label class="form-label">Training Year</label>
                            <input type="number" class="form-control" v-model="medicalStaffModal.form.training_year" min="2020" max="2030">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-check">
                            <input type="checkbox" class="form-check-input" v-model="medicalStaffModal.form.can_supervise_residents">
                            <span class="form-check-label">Can Supervise Residents</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="medicalStaffModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveMedicalStaff" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ medicalStaffModal.mode === 'add' ? 'Add Staff' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit On-call Schedule Modal -->
        <div v-if="onCallModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-phone-alt"></i>
                        {{ onCallModal.mode === 'add' ? 'Add On-call Schedule' : 'Edit On-call Schedule' }}
                    </div>
                    <button class="modal-close" @click="onCallModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Duty Date *</label>
                            <input type="date" class="form-control" v-model="onCallModal.form.duty_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Shift Type</label>
                            <select class="form-select" v-model="onCallModal.form.shift_type">
                                <option value="backup_call">Backup Call</option>
                                <option value="primary_call">Primary Call</option>
                                <option value="emergency_call">Emergency Call</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Primary Physician *</label>
                            <select class="form-select" v-model="onCallModal.form.primary_physician_id">
                                <option value="">Select Physician</option>
                                <option v-for="physician in availablePhysicians" :key="physician.id" :value="physician.id">
                                    {{ physician.full_name }} ({{ formatStaffType(physician.staff_type) }})
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Backup Physician</label>
                            <select class="form-select" v-model="onCallModal.form.backup_physician_id">
                                <option value="">Select Backup Physician</option>
                                <option v-for="physician in availablePhysicians" :key="physician.id" :value="physician.id">
                                    {{ physician.full_name }} ({{ formatStaffType(physician.staff_type) }})
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Start Time</label>
                            <input type="time" class="form-control" v-model="onCallModal.form.start_time">
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Time</label>
                            <input type="time" class="form-control" v-model="onCallModal.form.end_time">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Coverage Notes</label>
                        <textarea class="form-control" v-model="onCallModal.form.coverage_notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="onCallModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveOnCallSchedule" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ onCallModal.mode === 'add' ? 'Add Schedule' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Announcement Modal -->
        <div v-if="announcementModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-bullhorn"></i>
                        {{ announcementModal.mode === 'add' ? 'Create Announcement' : 'Edit Announcement' }}
                    </div>
                    <button class="modal-close" @click="announcementModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-control" v-model="announcementModal.form.announcement_title">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Content *</label>
                        <textarea class="form-control" v-model="announcementModal.form.announcement_content" rows="6"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Publish Date *</label>
                            <input type="date" class="form-control" v-model="announcementModal.form.publish_start_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Expiry Date</label>
                            <input type="date" class="form-control" v-model="announcementModal.form.publish_end_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Priority Level</label>
                            <select class="form-select" v-model="announcementModal.form.priority_level">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Target Audience</label>
                            <select class="form-select" v-model="announcementModal.form.target_audience">
                                <option value="all">All Staff</option>
                                <option value="residents">Residents Only</option>
                                <option value="attendings">Attending Physicians</option>
                                <option value="nursing">Nursing Staff</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="announcementModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveAnnouncement" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ announcementModal.mode === 'add' ? 'Publish Announcement' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Leave Request Modal -->
        <div v-if="leaveRequestModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-calendar-check"></i>
                        {{ leaveRequestModal.mode === 'add' ? 'Request Leave' : 'Review Leave Request' }}
                    </div>
                    <button class="modal-close" @click="leaveRequestModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div v-if="leaveRequestModal.mode === 'review'" class="mb-4 p-3 bg-gray-50 rounded-lg">
                        <div class="text-sm font-medium">Request Submitted by: {{ leaveRequestModal.request?.staff_name || 'Unknown' }}</div>
                        <div class="text-sm text-gray-600">Submitted on: {{ formatDateTime(leaveRequestModal.request?.created_at) }}</div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Start Date *</label>
                            <input type="date" class="form-control" v-model="leaveRequestModal.form.start_date" 
                                   :disabled="leaveRequestModal.mode === 'review'">
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Date *</label>
                            <input type="date" class="form-control" v-model="leaveRequestModal.form.end_date"
                                   :disabled="leaveRequestModal.mode === 'review'">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Leave Type</label>
                            <select class="form-select" v-model="leaveRequestModal.form.leave_type"
                                    :disabled="leaveRequestModal.mode === 'review'">
                                <option value="vacation">Vacation</option>
                                <option value="sick_leave">Sick Leave</option>
                                <option value="conference">Conference</option>
                                <option value="personal">Personal</option>
                                <option value="maternity_paternity">Maternity/Paternity</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" v-model="leaveRequestModal.form.status"
                                    :disabled="!hasPermission('leave_requests', 'update')">
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Reason</label>
                        <textarea class="form-control" v-model="leaveRequestModal.form.reason" rows="3"
                                :disabled="leaveRequestModal.mode === 'review'"></textarea>
                    </div>
                    
                    <div v-if="leaveRequestModal.mode === 'review'" class="form-group">
                        <label class="form-label">Approver Notes</label>
                        <textarea class="form-control" v-model="leaveRequestModal.form.approver_notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="leaveRequestModal.show = false">Cancel</button>
                    <div v-if="leaveRequestModal.mode === 'review'" class="flex gap-2">
                        <button class="btn btn-success" @click="approveLeaveRequest(leaveRequestModal.request)"
                                v-if="hasPermission('leave_requests', 'approve') && leaveRequestModal.form.status === 'pending'">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="btn btn-danger" @click="rejectLeaveRequest(leaveRequestModal.request)"
                                v-if="hasPermission('leave_requests', 'reject') && leaveRequestModal.form.status === 'pending'">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    </div>
                    <button v-else class="btn btn-primary" @click="saveLeaveRequest" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>Submit Request</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Training Unit Modal -->
        <div v-if="trainingUnitModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-clinic-medical"></i>
                        {{ trainingUnitModal.mode === 'add' ? 'Add Training Unit' : 'Edit Training Unit' }}
                    </div>
                    <button class="modal-close" @click="trainingUnitModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Unit Name *</label>
                            <input type="text" class="form-control" v-model="trainingUnitModal.form.unit_name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unit Code</label>
                            <input type="text" class="form-control" v-model="trainingUnitModal.form.unit_code">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Department</label>
                            <select class="form-select" v-model="trainingUnitModal.form.department_name">
                                <option value="Pulmonology">Pulmonology</option>
                                <option value="ICU">ICU</option>
                                <option value="Cardiology">Cardiology</option>
                                <option value="Emergency">Emergency Medicine</option>
                                <option value="Surgery">Surgery</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Specialty</label>
                            <input type="text" class="form-control" v-model="trainingUnitModal.form.specialty">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Maximum Residents</label>
                            <input type="number" class="form-control" v-model="trainingUnitModal.form.maximum_residents" min="1" max="50">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Current Residents</label>
                            <input type="number" class="form-control" v-model="trainingUnitModal.form.current_residents" min="0" 
                                   :max="trainingUnitModal.form.maximum_residents">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unit Status</label>
                            <select class="form-select" v-model="trainingUnitModal.form.unit_status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="maintenance">Maintenance</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" v-model="trainingUnitModal.form.unit_description" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="trainingUnitModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveTrainingUnit" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ trainingUnitModal.mode === 'add' ? 'Add Unit' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Rotation Modal -->
        <div v-if="rotationModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-calendar-alt"></i>
                        {{ rotationModal.mode === 'add' ? 'Add Resident Rotation' : 'Edit Rotation' }}
                    </div>
                    <button class="modal-close" @click="rotationModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Rotation ID *</label>
                            <input type="text" class="form-control" v-model="rotationModal.form.rotation_id">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Resident *</label>
                            <select class="form-select" v-model="rotationModal.form.resident_id">
                                <option value="">Select Resident</option>
                                <option v-for="resident in medicalStaff.filter(s => s.staff_type === 'medical_resident')" 
                                        :key="resident.id" :value="resident.id">
                                    {{ resident.full_name }} ({{ resident.staff_id }})
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Training Unit *</label>
                            <select class="form-select" v-model="rotationModal.form.training_unit_id">
                                <option value="">Select Unit</option>
                                <option v-for="unit in trainingUnits" :key="unit.id" :value="unit.id">
                                    {{ unit.unit_name }} ({{ unit.specialty }})
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Supervising Attending</label>
                            <select class="form-select" v-model="rotationModal.form.supervising_attending_id">
                                <option value="">Select Attending</option>
                                <option v-for="attending in availableAttendings" :key="attending.id" :value="attending.id">
                                    {{ attending.full_name }}
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Start Date *</label>
                            <input type="date" class="form-control" v-model="rotationModal.form.rotation_start_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Date *</label>
                            <input type="date" class="form-control" v-model="rotationModal.form.rotation_end_date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rotation Category</label>
                            <select class="form-select" v-model="rotationModal.form.rotation_category">
                                <option value="clinical_rotation">Clinical Rotation</option>
                                <option value="elective_rotation">Elective Rotation</option>
                                <option value="research_rotation">Research</option>
                                <option value="vacation_rotation">Vacation</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" v-model="rotationModal.form.rotation_status">
                                <option value="scheduled">Scheduled</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Clinical Notes</label>
                        <textarea class="form-control" v-model="rotationModal.form.clinical_notes" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Supervisor Evaluation</label>
                        <textarea class="form-control" v-model="rotationModal.form.supervisor_evaluation" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="rotationModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveRotation" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>{{ rotationModal.mode === 'add' ? 'Create Rotation' : 'Save Changes' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Placement Modal -->
        <div v-if="quickPlacementModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user-plus"></i> Quick Placement
                    </div>
                    <button class="modal-close" @click="quickPlacementModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Select Resident</label>
                        <select class="form-select" v-model="quickPlacementModal.form.resident_id">
                            <option value="">Choose a resident</option>
                            <option v-for="resident in availableResidents" :key="resident.id" :value="resident.id">
                                {{ resident.full_name }} - {{ resident.staff_id }}
                            </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select Training Unit</label>
                        <select class="form-select" v-model="quickPlacementModal.form.unit_id">
                            <option value="">Choose a unit</option>
                            <option v-for="unit in activeTrainingUnits" :key="unit.id" :value="unit.id">
                                {{ unit.unit_name }} ({{ unit.current_residents }}/{{ unit.maximum_residents }})
                            </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duration (weeks)</label>
                        <select class="form-select" v-model="quickPlacementModal.form.duration">
                            <option value="4">4 weeks (1 month)</option>
                            <option value="8">8 weeks (2 months)</option>
                            <option value="12">12 weeks (3 months)</option>
                            <option value="16">16 weeks (4 months)</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="quickPlacementModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveQuickPlacement" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>Place Resident</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- System Settings Modal -->
        <div v-if="systemSettingsModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-cog"></i> System Settings
                    </div>
                    <button class="modal-close" @click="systemSettingsModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Hospital Name</label>
                            <input type="text" class="form-control" v-model="systemSettingsModal.form.hospital_name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Department Name</label>
                            <input type="text" class="form-control" v-model="systemSettingsModal.form.department_name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Residents per Unit</label>
                            <input type="number" class="form-control" v-model="systemSettingsModal.form.max_residents_per_unit" min="1" max="50">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-check">
                            <input type="checkbox" class="form-check-input" v-model="systemSettingsModal.form.enable_audit_logging">
                            <span class="form-check-label">Enable Audit Logging</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-check">
                            <input type="checkbox" class="form-check-input" v-model="systemSettingsModal.form.require_mfa">
                            <span class="form-check-label">Require MFA Authentication</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-check">
                            <input type="checkbox" class="form-check-input" v-model="systemSettingsModal.form.maintenance_mode">
                            <span class="form-check-label">Maintenance Mode</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="systemSettingsModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveSystemSettings" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>Save Settings</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- User Profile Modal -->
        <div v-if="userProfileModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user"></i> Profile Settings
                    </div>
                    <button class="modal-close" @click="userProfileModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" v-model="userProfileModal.form.full_name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-control" v-model="userProfileModal.form.email" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="text" class="form-control" v-model="userProfileModal.form.phone">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Department</label>
                            <input type="text" class="form-control" v-model="userProfileModal.form.department">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-check">
                            <input type="checkbox" class="form-check-input" v-model="userProfileModal.form.notifications_enabled">
                            <span class="form-check-label">Enable Email Notifications</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="userProfileModal.show = false">Cancel</button>
                    <button class="btn btn-primary" @click="saveUserProfile" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else>Save Profile</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Import/Export Modal -->
        <div v-if="importExportModal.show" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas" :class="importExportModal.mode === 'import' ? 'fa-upload' : 'fa-download'"></i>
                        {{ importExportModal.mode === 'import' ? 'Import Data' : 'Export Data' }}
                    </div>
                    <button class="modal-close" @click="importExportModal.show = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Select Table</label>
                        <select class="form-select" v-model="importExportModal.selectedTable">
                            <option value="medical_staff">Medical Staff</option>
                            <option value="training_units">Training Units</option>
                            <option value="resident_rotations">Resident Rotations</option>
                            <option value="audit_logs">Audit Logs</option>
                        </select>
                    </div>
                    
                    <div v-if="importExportModal.mode === 'export'" class="form-group">
                        <label class="form-label">Export Format</label>
                        <select class="form-select" v-model="importExportModal.exportFormat">
                            <option value="csv">CSV (Comma Separated Values)</option>
                            <option value="json">JSON (JavaScript Object Notation)</option>
                            <option value="excel">Excel Spreadsheet</option>
                        </select>
                    </div>
                    
                    <div v-if="importExportModal.mode === 'import'" class="form-group">
                        <label class="form-label">Select File</label>
                        <input type="file" class="form-control" @change="handleFileSelect" accept=".csv,.json,.xlsx">
                        <small class="text-gray-600">Supported formats: CSV, JSON, Excel</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @click="importExportModal.show = false">Cancel</button>
                    <button v-if="importExportModal.mode === 'export'" class="btn btn-primary" @click="exportData" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-download"></i> Export</span>
                    </button>
                    <button v-if="importExportModal.mode === 'import'" class="btn btn-primary" @click="importData" :disabled="saving">
                        <span v-if="saving" class="loading"></span>
                        <span v-else><i class="fas fa-upload"></i> Import</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
<script src="app.js"></script>
</body>
</html>
